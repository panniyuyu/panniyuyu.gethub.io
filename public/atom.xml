<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>YyWang&#39;s Blog</title>
  
  <subtitle>æ°¸è¿œæ²¡æ—¶é—´çš„ç‹å…ˆæ£®</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2021-07-13T12:25:17.332Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>YyWang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>iptablesæ˜¯ä¸ªå•¥</title>
    <link href="http://yoursite.com/2021/07/13/iptables/"/>
    <id>http://yoursite.com/2021/07/13/iptables/</id>
    <published>2021-07-13T13:16:15.000Z</published>
    <updated>2021-07-13T12:25:17.332Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>iptables æ˜¯ Linux ä¸­ç»å¸¸ä½¿ç”¨çš„é˜²ç«å¢™ï¼Œè¿˜è®°å¾—ä¹‹å‰éƒ¨ç½² Tomcat æœåŠ¡åˆ°ä¸€ä¸ª web æœåŠ¡å™¨éœ€è¦é…ç½®æ–°çš„ iptables è§„åˆ™ï¼Œå¼€æ”¾8080ç«¯å£ï¼Œå¦åˆ™æ— æ³•è®¿é—®è‡ª<br>å·±çš„æœåŠ¡ï¼Œå½“æ—¶æ»¡è„‘å­åªæƒ³å®Œæˆä»»åŠ¡ï¼Œç½‘ä¸Š copy å‘½ä»¤æ”¹æ”¹æ”¹ç›´æ¥æ•²ï¼Œç”šè‡³ç›´æ¥ç²—æš´çš„å…³é—­é˜²ç«å¢™ ğŸ¤ ç°åœ¨ k8s ä¸­çš„æœåŠ¡å‘ç°ä»¥åŠ service mesh ä¸­çš„æµé‡åŠ«æŒ<br>éƒ½ä½¿ç”¨åˆ°äº† iptablesã€‚so ä»Šå¤©æˆ‘æ¥è¿˜å€ºäº†</p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>iptableså…¶å®ä¸æ˜¯é˜²ç«å¢™ï¼ŒçœŸæ­£çš„é˜²ç«å¢™æ˜¯ netfilter å­—é¢æ„æ€å°±æ˜¯ç½‘ç»œè¿‡æ»¤å™¨ï¼Œå¯ä»¥è¿‡æ»¤è¿›å‡º Linux ç½‘ç»œåè®®æ ˆçš„æ•°æ®åŒ…ï¼Œé€šè¿‡æŒ‡å®šå„ç§è‡ªå®šä¹‰çš„è§„åˆ™å¯¹è¿›<br>å‡ºçš„æ•°æ®åŒ…è¿›è¡Œæ‹¦æˆªä¿®æ”¹ç­‰æ“ä½œï¼Œnetfilter åœ¨å†…æ ¸ç©ºé—´å¤„äºå†…æ ¸æ€ï¼Œè€Œ iptables æ˜¯å¯¹ netfilter çš„é…ç½®å·¥å…·ï¼Œé€šè¿‡ iptables å¯ä»¥é…ç½® netfilter çš„<br>è¿‡æ»¤è§„åˆ™ï¼Œiptables åœ¨ç”¨æˆ·ç©ºé—´å¤„äºç”¨æˆ·æ€ã€‚è¿™ä¹ˆçœ‹ iptables å¯ä»¥ç†è§£æˆâ€æ§åˆ¶é¢â€ï¼Œnetfilter å¯ä»¥ç†è§£æˆâ€æ•°æ®é¢â€</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>netfilter åœ¨æ•°æ®åŒ…è¿›å‡º Linux ç½‘ç»œåè®®æ ˆçš„ä¸åŒèŠ‚ç‚¹ä¸Šè®¾æœ‰ hooks ï¼ˆå¯ä»¥ç†è§£ä¸ºå›è°ƒå‡½æ•°ï¼‰ï¼Œå½“æ»¡è¶³äº†åŒ¹é…æ¡ä»¶å°±ä¼šå‡ºå‘å›è°ƒè¿›è¡Œåé¢çš„æ“ä½œï¼Œhooks ä¸»è¦<br>åœ¨ PRE_ROUTINGã€LOCAL_INã€FORWARDã€LOCAL_OUT å’Œ POST_ROUTING 5ä¸ªä½ç½®ä¸Šï¼Œè¦†ç›–äº†æ•°æ®åŒ…è¿›å‡º Linux åè®®æ ˆçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ¥æ•´ä¸€å¼ å›¾çœ‹ä¸‹è¿™<br>5ä¸ªä½ç½®ï¼ˆå›¾ä¸­æ©™è‰²çš„åœ†å‹å°±æ˜¯ï¼‰</p><p><img src="/images/iptables1.png" alt="iptables1"></p><ul><li>PRE_ROUTING åœ¨æ•°æ®åŒ…è¿›å…¥è¢«è·¯ç”±å‰è¿›å…¥è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¹‹åä¼šè¿›è¡Œè·¯ç”±</li><li>LOCAL_IN åœ¨æ•°æ®åŒ…è¢«è·¯ç”±ä¹‹åï¼Œåˆ¤å®šç›®çš„åœ°å€æ˜¯æœ¬æœºï¼Œä¼šè¿›å…¥è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¹‹åä¼šå°†æ•°æ®åŒ…ä¼ é€’ç»™åº”ç”¨ç¨‹åº</li><li>FORWARD åœ¨æ•°æ®åŒ…è¢«è·¯ç”±ä¹‹åï¼Œåˆ¤å®šç›®çš„åœ°å€ä¸æ˜¯æœ¬æœºï¼Œä¼šè¿›å…¥è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¹‹åä¼šé‡æ–°è·¯ç”±ï¼Œå°†æ•°æ®åŒ…ä¼ é€’å‡ºå»</li><li>LOCAL_OUT åº”ç”¨ç¨‹åºå‘å‡ºæ•°æ®åŒ…ï¼Œè¿˜æ²¡æœ‰è·¯ç”±å‰ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¹‹åä¼šè¿›è¡Œè·¯ç”±</li><li>POST_ROUTING åœ¨åº”ç”¨ç¨‹åºï¼Œæˆ–è€… FORWARD å‘å‡ºçš„æ•°æ®åŒ…è·¯ç”±ä¹‹åè¿›å…¥è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹åä¼šå°†æ•°æ®åŒ…å‘é€å‡ºå»</li></ul><h2 id="iptables-è¡¨å’Œé“¾"><a href="#iptables-è¡¨å’Œé“¾" class="headerlink" title="iptables è¡¨å’Œé“¾"></a>iptables è¡¨å’Œé“¾</h2><p>iptables æœ‰â€å››è¡¨äº”é“¾â€æ¥ç®¡ç†æ•°æ®åŒ…çš„è§„åˆ™å’ŒåŠ¨ä½œ</p><ul><li>äº”é“¾ï¼Œå¯¹åº”ä¸Šå›¾ä¸­äº”ä¸ªæ©™è‰²çš„ hooksï¼Œ<ul><li>PREROUTING å¯¹åº” PRE_ROUTING hooks</li><li>INPUT å¯¹åº” LOCAL_IN hooks</li><li>FORWARD å¯¹åº” FORWARD hooks</li><li>OUTPUT å¯¹åº” LOCAL_OUT hooks</li><li>POSTROUTING å¯¹åº” POST_ROUTING hooks</li></ul></li><li>å››è¡¨ï¼Œå°†é“¾ä¸Šçš„åŠ¨ä½œæŒ‰ç…§ä¸åŒçš„ç±»åˆ«åˆ†æˆäº†4å¼ è¡¨ï¼Œä¼˜å…ˆçº§ä¾æ¬¡æ˜¯ Raw-&gt;Mangle-&gt;NAT-&gt;Filter<ul><li>Rawï¼Œå†³å®šæ•°æ®åŒ…æ˜¯å¦è¢«çŠ¶æ€è·Ÿè¸ªæœºåˆ¶å¤„ç†</li><li>Mangleï¼Œç”¨æ¥ä¿®æ”¹æ•°æ®åŒ…çš„ TOSã€TTL é…ç½®</li><li>NATï¼Œç”¨æ¥ä¿®æ”¹æ•°æ®åŒ…çš„ Ip åœ°å€å’Œç«¯å£ç­‰ä¿¡æ¯ï¼Œåšç½‘ç»œåœ°å€è½¬æ¢ï¼ˆSNATã€DNATï¼‰</li><li>Filterï¼Œç”¨æ¥è¿‡æ»¤æ•°æ®åŒ…ï¼Œå†³å®šæ•°æ®åŒ…çš„å»ç•™ï¼Œæ¥å—æˆ–è€…æ‹’ç»</li></ul></li></ul><h3 id="è¡¨å’Œé“¾çš„å…³ç³»"><a href="#è¡¨å’Œé“¾çš„å…³ç³»" class="headerlink" title="è¡¨å’Œé“¾çš„å…³ç³»"></a>è¡¨å’Œé“¾çš„å…³ç³»</h3><p>è¡¨å’Œé“¾å±äºå¤šå¯¹å¤šçš„å…³ç³»ï¼Œâ€è¡¨ä¸­æœ‰é“¾ï¼Œé“¾ä¸­æœ‰è¡¨â€</p><table><thead><tr><th></th><th>PREROUTING</th><th>INPUT</th><th>FORWARD</th><th>OUTPUT</th><th>POSTROUTING</th></tr></thead><tbody><tr><td>Raw</td><td>âœ…</td><td></td><td></td><td>âœ…</td><td>âœ…</td></tr><tr><td>Mangle</td><td>âœ…</td><td>âœ…</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr><tr><td>Nat</td><td>âœ…</td><td></td><td></td><td>âœ…</td><td>âœ…</td></tr><tr><td>Filter</td><td></td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr></tbody></table><p>æŒ‰é“¾çš„ç»´åº¦æ¥çœ‹ï¼Œä¸åŒçš„é“¾ä¸­åŒ…å«çš„è¡¨ä¸åŒï¼Œè¯´æ˜æ¯ä¸ªé“¾çš„åŠŸèƒ½ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ PREROUTING é“¾åªåŒ…å« Rawã€Mangleã€Nat ä¸‰ä¸ªè¡¨ä¹Ÿå°±æ˜¯è¯´åªèƒ½é…ç½®è¿™ä¸‰ä¸ªè¡¨çš„åŠ¨ä½œï¼›<br>æŒ‰è¡¨çš„ç»´åº¦æ¥çœ‹ï¼Œä¸åŒçš„è¡¨ä¸­çš„é“¾ä¸æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¡¨æ‰€é…ç½®çš„åŠ¨ä½œåªèƒ½åœ¨ç‰¹å®šçš„é“¾ä¸Šï¼Œæ¯”å¦‚è¯´è¦åš ip åœ°å€è½¬ï¼ˆå³ Nat è¡¨ï¼‰åªå¯ä»¥åœ¨ PREROUTINGã€OUTPUT<br>ã€POSTROUTING ä¸‰ ä¸ªé“¾ä¸Šè¿›è¡Œï¼›é‚£ä¹ˆæ•°æ®åŒ…åœ¨è¿›å…¥ç½‘ç»œåè®®æ ˆçš„è¿‡ç¨‹å°±å˜æˆäº†è¿™æ ·ï¼ˆå…¶ä¸­ hooks æ¢æˆäº†é“¾ï¼‰</p><p><img src="/images/iptables2.png" alt="iptables2"></p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables [-t è¡¨å] COMMAND [è¦æ“ä½œçš„é“¾å] [åŒ¹é…è§„åˆ™] -j [ç›®æ ‡åŠ¨ä½œ]</span><br></pre></td></tr></table></figure><ul><li><p>COMMAND</p><ul><li>-A ï¼šappend æ–°å¢åŠ ä¸€æ¡è§„åˆ™ï¼Œè¯¥è§„åˆ™å¢åŠ åœ¨åŸæœ¬è§„åˆ™çš„æœ€åé¢ã€‚ä¸æ˜¾å¼æŒ‡å®šè¡¨é»˜è®¤ä¸ºfilterè¡¨</li><li>-D ï¼šdelete åˆ é™¤ä¸€æ¡è§„åˆ™</li><li>-I ï¼šinsert æ’å…¥ä¸€æ¡è§„åˆ™ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šé¡ºåºé»˜è®¤æ’å…¥æˆç¬¬ä¸€æ¡è§„åˆ™</li><li>-R ï¼šreplace æ›¿æ¢ä¸€æ¡è§„åˆ™</li><li>-L ï¼šlist æŸ¥çœ‹è§„åˆ™</li></ul></li><li><p>åŒ¹é…è§„åˆ™</p><ul><li>-p ï¼šæŒ‡å®šåŒ¹é…çš„åè®® tcpã€updã€icmpã€all</li><li>-s ï¼šæŒ‡å®šåŒ¹é…æ¥æº IP æˆ–è€…ç½‘æ®µ</li><li>-d ï¼šæŒ‡å®šåŒ¹é…ç›®çš„ IP æˆ–è€…ç½‘æ®µ</li><li>â€“sport ï¼šæŒ‡å®šåŒ¹é…æºç«¯å£ </li><li>â€“dport ï¼šæŒ‡å®šåŒ¹é…ç›®çš„ç«¯å£</li></ul></li><li><p>ç›®æ ‡åŠ¨ä½œ ACCEPTã€DROPã€REJECTã€LOG</p></li></ul><p><a href="https://www.huaweicloud.com/articles/3abf0cf9743f2f582f45e320452596f6.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>æœ€åæœ‰äº›ä¾‹å­å¯ä»¥å‚è€ƒä¸€ä¸‹</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://xie.infoq.cn/article/b0cfe588251d024d9114c84f3" target="_blank" rel="noopener">https://xie.infoq.cn/article/b0cfe588251d024d9114c84f3</a></li><li><a href="https://cloud.tencent.com/developer/article/1619659" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1619659</a></li><li><a href="https://www.huaweicloud.com/articles/3abf0cf9743f2f582f45e320452596f6.html" target="_blank" rel="noopener">https://www.huaweicloud.com/articles/3abf0cf9743f2f582f45e320452596f6.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;iptables æ˜¯ Linux ä¸­ç»å¸¸ä½¿ç”¨çš„é˜²ç«å¢™ï¼Œè¿˜è®°å¾—ä¹‹å‰éƒ¨ç½² Tomcat æœåŠ¡åˆ°ä¸€ä¸ª web æœåŠ¡å™¨éœ€è¦é…ç½®æ–°çš„ iptables
      
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>hexo è¿ç§»åˆ° hugo æ–¹æ¡ˆ-ç»­</title>
    <link href="http://yoursite.com/2021/05/13/hexo%E8%BF%81%E7%A7%BB%E5%88%B0hugo%E6%96%B9%E6%A1%88-%E7%BB%AD/"/>
    <id>http://yoursite.com/2021/05/13/hexoè¿ç§»åˆ°hugoæ–¹æ¡ˆ-ç»­/</id>
    <published>2021-05-13T13:16:15.000Z</published>
    <updated>2021-07-13T12:27:08.589Z</updated>
    
    <content type="html"><![CDATA[<p>å‰é¢ä¸€ç¯‡å°†åšå®¢ä» hexo è¿ç§»åˆ° hugo åœ¨æœ¬åœ°å·²ç»è·‘é€šäº†ï¼Œè¿™ç¯‡å°†è·‘é€šçš„ç¯å¢ƒæ‰“åŒ…åˆ°äº‘ä¸Šã€‚</p><h4 id="1-å°†æ–‡ä»¶ä¸Šä¼ åˆ°-git-ä»“åº“"><a href="#1-å°†æ–‡ä»¶ä¸Šä¼ åˆ°-git-ä»“åº“" class="headerlink" title="1.å°†æ–‡ä»¶ä¸Šä¼ åˆ° git ä»“åº“"></a>1.å°†æ–‡ä»¶ä¸Šä¼ åˆ° git ä»“åº“</h4><p>è¿™ä¸€æ­¥å¯ä»¥è¯´æ˜¯å…ˆåšä¸ªå¤‡ä»½ï¼Œæœ‰å‡ ä¸ªå‘ç‚¹éœ€è¦æ³¨æ„ï¼Œæˆ‘çš„åœ°å€æ˜¯ <a href="https://github.com/panniyuyu/blog-hugo.gitã€‚è¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯å¦‚æœæ²¡æœ‰" target="_blank" rel="noopener">https://github.com/panniyuyu/blog-hugo.gitã€‚è¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯å¦‚æœæ²¡æœ‰</a> git<br>æ‰§è¡Œ hugo server å‘½ä»¤ä¼šæŠ¥é”™ ERROR 2021/03/05 06:10:33 Failed to read Git log: fatal: not a git repository (or any of the parent directories): .git</p><ul><li>æˆ‘ä½¿ç”¨äº† LoveIt çš„ä¸»é¢˜ï¼Œåœ¨ /themes ç›®å½•ä¸‹ï¼Œéœ€è¦åœ¨ git ä»“åº“ä¸­å…³è”å­æ¨¡å—ï¼Œä¸ç„¶çš„è¯ git push ä¸ä¼šå°†ä¸»é¢˜ç›¸å…³çš„æ–‡ä»¶ push ä¸Šå»çš„</li><li>ç”±äºè¦å…³è”å­é¡¹ç›®ï¼Œä¸ºäº†ä¸å—åç»­ä¸»é¢˜ä»“åº“çš„å½±å“ï¼Œæœ€å¥½å…ˆ fork åˆ°è‡ªå·±ä»“åº“ä¸­ä¸€ä»½ï¼Œå­æ¨¡å—å¼•ç”¨è‡ªå·±ä»“åº“çš„å°±å¯ä»¥äº†</li></ul><h4 id="2-åˆ›å»º-Dockerfile"><a href="#2-åˆ›å»º-Dockerfile" class="headerlink" title="2.åˆ›å»º Dockerfile"></a>2.åˆ›å»º Dockerfile</h4><p>Dockerfile ä¹Ÿå¾ˆç®€å•äº†ï¼ŒæŠŠå¤§è±¡è£…å†°ç®±åªéœ€è¦3æ­¥ï¼Œ1.æ‰¾ä¸€ä¸ª golang çš„é•œåƒ 2.å®‰è£… hugo 3.git clone ç¬¬ä¸€æ­¥ä¸Šä¼ çš„æ–‡ä»¶è¿è¡Œèµ·æ¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FROM golang:1.16</span><br><span class="line"></span><br><span class="line">WORKDIR /go/src/</span><br><span class="line"></span><br><span class="line"># install hugo</span><br><span class="line">RUN git clone https://github.com/gohugoio/hugo.git --progress --verbose &amp;&amp; \</span><br><span class="line">    cd hugo &amp;&amp; \</span><br><span class="line">    go install</span><br><span class="line"></span><br><span class="line"># init blog</span><br><span class="line">WORKDIR /usr/local/blog</span><br><span class="line"></span><br><span class="line"># --recursive åŒ…å«å­æ¨¡å—ä¸€èµ·clone</span><br><span class="line">RUN git clone --recursive https://github.com/panniyuyu/blog-hugo.git --progress --verbose</span><br><span class="line"></span><br><span class="line">WORKDIR /usr/local/blog/blog-hugo</span><br><span class="line"></span><br><span class="line">CMD sh run.sh</span><br></pre></td></tr></table></figure><p>é™„ä¸Š run.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">hugo server -p 1313</span><br></pre></td></tr></table></figure><h4 id="3-ä¸Šäº‘"><a href="#3-ä¸Šäº‘" class="headerlink" title="3.ä¸Šäº‘"></a>3.ä¸Šäº‘</h4><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„é˜¿é‡Œäº‘é•œåƒæœåŠ¡ï¼Œæ‰“å¥½çš„é•œåƒä¸Šä¼ ä¸Šå»å†åˆ°äº‘æœåŠ¡å™¨ä¸Šæ‹‰ä¸‹æ¥ï¼Œç„¶åå†æŠŠç¬¬ä¸€æ­¥ä¸­ä¸Šä¼ åˆ° git çš„ä»“åº“æ‹‰ä¸‹æ¥åšæ–‡ä»¶æ˜ å°„ï¼Œæœ€åè¿è¡Œå®¹å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di -p 1313:1313 -v /usr/local/blog/blog-hugo:/usr/local/blog/blog-hugo --name=&apos;blog-hugo&apos; blog-hugo:2021-05-10</span><br></pre></td></tr></table></figure><h4 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><h5 id="å‘1-mac-ä¸Šå®¿ä¸»æœºå’Œå®¹å™¨è§ç½‘ç»œä¸é€š"><a href="#å‘1-mac-ä¸Šå®¿ä¸»æœºå’Œå®¹å™¨è§ç½‘ç»œä¸é€š" class="headerlink" title="å‘1 mac ä¸Šå®¿ä¸»æœºå’Œå®¹å™¨è§ç½‘ç»œä¸é€š"></a>å‘1 mac ä¸Šå®¿ä¸»æœºå’Œå®¹å™¨è§ç½‘ç»œä¸é€š</h5><p>ä¸Šè¿°æ­¥éª¤å®Œæˆåï¼Œé¦–å…ˆå†ä¸Šäº‘ä¹‹å‰æ‰€æœ‰æ­¥éª¤éƒ½åœ¨æœ¬åœ°æï¼Œå¯åŠ¨å®¹å™¨ä¹‹å curl ${dockerIp}:${port} æ˜¯æ²¡æœ‰ååº”çš„ï¼Œéšåè¿›å…¥å®¹å™¨ curl localhost:${port}<br>è¿™æ˜¯æ²¡é—®é¢˜çš„æœ‰HTMLé¡µé¢ï¼Œæ‰€ä»¥é—®é¢˜å°±å‡ºåœ¨å®¿ä¸»æœºå’Œå®¹å™¨ç½‘ç»œä¸é€šï¼Œé€€å‡ºå®¹å™¨åœ¨ mac ä¸Š ping å®¹å™¨çš„ ip æœç„¶æ˜¯ä¸é€šçš„ã€‚mac ç«¯çš„ docker desktop é»˜è®¤æ˜¯<br>ä¸ä½¿ç”¨ç½‘æ¡¥çš„ï¼Œæ‰€ä»¥é»˜è®¤ä¸å®¹å™¨é—´ç½‘ç»œæ˜¯ä¸é€šçš„ <a href="https://docs.docker.com/docker-for-mac/networking/" target="_blank" rel="noopener">è¿™é‡Œ</a> æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œè§£å†³æ–¹æ³•è‡ªè¡Œæœç´¢ï¼Œ<br>æˆ‘æ¯”è¾ƒæ‡’æ²¡æœ‰è§£å†³ï¼Œæ‰‹åŠ¨ç‹—å¤´</p><h5 id="å‘2-hugo-server-å‚æ•°"><a href="#å‘2-hugo-server-å‚æ•°" class="headerlink" title="å‘2 hugo server å‚æ•°"></a>å‘2 hugo server å‚æ•°</h5><p>è¸©åˆ°ç¬¬ä¸€ä¸ªå‘ä»¥åï¼Œè·³è¿‡æœ¬åœ°éƒ¨ç½²çš„é˜¶æ®µï¼Œç›´æ¥ä¸Šäº‘ï¼Œåœ¨è¿è¡Œå®¹å™¨å ping å®¹å™¨ ip ç½‘ç»œæ˜¯é€šçš„ï¼Œå³éªŒè¯äº†å‘1çš„é—®é¢˜æ‰€åœ¨ï¼Œæ¥ç€è¿›è¡Œ curl ${dockerIp}:${port}<br> åè¿˜æ˜¯æ²¡æœ‰å“åº”ï¼Œè¿›å…¥å®¹å™¨ curl æ˜¯æ­£å¸¸çš„ï¼Œè¿™ä¸ªå‘æµªè´¹äº†å¾ˆå¤šçš„æ—¶é—´ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ hugo server å‘½ä»¤çš„ä¸€ä¸ªå‚æ•°æŒ‡å®š hugo ç»‘å®šçš„ä¸»æœºï¼Œå³é»˜è®¤åªæœ‰<br>æœ¬åœ°æ‰å¯ä»¥è®¿é—®ï¼Œå‘½ä»¤å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--bind string            interface to which the server will bind (default &quot;127.0.0.1&quot;)</span><br></pre></td></tr></table></figure><h5 id="å‘3-nginx"><a href="#å‘3-nginx" class="headerlink" title="å‘3 nginx"></a>å‘3 nginx</h5><p>ä¸Šé¢ä¸¤ä¸ªå‘å¡«å®Œåï¼Œä¹‹å‰ hexo çš„åšå®¢æœ‰ Nginx å®¹å™¨åšè½¬å‘ï¼Œå°±è®¡åˆ’åŸæœ‰çš„åŸŸååŠ ä¸€ä¸ª /hugo çš„ path å°±å¯ä»¥ä¸¤ä¸ªå®¹å™¨éƒ½å¯ä»¥ç”¨äº†ï¼Œè¿˜èƒ½çœä¸‹ä¹°åŸŸåçš„é’±ï¼Œç†<br>æƒ³å¾ˆä¸°æ»¡ï¼Œä¹Ÿç¡®å®è¾¾åˆ°äº† æƒ³è¦çš„æ•ˆæœï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œå½“æˆ‘çœ‹æŸä¸€ç¯‡æ–‡ç« æ—¶ï¼Œurl æ˜¯ä¼šå˜çš„å‘€ï¼Œä¸”ä¸è¯´ä¸¤ä¸ªå®¹å™¨ä¸­æ–‡ç« çš„ url æ ¼å¼ä¸ä¸€æ ·ï¼Œå°±ç®—æ–‡ç« çš„ url<br>é…ç½®æˆä¸€æ ·çš„ï¼Œå¯ Nginx ä¸çŸ¥é“å½“å‰è¯·æ±‚æ˜¯æ¥è‡ª hugo è¿˜æ˜¯ hexo æ€ä¹ˆè½¬å‘ï¼Ÿæˆ–è€…å¯ä»¥é…ç½®å…¬ç½‘ ip host å’ŒåŸŸååŒºåˆ†ï¼Œåˆæˆ–è€…æŒ‰ç…§æœ‰æ²¡æœ‰ www å‰ç¼€æ¥è¿›è¡Œè½¬<br>å‘ï¼Œè¿™ä¹Ÿå¤ªæŒ«äº†ï¼Œè¿˜æ˜¯è€å®ä¹°ä¸ªåŸŸåé€šè¿‡ä¸»æœºåè·¯ç”±å§ã€‚</p><h4 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h4><p>è¿™ä¸‰ä¸ªå‘éƒ½å¡«ä¸Šå hugo åšå®¢å°±å¯ä»¥ç”¨äº†ï¼Œå†å‘æ–°çš„æ–‡ç« å°±å¯ä»¥ç›´æ¥ä¸Šä¼ åˆ° git ä¸Šï¼ˆæ–‡ç« åœ¨ content/posts/ ç›®å½•ï¼Œå›¾ç‰‡åœ¨ static/images/ ç›®å½•ï¼‰ï¼Œå†åœ¨<br>æœåŠ¡å™¨ä¸Š git pull ç„¶å hugo å°±çƒ­æ›´æ–°äº†ï¼Œæ¯” hexo è¿˜éœ€è¦ docker restart ä¸€ä¸‹ç®€ç›´å¤ªçˆ½äº†ã€‚å†å±•æœ›ä¸€ä¸‹ï¼Œåç»­æ‰“ç®— hugo å’Œ hexo ä¸€èµ·ç»´æŠ¤ï¼Œå†å†™æ–‡<br>ç« å°±å…ˆä¸å†™å¤´ä¿¡æ¯ï¼Œå› ä¸ºä¸¤è€…å¤´çš„æ ¼å¼ä¸ä¸€æ ·ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªä»“åº“åªå†™ md æ–‡ä»¶ï¼Œpush åˆ°ä»“åº“åè§¦å‘ä¸€ä¸ª pipeline å°† md æ–‡ä»¶æ·»åŠ ä¸åŒæ ¼å¼çš„å¤´ä¿¡æ¯ï¼Œåˆ†åˆ«æ›´<br>æ–°åˆ°å„ä¸ªä»“åº“ä¸­ï¼ˆè¿™å°±æ˜¯ ciï¼‰ï¼Œå†è§¦å‘ä¸€ä¸ª webhook è®¿é—®æœåŠ¡å™¨ä¸Šä¸€ä¸ª http æœåŠ¡ï¼Œå°†æ›´æ–°çš„ hugo å’Œ hexo çš„ æ–‡ç« ä¸‹è½½ä¸‹æ¥ï¼Œhexoå®¹å™¨éœ€è¦é‡å¯ï¼ˆè¿™æ­¥æ˜¯<br>cdï¼‰ï¼Œè¿™æ · cicd éƒ½æœ‰äº†ï¼Œå°±åšåˆ°äº†å…¨è‡ªåŠ¨ï¼Œå“ˆå“ˆï¼Œåé¢æœ‰æ—¶é—´</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‰é¢ä¸€ç¯‡å°†åšå®¢ä» hexo è¿ç§»åˆ° hugo åœ¨æœ¬åœ°å·²ç»è·‘é€šäº†ï¼Œè¿™ç¯‡å°†è·‘é€šçš„ç¯å¢ƒæ‰“åŒ…åˆ°äº‘ä¸Šã€‚&lt;/p&gt;
&lt;h4 id=&quot;1-å°†æ–‡ä»¶ä¸Šä¼ åˆ°-git-ä»“åº“&quot;&gt;&lt;a href=&quot;#1-å°†æ–‡ä»¶ä¸Šä¼ åˆ°-git-ä»“åº“&quot; class=&quot;headerlink&quot; title=&quot;1.å°†æ–‡ä»¶ä¸Šä¼ åˆ°
      
    
    </summary>
    
      <category term="hugo" scheme="http://yoursite.com/categories/hugo/"/>
    
    
      <category term="hugo" scheme="http://yoursite.com/tags/hugo/"/>
    
  </entry>
  
  <entry>
    <title>æ²¡æœ‰å®è·µå°±ä¸ç®—å…¥é—¨ Istio</title>
    <link href="http://yoursite.com/2021/05/08/Istio%E6%B5%81%E9%87%8F%E7%AE%A1%E7%90%86%E7%AE%80%E5%8D%95%E5%AE%9E%E8%B7%B5/"/>
    <id>http://yoursite.com/2021/05/08/Istioæµé‡ç®¡ç†ç®€å•å®è·µ/</id>
    <published>2021-05-08T07:28:20.000Z</published>
    <updated>2021-07-13T12:27:08.583Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h3><p>Istio æ˜¯å¦‚ä½•ä½¿ç”¨ç½‘å…³è¿›è¡Œæµé‡æ§åˆ¶çš„å‘¢ï¼Ÿç»è¿‡ä¸¤å¤©çš„å®éªŒå’Œç ”ç©¶ï¼Œæœ‰äº†ä¸€ä¸ªç®€å•çš„è®¤è¯†ï¼Œè®°å½•ä¸€ä¸‹å­</p><p>Istio ä½œä¸ºæœåŠ¡ç½‘æ ¼çš„æ§åˆ¶é¢é€šè¿‡ä¸€äº›è‡ªå®šä¹‰çš„ CRï¼Œé€šè¿‡å¯¹è¿™äº› CR çš„é…ç½®ï¼Œå¹¶å¯¹è¿™äº› CR å’Œ k8s ä¸­éƒ¨åˆ†èµ„æº listAndWatch ç”Ÿæˆé…ç½®å¹¶ä¸‹å‘ï¼ˆxdsåè®®ï¼‰<br>åˆ°æ•°æ®é¢ï¼Œæ•°æ®é¢æ¥æ”¶åˆ°è¿™äº›é…ç½®å®æ—¶è°ƒæ•´å¯¹æµé‡çš„å¤„ç†é€»è¾‘ï¼Œè¿™æ˜¯å¤§è‡´çš„æµç¨‹ã€‚åœ¨åŸç”Ÿçš„ k8s ä¸­ï¼ŒService å¯ä»¥é€šè¿‡ç­›é€‰ label å°†åº”ç”¨çš„å¤šä¸ªå®ä¾‹æš´éœ²å‡ºå»æ<br>ä¾›æœåŠ¡ï¼ŒService è¿˜å¯ä»¥æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œåœ¨æ­¤åŸºç¡€ä¸Š Istio å®šä¹‰äº†ä¸€äº› CR æ¥æ‰©å±• Service çš„åŠŸèƒ½ï¼Œæœ¬æ–‡å°± Istio é’ˆå¯¹ Http åè®®çš„æµé‡ æ§åˆ¶è¿›è¡Œ<br>å®è·µï¼Œå¯¹ Istio æœ‰ä¸€ä¸ªç®€å•çš„è®¤è¯†ã€‚</p><h3 id="Demo-ç»“æ„"><a href="#Demo-ç»“æ„" class="headerlink" title="Demo ç»“æ„"></a>Demo ç»“æ„</h3><p><img src="/images/istio-1.png" alt="istio-1"></p><p>ä»å³å¾€å·¦çœ‹</p><ul><li>é€šå¸¸ä½¿ç”¨ Deployment æ¥éƒ¨ç½²åº”ç”¨çš„å¤šä¸ªå®ä¾‹å³ä¸šåŠ¡ Podï¼Œå¯¹åº”å›¾ä¸­ business Pod</li><li>åˆ›å»º Service å°†ä¸šåŠ¡ Pod æš´éœ²æä¾›æœåŠ¡ï¼ŒåŒæ—¶å¯ä»¥æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li></ul><p>åˆ°è¿™åªæ˜¯ä½¿ç”¨äº† k8s ä¸­çš„ CRï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è®¿é—® Service çš„ ClusterIp å’Œç«¯å£æ¥è®¿é—®æœåŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰æ›´ç»†è‡´çš„æµé‡æ§åˆ¶çš„åŠŸèƒ½ï¼Œä¸‹é¢å°±å¼€å§‹ä½¿ç”¨ Istio</p><ul><li>éœ€è¦åˆ›å»º VirtualService å’Œ DestinationRule æ¥é…ç½®æµé‡æ§åˆ¶è§„åˆ™</li><li>VirtualService å¯ä»¥é…ç½®ä¸åŒç»´åº¦çš„è·¯ç”±è§„åˆ™å°†æµé‡ä¼ é€’ç»™æŒ‡å®šçš„ Service</li><li>DestinationRule å¯ä»¥é…ç½®è·¯ç”±è§„åˆ™çš„ä¸åŒå­é›†(ç†è§£ä¸º k8s Service ä¸­ Endpoint åˆ†ç»„)ï¼Œä»¥åŠå­é›†çš„å¤åˆ¶å‡è¡¡ç­–ç•¥ï¼Œè¿˜èƒ½é…ç½®å¼‚å¸¸æ£€æµ‹</li><li>è¿˜å¯ä»¥åˆ›å»ºç½‘å…³æ¥è¿›è¡Œæµé‡æ§åˆ¶ï¼ŒIstio é»˜è®¤ä½¿ç”¨ Envoy åšç½‘å…³ï¼ŒåŒæ ·ä½¿ç”¨ Deployment éƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œï¼ˆå›¾ä¸­ gateway Podï¼‰åˆ›å»º Serviceï¼ˆå›¾ä¸­<br>gateway serviceï¼‰æä¾›æœåŠ¡ï¼ŒGateway æ˜¯ Istio çš„ CR é€šè¿‡ç­›é€‰ label å…³è”åˆ°åˆ›å»ºå¥½çš„ç½‘å…³ï¼ŒGateway è§„å®šèƒ½å¤Ÿé€šè¿‡ç½‘å…³çš„æµé‡ï¼Œå¹¶ç»‘å®š VisualService<br>å’Œ DestinationRule çš„è§„åˆ™</li></ul><p>Istio é€šè¿‡ ListAndWatch è¿™äº› CR æ„ŸçŸ¥åˆ°å®ƒä»¬çš„å˜åŒ–é€šçŸ¥ç»™æ•°æ®é¢ï¼ˆsidecar æˆ–è€… Gatewayï¼‰</p><h3 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h3><h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><ul><li>é¦–å…ˆç”¨ Deployment éƒ¨ç½²ä¸€ä¸ª HttpServer çš„ Demoï¼Œæœ‰ä¸¤ä¸ªå®ä¾‹ </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME                        READY   STATUS    RESTARTS   AGE   IP            NODE                  NOMINATED NODE   READINESS GATES</span><br><span class="line">http-sample.default-24tqt   1/1     Running   2          8d    10.0.76.95    op-arsenaldevk8s-03   &lt;none&gt;           1/1</span><br><span class="line">http-sample.default-crkvp   1/1     Running   4          8d    10.0.76.102   op-arsenaldevk8s-07   &lt;none&gt;           1/1</span><br></pre></td></tr></table></figure><ul><li>ç»™ Demo åˆ›å»º Service æš´éœ²æœåŠ¡ï¼Œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">NAME                   TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)             AGE</span><br><span class="line">http-sample--default   ClusterIP   10.0.75.60    &lt;none&gt;        8386/TCP            7d19h</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º Gateway CR ç”¨æ¥æ¥æ”¶æ‰€æœ‰ host çš„è¯·æ±‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1alpha3</span><br><span class="line">kind: Gateway</span><br><span class="line">metadata:</span><br><span class="line">  name: httpsample-gateway</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    istio: ingressgateway # use Istio default gateway implementation ä½¿ç”¨ envoy </span><br><span class="line">  servers:</span><br><span class="line">  - port:</span><br><span class="line">      number: 80</span><br><span class="line">      name: http</span><br><span class="line">      protocol: HTTP</span><br><span class="line">    hosts:</span><br><span class="line">    - &quot;*&quot; // è¢«ç½‘å…³ç®¡ç† hostï¼Œè¿™é‡Œé…ç½®äº†æ‰€æœ‰ï¼›</span><br></pre></td></tr></table></figure><ul><li>Istio é»˜è®¤åœ¨ istio-system ä¸‹åˆ›å»ºäº†ç½‘å…³çš„ Deployment å’Œ Serviceï¼ŒåŒæ · Service é€šè¿‡ç­›é€‰ label å…³è” Deployment çš„å®ä¾‹ </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">kubectl get deployment -n istio-system</span><br><span class="line">NAME                   READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">istio-ingressgateway   2/2     2            2           28d</span><br><span class="line"></span><br><span class="line">ubectl get svc -n istio-system</span><br><span class="line">NAME                   TYPE           CLUSTER-IP    EXTERNAL-IP   PORT(S)                                                                      AGE</span><br><span class="line">istio-ingressgateway   LoadBalancer   10.0.75.173   &lt;pending&gt;     15021:31214/TCP,80:30611/TCP,443:32529/TCP,15012:32583/TCP,15443:31725/TCP   28d</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º VirtualService ç»‘å®šç½‘å…³</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway // ç»‘å®šç½‘å…³ï¼Œè¢«ç»‘å®šçš„ç½‘å…³ä½¿ç”¨è¯¥ VirtualService é…ç½®çš„è§„åˆ™è¿›è¡Œæµé‡æ§åˆ¶</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos; // é’ˆå¯¹æŸä¸ª host çš„åº”ç”¨è·¯ç”±è§„åˆ™ï¼Œå¿…é¡»åŒ…å«åœ¨è¢«ç»‘å®šçš„ç½‘å…³ hosts èŒƒå›´ä¸­ï¼Œé…ç½®æˆä¸€æ ·çš„å°±å¯ä»¥</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º DestinationRule åˆ’åˆ†ä¸¤ä¸ªå­é›†ä¸åŒç‰ˆæœ¬çš„å­é›†ï¼Œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: DestinationRule</span><br><span class="line">spec:</span><br><span class="line">  host: http-sample--default</span><br><span class="line">  subsets: // é€šè¿‡ç­›é€‰ label åˆ’åˆ†ä¸åŒçš„å­é›†ï¼Œlabel æ˜¯åœ¨ä¸šåŠ¡ Pod çš„ Service ä¸­ Label Selector åŸºç¡€ä¸Šå¢åŠ ç‰ˆæœ¬çš„æ ‡ç­¾</span><br><span class="line">  - labels:</span><br><span class="line">      app: http-sample // Service ä¸­ç­›é€‰æ ‡ç­¾çš„æ¡ä»¶</span><br><span class="line">      version: v1 // æ–°å¢çš„ç­›é€‰æ ‡ç­¾çš„æ¡ä»¶</span><br><span class="line">    name: v1</span><br><span class="line">  - labels:</span><br><span class="line">      app: http-sample</span><br><span class="line">      version: v2</span><br><span class="line">    name: v2</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œç»™ Demo çš„ä¸¤ä¸ªå®ä¾‹åˆ†åˆ«æ‰“ä¸Š version æ ‡ç­¾ï¼Œæœ¬æ–‡è§„å®š10.0.76.95çš„ IP æ˜¯v1ï¼Œ10.0.76.102çš„ IP æ˜¯v2ï¼Œå‡†å¤‡å·¥ä½œå®Œæˆ</p><h4 id="è·¯ç”±é…ç½®"><a href="#è·¯ç”±é…ç½®" class="headerlink" title="è·¯ç”±é…ç½®"></a>è·¯ç”±é…ç½®</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default // è·¯ç”±çš„ç›®æ ‡ Serviceï¼Œæµé‡ä¼šè¢«è·¯ç”±åˆ°çš„ Service</span><br><span class="line">        port:</span><br><span class="line">          number: 8386 // è·¯ç”±çš„ç›®æ ‡ Service ç«¯å£</span><br><span class="line">        subset: v2 // è·¯ç”±çš„ç›®æ ‡å­é›†ï¼ŒDestinationRule ä¸­å®šä¹‰çš„å­é›†</span><br><span class="line">        weight: 100 // æµé‡åˆ†é…æƒé‡</span><br></pre></td></tr></table></figure><p>éªŒè¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// è®¿é—®ç½‘å…³çš„ Service</span><br><span class="line">curl http://10.0.75.173</span><br><span class="line">// Demo ç¨‹åºè¿”å›æ—¶é—´ï¼Œhostï¼ŒIP ä¿¡æ¯å¯ä»¥çœ‹åˆ°æµé‡è¢«è·¯ç”±åˆ°äº† v2 å­é›†ä¸Š</span><br><span class="line">hello!Sat, 08 May 2021 05:58:10 UTC,host:http-sample.default-crkvp,ip:10.0.76.102</span><br></pre></td></tr></table></figure><h4 id="åŒ¹é…è§„åˆ™"><a href="#åŒ¹é…è§„åˆ™" class="headerlink" title="åŒ¹é…è§„åˆ™"></a>åŒ¹é…è§„åˆ™</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - match:</span><br><span class="line">    - headers: // åŒ¹é…è¯·æ±‚å¤´ è¿˜æ”¯æŒå‰ç¼€åŒ¹é…(prefix)å’Œæ­£åˆ™åŒ¹é…(regex)</span><br><span class="line">        userpin:</span><br><span class="line">          exact: jason</span><br><span class="line">    - uri: // åŒ¹é… uri è¿˜æ”¯æŒç²¾ç¡®åŒ¹é…(exact)å’Œæ­£åˆ™åŒ¹é…(regex)</span><br><span class="line">        prefix: /tov1</span><br><span class="line">    route: // match çš„è¯·æ±‚è·¯ç”±è§„åˆ™</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">        subset: v1</span><br><span class="line">  - match:</span><br><span class="line">    - headers: // åŒ¹é…è¯·æ±‚å¤´ è¿˜æ”¯æŒå‰ç¼€åŒ¹é…(prefix)å’Œæ­£åˆ™åŒ¹é…(regex)</span><br><span class="line">        userpin:</span><br><span class="line">          exact: yywang // è¿™é‡Œå¦‚æœæ˜¯ jason ä¼šä¼˜å…ˆåŒ¹é…åˆ°ä¸Šæ¡è§„åˆ™</span><br><span class="line">      uri:</span><br><span class="line">        prefix: /tov2</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">        subset: v2</span><br><span class="line">  - route: // é»˜è®¤è·¯ç”±è§„åˆ™ï¼Œå³ä¸Šé¢æ²¡æœ‰ match åˆ°ä¼šç›´æ¥è·¯ç”±åˆ° http-sample--default çš„ Service (Demo æš´éœ²çš„ Service)ä¸Š</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br></pre></td></tr></table></figure><p>match ä¸­çš„åŒ¹é…è§„åˆ™ï¼Œåœ¨ä¸åŒçš„æ•°ç»„ä¸‹æ˜¯æˆ–çš„å…³ç³»å¦‚v1çš„é…ç½®ï¼Œç›¸åŒæ•°ç»„ä¸‹æ˜¯ä¸”çš„é»„å…´å¦‚v2çš„é…ç½®</p><p>éªŒè¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// è·¯å¾„åŒ¹é…</span><br><span class="line">curl http://10.0.75.173/tov1</span><br><span class="line">hello!Sat, 08 May 2021 06:15:25 UTC,host:http-sample.default-24tqt,ip:10.0.76.95</span><br><span class="line">// header åŒ¹é…</span><br><span class="line">curl -H &quot;userpin:jason&quot; http://10.0.75.173/</span><br><span class="line">hello!Sat, 08 May 2021 06:15:05 UTC,host:http-sample.default-24tqt,ip:10.0.76.95</span><br><span class="line">// ä¼˜å…ˆåŒ¹é…v1</span><br><span class="line">curl -H &apos;userpin:jason&apos;  http://10.0.75.173/tov2</span><br><span class="line">hello!Sat, 08 May 2021 06:19:48 UTC,host:http-sample.default-24tqt,ip:10.0.76.95</span><br><span class="line">// v2æ˜¯ä¸”çš„å…³ç³»ï¼Œæœ€åèµ°äº†é»˜è®¤è·¯ç”±ä¸¤ä¸ªå®ä¾‹éšæœºè®¿é—®</span><br><span class="line">curl  http://10.0.75.173/tov2</span><br><span class="line">hello!Sat, 08 May 2021 06:19:08 UTC,host:http-sample.default-24tqt,ip:10.0.76.95</span><br><span class="line">curl  http://10.0.75.173/tov2</span><br><span class="line">hello!Sat, 08 May 2021 06:19:09 UTC,host:http-sample.default-24tqt,ip:10.0.76.95</span><br><span class="line">curl  http://10.0.75.173/tov2</span><br><span class="line">hello!Sat, 08 May 2021 06:19:09 UTC,host:http-sample.default-crkvp,ip:10.0.76.102</span><br><span class="line">// åŒ¹é…v2</span><br><span class="line">curl -H &apos;userpin:yywang&apos;  http://10.0.75.173/tov2</span><br><span class="line">hello!Sat, 08 May 2021 06:26:17 UTC,host:http-sample.default-crkvp,ip:10.0.76.102</span><br></pre></td></tr></table></figure><h4 id="æµé‡é•œåƒ"><a href="#æµé‡é•œåƒ" class="headerlink" title="æµé‡é•œåƒ"></a>æµé‡é•œåƒ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - match:</span><br><span class="line">    - uri:</span><br><span class="line">        prefix: /tov1</span><br><span class="line">    mirror:</span><br><span class="line">      host: http-sample--default // æµé‡é•œåƒçš„ç›®æ ‡ Service</span><br><span class="line">      subset: v2 // æµé‡é•œåƒçš„ç›®æ ‡ å­é›†</span><br><span class="line">    mirror_percent: 100 // æµé‡é•œåƒçš„æ¯”ä¾‹</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">        subset: v1</span><br><span class="line">  - match:</span><br><span class="line">      uri:</span><br><span class="line">        prefix: /tov2</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">        subset: v2</span><br><span class="line">  - route: </span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br></pre></td></tr></table></figure><p>éªŒè¯ï¼Œcurl <a href="http://10.0.75.173/tov1" target="_blank" rel="noopener">http://10.0.75.173/tov1</a> åœ¨v2çš„ Pod ä¸ŠæŸ¥çœ‹æ—¥å¿—</p><h4 id="CORS-ç­–ç•¥"><a href="#CORS-ç­–ç•¥" class="headerlink" title="CORS ç­–ç•¥"></a>CORS ç­–ç•¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">        subset: v2</span><br><span class="line">        weight: 100</span><br><span class="line">    corsPolicy:</span><br><span class="line">      allowOrigin:</span><br><span class="line">      - new.com // å…è®¸æµè§ˆå™¨è·¨åŸŸè®¿é—®çš„åœ°å€</span><br><span class="line">      allowMethods:</span><br><span class="line">      - GET // å…è®¸æµè§ˆå™¨è·¨åŸŸè®¿é—®çš„è¯·æ±‚æ–¹æ³•</span><br><span class="line">      maxAge: &quot;2m&quot; // è·¨åŸŸè¯·æ±‚ç¼“å­˜çš„æ—¶é—´</span><br></pre></td></tr></table></figure><p>ç›®å‰æ²¡æœ‰é‡åˆ°è¿™ä¸ªç­–ç•¥çš„åœºæ™¯ï¼Œå°±æ²¡æœ‰åšéªŒè¯ï¼Œæ®äº†è§£ CORS ä¼šç»™åŸè¯·æ±‚æ·»åŠ å¤´ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹è¯·æ±‚å¤´éªŒè¯ï¼Œ<a href="https://zhuanlan.zhihu.com/p/264800677" target="_blank" rel="noopener">å‚è€ƒ</a></p><h4 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - match:</span><br><span class="line">    - uri:</span><br><span class="line">        prefix: /tov1</span><br><span class="line">    redirect:</span><br><span class="line">      uri: /tov2 // é‡å®šå‘çš„è·¯å¾„</span><br><span class="line">      authority: 172.16.26.126:8386 // é‡å®šå‘çš„ä¸»æœºï¼Œä¸é…ç½®å°±æ˜¯å½“å‰ä¸»æœºï¼Œè¿™ä¸ªæ˜¯æˆ‘æœ¬åœ°çš„åœ°å€å’Œç«¯å£</span><br><span class="line">  - match:</span><br><span class="line">      uri:</span><br><span class="line">        prefix: /tov2</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">        subset: v2</span><br></pre></td></tr></table></figure><p>éªŒè¯ï¼šcurl <a href="http://10.0.75.173/tov1" target="_blank" rel="noopener">http://10.0.75.173/tov1</a> æŸ¥çœ‹æœ¬åœ°æ—¥å¿—å‘ç°è¢«è·¯ç”±åˆ°äº†æœ¬åœ°</p><h4 id="é‡å†™"><a href="#é‡å†™" class="headerlink" title="é‡å†™"></a>é‡å†™</h4><p>ç±»ä¼¼äºè¯·æ±‚è½¬å‘ï¼Œæµè§ˆå™¨ URL ä¸ä¼šå˜ï¼Œç”±æœåŠ¡å™¨è½¬å‘æ–°åœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - match:</span><br><span class="line">    - uri:</span><br><span class="line">        prefix: /tov1</span><br><span class="line">    rewrite:</span><br><span class="line">      uri: /print // é‡å†™çš„è·¯å¾„</span><br><span class="line">      authority: 172.16.26.126:8386 // é‡å†™çš„ä¸»æœº</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">        subset: v1</span><br><span class="line">  - match:</span><br><span class="line">      uri:</span><br><span class="line">        prefix: /tov2</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">        subset: v2</span><br></pre></td></tr></table></figure><p>éªŒè¯æ–¹å¼åŒé‡å®šå‘ä¸€æ ·ï¼Œæœ‰ä¸€ç‚¹åŒºåˆ«çš„æ˜¯é‡å†™ä¸‹é¢è¿˜å¯ä»¥é…ç½®è·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰é…ç½®é‡å†™çš„ä¸»æœºåé»˜è®¤ä¼šè·¯ç”±åˆ°ä¸‹é¢çš„å­é›†ï¼Œä¸Šé¢çš„ä¾‹å­å¦‚æœæ²¡æœ‰é…ç½®é‡å†™çš„ä¸»æœºä¼šè·¯ç”±<br>åˆ°v1çš„ /print çš„ path ä¸Š</p><h4 id="é‡è¯•"><a href="#é‡è¯•" class="headerlink" title="é‡è¯•"></a>é‡è¯•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - route: </span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br><span class="line">    retries:</span><br><span class="line">      attempts: 3 // é‡è¯•æ¬¡æ•°</span><br><span class="line">      perTryTimeout: 2s // é‡è¯•è¶…æ—¶ç­‰å¾…æ—¶é—´</span><br><span class="line">      retryOn: 5xx,connect-failure // é‡è¯•æ¡ä»¶ 5xx çŠ¶æ€ç æˆ–è€…è¿æ¥å¤±è´¥</span><br></pre></td></tr></table></figure><p>éªŒè¯ï¼ŒDemo ä¸­æœ‰ä¸€ä¸ªè¿”å›500é”™è¯¯çš„æ–¹æ³•ï¼Œcurl <a href="http://10.0.75.173/error500" target="_blank" rel="noopener">http://10.0.75.173/error500</a> æ‰“å¼€ä¸¤ä¸ª Pod çš„å®ä¾‹è§‚å¯Ÿè¯·æ±‚çš„æ—¥å¿—ï¼ŒåŠ ä¸Šé‡è¯•ä¸€å…±è¯·æ±‚4æ¬¡</p><h4 id="æ•…éšœæ³¨å…¥"><a href="#æ•…éšœæ³¨å…¥" class="headerlink" title="æ•…éšœæ³¨å…¥"></a>æ•…éšœæ³¨å…¥</h4><h5 id="å»¶è¿Ÿæ•…éšœ"><a href="#å»¶è¿Ÿæ•…éšœ" class="headerlink" title="å»¶è¿Ÿæ•…éšœ"></a>å»¶è¿Ÿæ•…éšœ</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - fault:</span><br><span class="line">      delay: // æ³¨å…¥å»¶è¿Ÿæ•…éšœ</span><br><span class="line">        percentage:</span><br><span class="line">          value: 10 // æ³¨å…¥ç™¾åˆ†æ¯”</span><br><span class="line">        fixedDelay: 5s // å»¶è¿Ÿæ—¶é—´</span><br><span class="line">  - route: </span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br></pre></td></tr></table></figure><h5 id="é”™è¯¯æ•…éšœ"><a href="#é”™è¯¯æ•…éšœ" class="headerlink" title="é”™è¯¯æ•…éšœ"></a>é”™è¯¯æ•…éšœ</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: VirtualService</span><br><span class="line">spec:</span><br><span class="line">  gateways:</span><br><span class="line">  - httpsample-gateway</span><br><span class="line">  hosts:</span><br><span class="line">  - &apos;*&apos;</span><br><span class="line">  http:</span><br><span class="line">  - fault:</span><br><span class="line">      abort: // é”™è¯¯æ•…éšœ</span><br><span class="line">        percentage:</span><br><span class="line">          value: 10 // æ³¨å…¥ç™¾åˆ†æ¯” </span><br><span class="line">        httpStatus: 500 // å“åº”çŠ¶æ€ç </span><br><span class="line">  - route: </span><br><span class="line">    - destination:</span><br><span class="line">        host: http-sample--default</span><br><span class="line">        port:</span><br><span class="line">          number: 8386</span><br></pre></td></tr></table></figure><p>curl <a href="http://10.0.75.173" target="_blank" rel="noopener">http://10.0.75.173</a> å³å¯éªŒè¯</p><h4 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h4><p>Istio é™¤äº† Service æœ¬èº«å¸¦æœ‰çš„è´Ÿè½½å‡è¡¡ï¼Œåœ¨ DestinationRule ä¸­å¯ä»¥é…ç½®å­é›†çš„è´Ÿè½½å‡è¡¡ï¼Œæ”¯æŒæ›´å¤šç®—æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: DestinationRule</span><br><span class="line">spec:</span><br><span class="line">  host: http-sample--default</span><br><span class="line">  subsets:</span><br><span class="line">  - labels:</span><br><span class="line">      version: v1</span><br><span class="line">      app: http-sample</span><br><span class="line">    name: v1</span><br><span class="line">    trafficPolicy:</span><br><span class="line">      lodaBalancer: // è´Ÿè½½å‡è¡¡é…ç½®</span><br><span class="line">        simple: ROUND_ROBIN // è½®è¯¢è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œè¿˜æ”¯æŒéšæœºç®—æ³•(RANDOM)ï¼Œæœ€å°‘è¿æ¥(LEAST_CONN)ï¼Œç›´æ¥è½¬å‘(PASSTHROUTE)</span><br></pre></td></tr></table></figure><h4 id="å¼‚å¸¸æ£€æµ‹-ç†”æ–­é™æµ"><a href="#å¼‚å¸¸æ£€æµ‹-ç†”æ–­é™æµ" class="headerlink" title="å¼‚å¸¸æ£€æµ‹ - ç†”æ–­é™æµ"></a>å¼‚å¸¸æ£€æµ‹ - ç†”æ–­é™æµ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apiVersion: networking.istio.io/v1beta1</span><br><span class="line">kind: DestinationRule</span><br><span class="line">spec:</span><br><span class="line">  host: http-sample--default</span><br><span class="line">  subsets:</span><br><span class="line">  - labels:</span><br><span class="line">      version: v1</span><br><span class="line">      app: http-sample</span><br><span class="line">    name: v1</span><br><span class="line">  - labels:</span><br><span class="line">      version: v2</span><br><span class="line">      app: http-sample</span><br><span class="line">    name: v2</span><br><span class="line">  trafficPolicy:</span><br><span class="line">    connectionPool:</span><br><span class="line">      http:</span><br><span class="line">        http1MaxPendingRequests: 1 // æœ€å¤§è¯·æ±‚ç­‰å¾…æ•°</span><br><span class="line">        maxRequestsPerConnection: 1 // æ¯ä¸ªè¿æ¥æœ€å¤§è¯·æ±‚æ•°</span><br><span class="line">      tcp:</span><br><span class="line">        macConnections: 1 // æœ€å¤§è¿æ¥æ•°</span><br><span class="line">    outlierDetection:</span><br><span class="line">      baseEjectionTime: 100s // åŸºç¡€ç†”æ–­æ—¶é—´ï¼Œå®é™…æ—¶é—´æ˜¯ = åŸºç¡€ç†”æ–­æ—¶é—´ x ç†”æ–­æ¬¡æ•°</span><br><span class="line">      consecutiveErrors: 1 // è§¦å‘ç†”æ–­çš„è¿ç»­é”™è¯¯æ¬¡æ•°</span><br><span class="line">      maxEjectionPercent: 100 // ç†”æ–­å®ä¾‹çš„æ¯”ä¾‹ï¼Œ100%å³ä¸ºæ‰€æœ‰å®ä¾‹éƒ½å¯ä»¥åŒæ—¶ç†”æ–­</span><br></pre></td></tr></table></figure><p>éªŒè¯ï¼Œè¿™é‡Œé€šè¿‡ fortio éªŒè¯äº†é™æµï¼Œå†é«˜äº5ä¸ªè¿æ¥å¹¶å‘çš„æƒ…å†µä¸‹ä¼šæœ‰éƒ¨åˆ†è¯·æ±‚å¤±è´¥è¢«é™æµï¼Œç†”æ–­è¿˜è¿˜ä¸çŸ¥é“æ€ä¹ˆéªŒè¯ï¼Œæ„Ÿè§‰åº”è¯¥æ²¡é—®é¢˜åé¢éªŒè¯äº†å†è¡¥å……ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fortio load -c 5 -qps 0 -n 100 -loglevel Warning http://10.0.75.173</span><br><span class="line">17:45:28 I logger.go:127&gt; Log level is now 3 Warning (was 2 Info)</span><br><span class="line">Fortio 1.14.1 running at 0 queries per second, 8-&gt;8 procs, for 100 calls: http://10.0.75.173</span><br><span class="line">Starting at max qps with 5 thread(s) [gomax 8] for exactly 100 calls (20 per thread + 0)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:28 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:29 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:29 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:29 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:29 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:29 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:29 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">17:45:29 W http_client.go:781&gt; Parsed non ok code 503 (HTTP/1.1 503)</span><br><span class="line">Ended after 181.75592ms : 100 calls. qps=550.19</span><br><span class="line">Aggregated Function Time : count 100 avg 0.0084987707 +/- 0.003829 min 0.003318402 max 0.01871654 sum 0.849877069</span><br><span class="line"># range, mid point, percentile, count</span><br><span class="line">&gt;= 0.0033184 &lt;= 0.004 , 0.0036592 , 8.00, 8</span><br><span class="line">&gt; 0.004 &lt;= 0.005 , 0.0045 , 15.00, 7</span><br><span class="line">&gt; 0.005 &lt;= 0.006 , 0.0055 , 26.00, 11</span><br><span class="line">&gt; 0.006 &lt;= 0.007 , 0.0065 , 44.00, 18</span><br><span class="line">&gt; 0.007 &lt;= 0.008 , 0.0075 , 58.00, 14</span><br><span class="line">&gt; 0.008 &lt;= 0.009 , 0.0085 , 64.00, 6</span><br><span class="line">&gt; 0.009 &lt;= 0.01 , 0.0095 , 73.00, 9</span><br><span class="line">&gt; 0.01 &lt;= 0.011 , 0.0105 , 75.00, 2</span><br><span class="line">&gt; 0.011 &lt;= 0.012 , 0.0115 , 80.00, 5</span><br><span class="line">&gt; 0.012 &lt;= 0.014 , 0.013 , 88.00, 8</span><br><span class="line">&gt; 0.014 &lt;= 0.016 , 0.015 , 94.00, 6</span><br><span class="line">&gt; 0.016 &lt;= 0.018 , 0.017 , 98.00, 4</span><br><span class="line">&gt; 0.018 &lt;= 0.0187165 , 0.0183583 , 100.00, 2</span><br><span class="line"># target 50% 0.00742857</span><br><span class="line"># target 75% 0.011</span><br><span class="line"># target 90% 0.0146667</span><br><span class="line"># target 99% 0.0183583</span><br><span class="line"># target 99.9% 0.0186807</span><br><span class="line">Sockets used: 23 (for perfect keepalive, would be 5)</span><br><span class="line">Jitter: false</span><br><span class="line">Code 200 : 82 (82.0 %)</span><br><span class="line">Code 503 : 18 (18.0 %)</span><br><span class="line">Response Header Sizes : count 100 avg 141.04 +/- 66.08 min 0 max 172 sum 14104</span><br><span class="line">Response Body/Total Sizes : count 100 avg 252.32 +/- 2.533 min 247 max 254 sum 25232</span><br><span class="line">All done 100 calls (plus 0 warmup) 8.499 ms avg, 550.2 qps</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;ç®€è¿°&quot;&gt;&lt;a href=&quot;#ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ç®€è¿°&quot;&gt;&lt;/a&gt;ç®€è¿°&lt;/h3&gt;&lt;p&gt;Istio æ˜¯å¦‚ä½•ä½¿ç”¨ç½‘å…³è¿›è¡Œæµé‡æ§åˆ¶çš„å‘¢ï¼Ÿç»è¿‡ä¸¤å¤©çš„å®éªŒå’Œç ”ç©¶ï¼Œæœ‰äº†ä¸€ä¸ªç®€å•çš„è®¤è¯†ï¼Œè®°å½•ä¸€ä¸‹å­&lt;/p&gt;
&lt;p&gt;Istio ä½œä¸ºæœåŠ¡ç½‘æ ¼çš„æ§
      
    
    </summary>
    
    
      <category term="Istio" scheme="http://yoursite.com/tags/Istio/"/>
    
  </entry>
  
  <entry>
    <title>hexo è¿ç§»åˆ° hugo æ–¹æ¡ˆ</title>
    <link href="http://yoursite.com/2021/03/04/hexo%E8%BF%81%E7%A7%BB%E5%88%B0hugo%E6%96%B9%E6%A1%88/"/>
    <id>http://yoursite.com/2021/03/04/hexoè¿ç§»åˆ°hugoæ–¹æ¡ˆ/</id>
    <published>2021-03-04T07:02:29.000Z</published>
    <updated>2021-07-13T12:27:08.589Z</updated>
    
    <content type="html"><![CDATA[<p>äº‘åŸç”Ÿç¬¬ä¸€æ­¥é¦–å…ˆè¦æ‹¥æŠ± go è¯­è¨€ï¼Œgo è¯­è¨€ç¬¬ä¸€æ­¥é¦–å…ˆä»è¿ç§»åšå®¢å¼€å§‹ï¼Œhugo æ˜¯ç”¨ golang å®ç°çš„é™æ€åšå®¢ç”Ÿæˆå·¥å…·ï¼Œç»™æˆ‘æœ€å¤§çš„å¸å¼•åŠ›æ˜¯ç”Ÿæˆé™æ€èµ„æºçš„é€Ÿåº¦å¾ˆå¿«ï¼Œå¹¶ä¸”æ˜¯çƒ­æ›´æ–°ï¼Œå°±æ˜¯è¯´æˆ‘ä¿®æ”¹äº†æ–‡ç« åä¸éœ€è¦é‡å¯ hugo å°±å¯ä»¥æ›´æ–°åšå®¢çš„çŠ¶æ€ï¼Œè¿™ç®€ç›´å¤ªçˆ½äº†</p><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…</span><br><span class="line">brew install hugo</span><br><span class="line">#</span><br><span class="line">Error: hugo: no bottle available!</span><br><span class="line">You can try to install from source with:</span><br><span class="line">  brew install --build-from-source hugo</span><br><span class="line">Please note building from source is unsupported. You will encounter build</span><br><span class="line">failures with some formulae. If you experience any issues please create pull</span><br><span class="line">requests instead of asking for help on Homebrew&apos;s GitHub, Twitter or any other</span><br><span class="line">official channels.</span><br><span class="line"># æŒ‰ç…§æç¤ºé‡æ–°å®‰è£…</span><br><span class="line">brew install --build-from-source hugo</span><br><span class="line"># éªŒè¯</span><br><span class="line">hugo version </span><br><span class="line"># æˆåŠŸ</span><br><span class="line">Hugo Static Site Generator v0.80.0/extended darwin/amd64 BuildDate: unknown</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºä¸€ä¸ªç½‘ç«™"><a href="#åˆ›å»ºä¸€ä¸ªç½‘ç«™" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç½‘ç«™"></a>åˆ›å»ºä¸€ä¸ªç½‘ç«™</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hugo new site blog-hugo</span><br></pre></td></tr></table></figure><p>ä¼šåœ¨hugoç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª blog-hugo çš„æ–‡ä»¶å¤¹ï¼Œç›®å½•ç»“æ„ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ archetypes</span><br><span class="line">â”‚Â Â  â””â”€â”€ default.md</span><br><span class="line">â”œâ”€â”€ config.toml</span><br><span class="line">â”œâ”€â”€ content</span><br><span class="line">â”œâ”€â”€ data</span><br><span class="line">â”œâ”€â”€ layouts</span><br><span class="line">â”œâ”€â”€ static</span><br><span class="line">â””â”€â”€ themes</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ ä¸»é¢˜"><a href="#æ·»åŠ ä¸»é¢˜" class="headerlink" title="æ·»åŠ ä¸»é¢˜"></a>æ·»åŠ ä¸»é¢˜</h4><p>æˆ‘é€‰ç”¨LoveItçš„ä¸»é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd blog-hugo/themes/</span><br><span class="line">git clone https://github.com/dillonzq/LoveIt.git</span><br><span class="line"># å¤åˆ¶ exampleSite ä¸­çš„æ–‡ä»¶åˆ° blog-hugo ç›®å½•ä¸‹</span><br><span class="line">cp -rf LoveIt/exampleSite/ ../../</span><br><span class="line"># ä¿®æ”¹ä¸»é¢˜ä½ç½®</span><br><span class="line">vim config.toml</span><br><span class="line"># ä¿®æ”¹ themesDir = &quot;themes/&quot;</span><br><span class="line"># å¯åŠ¨ å¿…é¡»è¦åœ¨åˆ›å»ºçš„ Site ç›®å½•ä¸‹ï¼Œå¦æœ‰è¦ -s=xxx æŒ‡å®šç›®å½•</span><br><span class="line">hugo server</span><br></pre></td></tr></table></figure><p><strong>è¸©å‘! å¦‚æœæç¤ºä¿æŒ too many request from balabala â€¦ éœ€è¦åœ¨config.tomlä¸­æ·»åŠ é…ç½® ignoreErrors = [â€œerror-remote-getjsonâ€]</strong></p><h4 id="è¿ç§»åšå®¢"><a href="#è¿ç§»åšå®¢" class="headerlink" title="è¿ç§»åšå®¢"></a>è¿ç§»åšå®¢</h4><ol><li>å¤´ä¿¡æ¯ä¿®æ”¹ï¼Œhexoä¸­çš„å¤´ä¿¡æ¯æˆ‘æ˜¯è¿™æ ·å†™çš„</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">title: 2020 åˆæ˜¯èµ·èµ·è½è½è½è½çš„ä¸€å¹´ </span><br><span class="line">author: YyWang </span><br><span class="line">tags: ç”Ÿæ´»æ‚è°ˆ </span><br><span class="line">categories: ç”Ÿæ´»æ‚è°ˆ</span><br><span class="line">date: 2021-02-08 17:57:12</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>hugo ä¸­å¤´ä¿¡æ¯ä¸ºè¿™æ ·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 2020 åˆæ˜¯èµ·èµ·è½è½è½è½çš„ä¸€å¹´</span><br><span class="line">author: YyWang</span><br><span class="line">authorLink: http://www.yywang.top #æ–°å¢</span><br><span class="line">date: 2021-02-08T17:57:12+08:00 #ä¿®æ”¹æ ¼å¼</span><br><span class="line">lastmod: 2021-02-08T17:57:12+08:00 #æ–°å¢</span><br><span class="line">draft: false #æ–°å¢</span><br><span class="line">tags: [&quot;ç”Ÿæ´»æ‚è°ˆ&quot;] #ä¿®æ”¹æ ¼å¼</span><br><span class="line">categories: [&quot;ç”Ÿæ´»æ‚è°ˆ&quot;] #ä¿®æ”¹æ ¼å¼</span><br><span class="line">featuredImagePreview: #æ–°å¢</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>å½“ç„¶æ˜¯å†™ä»£ç ä¿®æ”¹å•¦ï¼Œå› ä¸ºhexoä¸­çš„æ–‡ç« éƒ½æ²¡ä»¥ â€” å¼€å¤´ï¼Œæ‰€ä»¥æˆ‘å°±ç»Ÿä¸€è¿™ä¸ªæ ¼å¼å¤„ç†äº†ï¼Œ(åˆšå­¦golangå†™çš„å¾ˆç³™ğŸ˜¬)ï¼Œå¤„ç†ä»£ç å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;bufio&quot;</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">&quot;io&quot;</span><br><span class="line">&quot;os&quot;</span><br><span class="line">&quot;path/filepath&quot;</span><br><span class="line">&quot;strings&quot;</span><br><span class="line">&quot;time&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main()&#123;</span><br><span class="line">// è·å–æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶</span><br><span class="line">pathPrefix := &quot;$&#123;pathPrefix&#125;&quot;</span><br><span class="line">files := getAllFiles(pathPrefix)</span><br><span class="line">for _,f := range files &#123;</span><br><span class="line">// å…ˆè¯»æ–‡ä»¶ï¼Œåœ¨å†™æ–‡ä»¶</span><br><span class="line">err := writeFile(f, readFile(f))</span><br><span class="line">if err != nil &#123;</span><br><span class="line">fmt.Printf(&quot;write error %v&quot;, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func readFile(filepath string) []byte&#123;</span><br><span class="line">file, _ := os.OpenFile(filepath, os.O_RDONLY, 0644)</span><br><span class="line">defer file.Close()</span><br><span class="line"></span><br><span class="line">reader := bufio.NewReader(file)</span><br><span class="line">buffer := make([]byte, 0)</span><br><span class="line"></span><br><span class="line">var title, author, tags, categories, date string</span><br><span class="line"></span><br><span class="line">appendFlag := false</span><br><span class="line">for &#123;</span><br><span class="line">line, _, err := reader.ReadLine()</span><br><span class="line">if err != nil &#123;</span><br><span class="line">if err == io.EOF &#123;</span><br><span class="line">appendPre := make([]byte, 0)</span><br><span class="line">appendPre = append(appendPre, &quot;---\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;title: &quot; + title +&quot;\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;author: &quot; + author +&quot;\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;authorLink: http://www.yywang.top\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;date: &quot; + date +&quot;\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;lastmod: &quot; + date +&quot;\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;draft: false\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;tags: [\&quot;&quot;+tags+&quot;\&quot;]\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;categories: [\&quot;&quot;+categories+&quot;\&quot;]\n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;featuredImagePreview: \n&quot;...)</span><br><span class="line">appendPre = append(appendPre, &quot;---\n&quot;...)</span><br><span class="line">return  append(appendPre, buffer...)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">lineStr := string(line[:])</span><br><span class="line">if strings.EqualFold(lineStr, &quot;---&quot;) &#123;</span><br><span class="line">appendFlag = true</span><br><span class="line">continue</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if appendFlag &#123;</span><br><span class="line">// copy</span><br><span class="line">buffer = append(buffer, line...)</span><br><span class="line">buffer = append(buffer, &quot;\n&quot;...)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">i := strings.Index(lineStr, &quot;:&quot;)</span><br><span class="line">if i &gt; 0 &#123;</span><br><span class="line">k := lineStr[0:i]</span><br><span class="line">v := strings.TrimSpace(lineStr[i+1:])</span><br><span class="line">switch k &#123;</span><br><span class="line">case &quot;title&quot;:</span><br><span class="line">title = v</span><br><span class="line">case &quot;author&quot;:</span><br><span class="line">author = v</span><br><span class="line">case &quot;tags&quot;:</span><br><span class="line">tags = v</span><br><span class="line">case &quot;categories&quot;:</span><br><span class="line">categories = v</span><br><span class="line">case &quot;date&quot;:</span><br><span class="line">date = transDataFormat(v, &quot;2006-01-02 15:04:05&quot;, &quot;2006-01-02T15:04:05+08:00&quot;)</span><br><span class="line">default:</span><br><span class="line">fmt.Println(&quot;error switch &quot; + k)</span><br><span class="line">&#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">fmt.Println(&quot;split error &quot; + lineStr)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func getAllFiles(path string) []string &#123;</span><br><span class="line">files := make([]string, 0)</span><br><span class="line">err := filepath.Walk(path, func(path string, f os.FileInfo, err error) error&#123;</span><br><span class="line">if f.IsDir() &#123;</span><br><span class="line">return nil</span><br><span class="line">&#125;</span><br><span class="line">files = append(files, path)</span><br><span class="line">return  nil</span><br><span class="line">&#125;)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">fmt.Printf(&quot;walk file path err info is %v&quot;, err)</span><br><span class="line">&#125;</span><br><span class="line">return files</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func transDataFormat(timeStr string, oldFormat string, newFormat string) string &#123;</span><br><span class="line">date, _ := time.Parse(oldFormat, timeStr)</span><br><span class="line">return date.Format(newFormat)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func writeFile(filePath string, content []byte) error &#123;</span><br><span class="line">f, err := os.OpenFile(filePath, os.O_WRONLY|os.O_TRUNC, 0600)</span><br><span class="line">defer f.Close()</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return err</span><br><span class="line">&#125;</span><br><span class="line">writer := bufio.NewWriter(f)</span><br><span class="line">_, err = writer.Write(content)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return err</span><br><span class="line">&#125;</span><br><span class="line">err = writer.Flush()</span><br><span class="line">if err != nil &#123;</span><br><span class="line">fmt.Printf(&quot;flush error %v&quot;, err)</span><br><span class="line">&#125;</span><br><span class="line">return nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†æ–°ä¿®æ”¹çš„æ–‡ä»¶ç§»åŠ¨åˆ° blog-hugo/content/posts/ ç›®å½•ä¸‹</p><ol start="2"><li>å°†æ–‡ç« ä¸­å¼•ç”¨çš„å›¾ç‰‡ç§»åŠ¨åˆ° blog-hugo/assets/images/ ç›®å½•ä¸‹</li><li>å¦‚æœåœ¨æ–‡ç« ä¸­è¿˜å¼•ç”¨è¿‡å…¶ä»–æ–‡ç« ï¼Œurlä¼šå¤±æ•ˆï¼Œæ‰‹åŠ¨ä¿®æ”¹ä¸‹æˆ–è€…å‚è€ƒ<a href="https://liujiacai.net/blog/2020/12/05/hexo-to-hugo/" target="_blank" rel="noopener">è¿™é‡Œï¼ŒæŸ¥çœ‹æ–‡ä»¶é“¾æ¥</a>å¤„ç†</li></ol><p><strong>åˆ°è¿™é‡Œåšå®¢åŸºæœ¬ä¸Šè¿ç§»å®Œæ¯•äº†ï¼Œé™„ä¸€ä¸ªåˆæ­¥çš„æ•ˆæœå›¾ï¼Œåé¢è¿˜éœ€è¿›ä¸€æ­¥ç¾åŒ–å’Œä¼˜åŒ–ï¼Œç­‰ä¸Šçº¿äº†å†åˆ‡è´Ÿè½½æ›¿æ¢hexo</strong></p><p><img src="/images/hugodemo.png" alt="hugodemodemo"></p><h4 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h4><ul><li>æ‰“åŒ…dockeré•œåƒï¼Œä»¥dockerçš„æ–¹å¼éƒ¨ç½²ï¼Œnginxåˆ‡æ¢è´Ÿè½½</li><li>å¤‡ä»½hugoåšå®¢çš„æ–¹æ¡ˆ</li><li>å‚è€ƒ<a href="https://lewky.cn/tags/hugo/" target="_blank" rel="noopener">è¿™é‡Œ</a>åšå¢å¼º</li><li>æ¢ä¸€å¥—å¤´åƒï¼Œå¤§å›¾å°å›¾å•¥çš„ï¼Œå‚è€ƒä¸»é¢˜ä¸­exampleSiteé‡Œçš„postä»‹ç»ï¼Œ<a href="https://realfavicongenerator.net/" target="_blank" rel="noopener">è¿™ä¸ªç½‘ç«™ç”Ÿæˆå¥—å›¾</a></li><li>æ›´æ¢è¯„è®ºç³»ç»Ÿæ’ä»¶<a href="https://waline.js.org/" target="_blank" rel="noopener">waline</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;äº‘åŸç”Ÿç¬¬ä¸€æ­¥é¦–å…ˆè¦æ‹¥æŠ± go è¯­è¨€ï¼Œgo è¯­è¨€ç¬¬ä¸€æ­¥é¦–å…ˆä»è¿ç§»åšå®¢å¼€å§‹ï¼Œhugo æ˜¯ç”¨ golang å®ç°çš„é™æ€åšå®¢ç”Ÿæˆå·¥å…·ï¼Œç»™æˆ‘æœ€å¤§çš„å¸å¼•åŠ›æ˜¯ç”Ÿæˆé™æ€èµ„æºçš„é€Ÿåº¦å¾ˆå¿«ï¼Œå¹¶ä¸”æ˜¯çƒ­æ›´æ–°ï¼Œå°±æ˜¯è¯´æˆ‘ä¿®æ”¹äº†æ–‡ç« åä¸éœ€è¦é‡å¯ hugo å°±å¯ä»¥æ›´æ–°åšå®¢çš„çŠ¶æ€ï¼Œè¿™ç®€ç›´å¤ªçˆ½äº†&lt;/p&gt;
&lt;h4
      
    
    </summary>
    
      <category term="hugo" scheme="http://yoursite.com/categories/hugo/"/>
    
    
      <category term="hugo" scheme="http://yoursite.com/tags/hugo/"/>
    
  </entry>
  
  <entry>
    <title>2020 åˆæ˜¯èµ·èµ·è½è½è½è½çš„ä¸€å¹´</title>
    <link href="http://yoursite.com/2021/02/08/2020%20%E5%8F%88%E6%98%AF%E8%B5%B7%E8%B5%B7%E8%90%BD%E8%90%BD%E8%90%BD%E8%90%BD%E7%9A%84%E4%B8%80%E5%B9%B4/"/>
    <id>http://yoursite.com/2021/02/08/2020 åˆæ˜¯èµ·èµ·è½è½è½è½çš„ä¸€å¹´/</id>
    <published>2021-02-08T09:57:12.000Z</published>
    <updated>2021-07-13T12:27:08.580Z</updated>
    
    <content type="html"><![CDATA[<p>2021å¹´å·²ç»è¿‡å»äº†39å¤©ï¼Œä¸Šä¸€å¹´çš„æ€»ç»“èµ¶ç´§è¡¥ä¸Šï¼Œå…ˆç›˜ç‚¹ä¸‹ä¹‹å‰ç«‹è¿‡çš„Flagï¼Œç„¶åå†™ä¸€ä¸‹è‡ªå·±çš„å¿ƒè·¯å†ç¨‹å§</p><h3 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h3><p>è¿˜è®°å¾—19å¹´å†™æ€»ç»“çš„æ—¶å€™ç«‹ä¸‹äº†çš„Flagï¼Œä¸€ä¸€ç›˜ç‚¹ä¸€ä¸‹å­</p><h5 id="æ¯æœˆå¹³å‡ä¸¤ç¯‡åšå®¢çš„æ›´æ–°"><a href="#æ¯æœˆå¹³å‡ä¸¤ç¯‡åšå®¢çš„æ›´æ–°" class="headerlink" title="æ¯æœˆå¹³å‡ä¸¤ç¯‡åšå®¢çš„æ›´æ–°"></a>æ¯æœˆå¹³å‡ä¸¤ç¯‡åšå®¢çš„æ›´æ–°</h5><p>  æˆªæ­¢åˆ°æœ€åä¸€ç¯‡æ–‡ç« 11æœˆ17æ—¥ä¸€å…±æœ‰20ç¯‡ï¼Œç¦»24ç¯‡è¿˜å·®ç‚¹æ„æ€ï¼Œå®Œæˆç‡83%å§ï¼Œæ€ä¹ˆç¡•å‘¢~ çœ‹æ•°æ®çš„è¯å¯å°±æ˜¯æ²¡å®Œæˆï¼Œä½†æ˜¯ï¼Œå…¶ä¸­æœ‰4ä¸ªæœˆçš„æ—¶é—´å› ä¸ºä¸€äº›äº‹æƒ…æ²¡æœ‰å†™æ–‡ç« æ›´æ–°ï¼Œå¯ä»¥ç®—æ˜¯åŠæ ¼å§</p><h5 id="åšå®¢å¡«å‘"><a href="#åšå®¢å¡«å‘" class="headerlink" title="åšå®¢å¡«å‘"></a>åšå®¢å¡«å‘</h5><p>  å½“æ—¶è®¡åˆ’è¦å­¦ä¹ ï¼šspring/spring bootã€WALã€è®¾è®¡æ¨¡å¼ã€nettyè¿™äº›ï¼Œå¹¶å†™æ–‡ç« å‡ºæ¥ï¼Œå­¦ä¹ æ˜¯å­¦äº†æ–‡ç« æ²¡å†™ï¼Œæ²¡å•¥å¥½è¯´çš„å¦¥å¦¥æ²¡å®Œæˆ</p><h5 id="éƒ¨é—¨ä¸šåŠ¡æ·±å…¥"><a href="#éƒ¨é—¨ä¸šåŠ¡æ·±å…¥" class="headerlink" title="éƒ¨é—¨ä¸šåŠ¡æ·±å…¥"></a>éƒ¨é—¨ä¸šåŠ¡æ·±å…¥</h5><p>  Flagæ˜¯éƒ¨é—¨ä¸šåŠ¡åƒé€ï¼Œè¿™é‡Œè¯å¤ªæ»¡äº†æˆ‘æ’¤å›ï¼Œåƒé€ç®—ä¸ä¸Šåº”è¯¥è¯´å¾—ä¸Šæ˜¯æ·±å…¥äº†è§£ï¼Œæœ¬æ¥è®¡åˆ’æ˜¯æ¯å¤©çœ‹ä¸€ç‚¹ç‚¹ä¸ç´§ä¸æ…¢çš„èŠ‚å¥ï¼Œåæ¥æœ‰äººç¦»èŒæˆ‘ä»£æ›¿ä»–å€¼ç­ï¼Œé©±åŠ¨æˆ‘ä¸å¾—ä¸åŠ å¿«å­¦ä¹ é€Ÿåº¦ï¼Œæ„Ÿè§‰å·²ç»å®Œå…¨é€‚åº”å·¥ä½œçŠ¶æ€äº†ï¼Œå¦å¤–ä¸‹ä¸€ä»£å¾®æœåŠ¡ä¹Ÿå­¦ä¹ äº†ï¼Œæœ¬æ¥è®¡åˆ’äº†è§£ä¸€äº›èƒ½å¹ç‰›é€¼å°±è¡Œï¼Œåæ¥å‘ç°è¿™ä¸ªè¿˜æŒºæœ‰æ„æ€çš„ä¹Ÿå°±å¤šçœ‹äº†çœ‹ï¼Œæ„å¤–æ”¶è·ï¼Œå“ˆå“ˆï¼Œè¿™ä¸ªæ˜¯è¶…é¢å®Œæˆ</p><h5 id="ä¸€æ¬¡5å¤©ä»¥ä¸Šçš„æ—…è¡Œ"><a href="#ä¸€æ¬¡5å¤©ä»¥ä¸Šçš„æ—…è¡Œ" class="headerlink" title="ä¸€æ¬¡5å¤©ä»¥ä¸Šçš„æ—…è¡Œ"></a>ä¸€æ¬¡5å¤©ä»¥ä¸Šçš„æ—…è¡Œ</h5><p>  å› ä¸ºç–«æƒ…ä¸ŠåŠå¹´çš„å‡æœŸåŸºæœ¬éƒ½æ˜¯åœ¨åŒ—äº¬åº¦è¿‡ï¼Œå›½åº†çš„æ—¶å€™å»ä¸Šæµ·ç©äº†4å¤©ï¼Œå¿ƒç–¼æœºç¥¨é’±é€‰æ‹©å›½åº†åå‡ºé—¨ğŸ¤£ï¼Œè¿™é¡¹ä¹Ÿç®—å®Œæˆäº†å§</p><p>  ç»¼åˆæ¥çœ‹ï¼ŒFlagå®Œæˆæƒ…å†µå¯ä»¥è¯´æ˜¯åŠæ ¼å§ï¼Œæ¯•ç«Ÿè®¡åˆ’å¾€å¾€æ˜¯èµ¶ä¸ä¸Šå˜åŒ–çš„ï¼Œå¿ƒé‡Œè®°ç€ç›®æ ‡åŠªåŠ›å»å®Œæˆå°±å¥½ï¼ŒFlagä¹Ÿè®¾å®šçš„ç¨å¾®å¤§ä¸€äº›ï¼Œåæ­£æœ€åè‚¯å®šå®Œä¸æˆï¼Œç»“æœè‚¯å®šä¼šæ¯”ä½é¢„æœŸçš„Flagè¦å¥½å¾ˆå¤š~</p><h3 id="å°ç®—ç›˜"><a href="#å°ç®—ç›˜" class="headerlink" title="å°ç®—ç›˜"></a>å°ç®—ç›˜</h3><p>  ä»å‚åŠ å·¥ä½œä»¥æ¥ï¼Œå·¥ä½œå†…å®¹ä¸€ç›´éƒ½æ˜¯åå°ç³»ç»Ÿçš„ä¼˜åŒ–å’Œç»´æŠ¤ï¼Œç”³è¯·ä¸åˆ°å‰ç«¯èµ„æºç”šè‡³è¿å‰ç«¯é¡µé¢ä¹Ÿå†™ï¼Œæ›´åƒä¸€ä¸ªå…¨æ ˆã€‚è¿™ä¸ªå·¥ä½œå†…å®¹å’Œè¯»ç ”æ—¶æœŸä¸€æ¨¡ä¸€æ ·ï¼Œè€Œä¸”å·¥ä½œæ°›å›´æœ‰äº›å°é—­æ„Ÿè§‰æˆ‘æ›´åƒå¤–åŒ…ä¸€æ ·ï¼Œé“ç†æˆ‘éƒ½æ‡‚ï¼Œè¿™äº›æ´»æ€»è¦æœ‰äººæ¥åšï¼Œæˆ‘æ˜¯æ–°äººå½“ç„¶æ˜¯æˆ‘æ¥åšï¼Œç­‰å†æœ‰æ–°äººæ¥æˆ‘ä¸å°±è§£æ”¾äº†å˜›ï¼Œå°±è¿™æ ·æˆ‘æ‰“èµ·äº†è‡ªå·±çš„å°ç®—ç›˜ğŸ˜¬ï¼Œå¯åé¢è¦åšäº›ä»€ä¹ˆæˆ‘ä¸çŸ¥é“ï¼Œæˆ‘å°±çœ‹èº«è¾¹çš„å¤§ä½¬æä»€ä¹ˆå°±æƒ³åŠæ³•å¾€é‚£è¾¹å»é ï¼Œåšç€è„¸çš®è·Ÿç€å¤§ä½¬å»åšä¸€ä¸ªoperatorçš„é¡¹ç›®ï¼Œä¹Ÿå°±ä»è¿™å¼€å§‹æˆ‘æ¥è§¦åˆ°äº†k8så’Œäº‘åŸç”Ÿå‘ç°è¿™çœŸæ˜¯ä¸€ä¸ªç¥å¥‡çš„ä¸œè¥¿</p><h3 id="æ‰“æ‚çš„ï¼Ÿ"><a href="#æ‰“æ‚çš„ï¼Ÿ" class="headerlink" title="æ‰“æ‚çš„ï¼Ÿ"></a>æ‰“æ‚çš„ï¼Ÿ</h3><p>  å°±åœ¨å¿«æœ‰æ–°äººæ¥ä¹‹å‰ï¼Œæˆ‘çš„è®¡åˆ’ä¹ŸæŒ‰éƒ¨å°±ç­çš„æ¥ï¼Œæ‰¾è€æ¿æå‡ºæˆ‘çš„æƒ³æ³•å»åšäº‘åŸç”Ÿçš„é¡¹ç›®æˆ–è€…SDKï¼Œä¸æ–™è¢«é©³å›äº†ï¼Œç†ç”±æ˜¯è¿™ä¸¤ä¸ªé¡¹ç›®éƒ½ä¸ç¼ºäººï¼Œç„¶åå®‰æ’æˆ‘åšå¦å¤–ä¸€ä¸ªé¡¹ç›®ï¼Œå¸Œæœ›ç ´ç­ï¼Œåœ¨æ–°çš„é¡¹ç›®é‡Œå€’æ˜¯ä¸ç”¨å†™å‰ç«¯äº†ï¼Œå¯è¿˜æ˜¯ä¸€ä¸ª API Boy åœ¨æˆ‘çœ‹æ¥å·¥ä½œå†…å®¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰å¥½çš„æœºä¼šå°±åšå§è¿˜èƒ½å’‹çš„ã€‚åæ¥ï¼Œæ™‹å‡ç­”è¾©T2-&gt;T3ï¼Œä»¥å¾€éƒ½ä¸éœ€è¦ç­”è¾©ä»Šå¹´ä¸çŸ¥æ€ä¹ˆäº†ï¼Œæˆ‘æ±‡æŠ¥äº†ä¸€å¹´çš„å·¥ä½œï¼Œå°ä¸‹ä¸€ä¸ªè¯„å§”è¯´æ„Ÿè§‰ä½ åƒæ‰“æ‚çš„ï¼Œç»“æœæ²¡è¿‡ï¼Œå¿ƒæƒ³æˆ‘ä¸€ä¸ªT2ä¸æ‰“æ‚å¹²ä»€ä¹ˆï¼Œè®©æˆ‘åšT10çš„æ´»å—ï¼Ÿ</p><h3 id="æ‰“æ‚çš„ï¼"><a href="#æ‰“æ‚çš„ï¼" class="headerlink" title="æ‰“æ‚çš„ï¼"></a>æ‰“æ‚çš„ï¼</h3><p>  æˆ‘ä¸ºè‡ªå·±æ„Ÿåˆ°ä¸å…¬ï¼Œä¾¿å¼€å§‹æ‰¾æ–°çš„æœºä¼šï¼ŒæœŸé—´è¾¹çœ‹æœºä¼šè¾¹å‡†å¤‡ä¹Ÿå°±ç©ºå‡º3ä¸ªæœˆæ²¡æœ‰æ›´æ–°æ–‡ç« ï¼ŒåŸå› åœ¨è¿™ğŸ¤£ï¼Œèµ·åˆè¿˜æ˜¯æŒ‰ç…§åŸºç¡€æ¶æ„è¿™ä¸ªæ–¹å‘å»æ‰¾ï¼Œæ¯•ç«Ÿåšäº†æœ‰1å¹´çš„æ—¶é—´æƒ³åœ¨è¿™ä¸ªæ–¹å‘å¤šæ·±å…¥ä¸€äº›ï¼Œåˆšå¼€å§‹è¿˜æ˜¯ä¸€ç›´ç¢°å£ï¼Œç®€å†ä¸è¿‡çš„ï¼Œç†è§£æ·±åº¦ä¸å¤Ÿçš„ï¼Œè‡ªå·±æš´éœ²çš„é—®é¢˜æœ‰å¾ˆå¤šï¼Œå› ä¸ºæˆ‘è¯´æƒ³åšä¸€äº›æ›´æœ‰æŒ‘æˆ˜æ€§çš„å·¥ä½œï¼Œè¢«çµé­‚æ‹·é—®ä½ æƒ³åšä»€ä¹ˆçš„æ—¶å€™ï¼Œæˆ‘è„‘å­ä¸€ç‰‡ç©ºç™½ï¼Œåªæ˜¯æœ‰æƒ³æ³•ä½†åšä»€ä¹ˆå´ä¸çŸ¥é“ï¼Œè¿™ç®—ä»€ä¹ˆï¼ŒæŠ•é€’ç®€å†å¾ˆå¤šéƒ½æ˜¯ä¸è¿‡çš„ï¼Œç®€å†è¿‡äº†é¢è¯•çš„é—®é¢˜ä¹Ÿç­”ä¸å¥½ï¼Œæˆ‘è¿™ä¸€å¹´åˆ°åº•å¹²äº†ä»€ä¹ˆï¼Ÿç»“è®ºï¼šæˆ‘è¿™ä¸€å¹´å…‰æ‰“æ‚äº†ï¼Œå°±æ˜¯ä¸€ä¸ªæ‰“æ‚çš„ï¼</p><h3 id="è‡ªçœ"><a href="#è‡ªçœ" class="headerlink" title="è‡ªçœ"></a>è‡ªçœ</h3><p>  è‡ªæˆ‘åçœä¸€ä¸‹ï¼Œè‡ªå·±ç¡®å®æ˜¯ä¸ªæ‰“æ‚çš„ï¼Œå·¥ä½œå†…å®¹æ²¡æœ‰äº®ç‚¹ï¼Œé¦–å…ˆæˆ‘è¦æ˜ç¡®è‡ªå·±æƒ³åšä»€ä¹ˆï¼Œä¸šåŠ¡è¿˜æ˜¯åŸºç¡€æ¶æ„ï¼Ÿä¸šåŠ¡æ¥è§¦çš„æŠ€æœ¯å¹¿ï¼Œæœºä¼šå¤šï¼Œå¥½çš„ä¸šåŠ¡å¾€å¾€ç»©æ•ˆä¹Ÿå¥½ï¼Œç›¸åº”çš„å‹åŠ›ä¼šå¤§ä¸€äº›ï¼›åŸºç¡€æ¶æ„æ–¹å‘æœ‰æŠ€æœ¯çš„æ·±åº¦ï¼Œç»©æ•ˆå¾€å¾€ä¸€èˆ¬ï¼›ç›¸æ¯”ä¹‹ä¸‹æˆ‘æ›´å–œæ¬¢åŸºç¡€æ¶æ„å¤šä¸€äº›ï¼Œæ›´å–œæ¬¢åç ”ç©¶ç±»å‹çš„å·¥ä½œï¼Œç»è¿‡é¢è¯•çœ‹ä¸‹æ¥åŸºç¡€æ¶æ„å¾€å¾€éœ€æ±‚å·¥ä½œç»éªŒä¸°å¯Œçš„äººï¼Œæˆ‘æ‰“æ‚ä¸€å¹´å¸Œæœ›æ¸ºèŒ«ï¼›æˆ‘é€‰æ‹©å…ˆæ‰¾ä¸šåŠ¡æ–¹å‘å·¥ä½œä¸€æ®µæ—¶é—´å†å…¥å‘åŸºç¡€æ¶æ„ï¼Œè¿™æ ·å¸Œæœ›å¤§äº›ï¼Œéšåæˆ‘æŠ•é€’äº†ä¸šåŠ¡æ–¹å‘çš„å²—ä½ï¼Œæœ€ç»ˆæ‹¿åˆ°äº†ç¾å›¢çš„offerï¼Œå½“æ—¶å·²ç»è¿›å…¥ç¬¬4å­£åº¦åŠ ä¸Šæˆ‘å¹´é™å°‘æ¶¨å¹…ä¹Ÿæ²¡æœ‰åˆ°é¢„æœŸï¼Œå†³å®šå¹´åº•å†çœ‹ï¼Œè¿™ä¸ªé˜¶æ®µæˆ‘æ˜ç¡®äº†æˆ‘æƒ³è¦ä»€ä¹ˆï¼Œæœ‰äº†çŸ­æœŸçš„è§„åˆ’</p><h3 id="å‰è¡Œ"><a href="#å‰è¡Œ" class="headerlink" title="å‰è¡Œ"></a>å‰è¡Œ</h3><p>  æœ‰äº†è§„åˆ’å¼€å§‹æŒ‰éƒ¨å°±ç­çš„èµ°ï¼Œå·¥ä½œä¹‹ä½™æ¯å¤©æŠ½å‡ºæ—¶é—´åˆ·é¢˜ã€å­¦ä¹ ç»™è‡ªå·±å……ç”µï¼Œè®¡åˆ’æ˜¯è¿‡å®Œå¹´å†å¼€å§‹æ‰¾æœºä¼šï¼Œåˆ°äº†12æœˆå‡ ä¹æ¯å¤©éƒ½æœ‰5ä¸ªçŒå¤´æˆ–è€…hrè¦ç®€å†ï¼Œæ„Ÿè§‰éœ€æ±‚é‡å¾ˆå¤§ï¼Œéšä¹‹è°ƒæ•´è®¡åˆ’ï¼Œå¡«é¸­å¼çš„å­¦ä¹ ï¼Œæ‰“ç®—åœ¨å¹´å‰æŠŠè¿™äº‹æå®šï¼Œè¿™ä¸€ä¸ªæœˆæˆ‘ä¹Ÿæ²¡æ›´æ–°æ–‡ç« ğŸ˜¬ï¼Œä»å…ƒæ—¦åå¼€å§‹æŠ•é€’ç®€å†ï¼Œæœ‰äº†å……åˆ†çš„å‡†å¤‡ï¼Œè¿™æ¬¡ç»“æœè¿˜ä¸é”™ï¼Œæ”¶åˆ°äº†3å®¶offerï¼Œå…¶ä»–çš„5å®¶ä¹Ÿéƒ½é€šè¿‡3é¢ï¼Œè¿˜æœ‰ä¸€å®¶æ˜¯æˆ‘ä¸»åŠ¨æ”¾å¼ƒçš„ï¼Œè¿™ç»“æœæˆ‘è¿˜æ˜¯å¾ˆæ¬£æ…°çš„ï¼Œå…¶ä¸­æ‹’äº†ç™¾åº¦ï¼ˆæ„Ÿè§‰æ²¡æœ‰è¯šæ„ï¼‰ï¼Œæ‹’äº†é˜¿é‡Œï¼ˆçº ç»“äº†å¾ˆä¹…ï¼‰ï¼Œæœ€ç»ˆé€‰æ‹©ä¸€ä¸ªè§„æ¨¡ä¸å¤§çš„ç‹¬è§’å…½ï¼Œåšäº‘åŸç”ŸåŸºç¡€æ¶æ„ï¼ˆä¸å¿˜åˆå¿ƒå§ï¼‰</p><h3 id="äº‘åŸç”Ÿ-GO-GO-GO"><a href="#äº‘åŸç”Ÿ-GO-GO-GO" class="headerlink" title="äº‘åŸç”Ÿ GO GO GO"></a>äº‘åŸç”Ÿ GO GO GO</h3><p>   è‡ªå·±ä¹Ÿæ²¡æƒ³åˆ°ä¼šæœ‰é€‰offerçš„ä¸€å¤©ï¼Œæœ¬æ¥å¹»æƒ³ç€å»å¿«æ‰‹æŒ£å¿«é’±ï¼ŒäºŒé¢ä¸€ä¸ªåŠå°æ—¶3é“ç®—æ³•é¢˜ä¹Ÿéƒ½åšäº†ï¼Œè«åå…¶å¦™çš„å°±æŒ‚äº†ï¼Œå¢¨è²å®šå¾‹ï¼Œè¶Šæ˜¯æƒ³å»çš„åœ°æ–¹è¶Šæ²¡æœ‰æœºä¼šï¼Œè¶Šæ˜¯ä¸åœ¨æ„çš„åœ°æ–¹å¾€å¾€ä¼šæœ‰æƒŠå–œï¼Œæ¯”å¦‚é˜¿é‡Œå’Œèš‚èšï¼Œä¸šåŠ¡éƒ½è¿˜ä¸é”™æœ¬æ¥æƒ³è¯•è¯•å¯æ²¡æƒ³åˆ°éƒ½è¿‡äº†è¿˜ğŸ¤£ï¼Œç„å­¦ï¼Œæœ€åæ‰“ç®—é€‰åšäº‘åŸç”Ÿï¼Œè½¬Goè¯­è¨€ï¼Œé€‰æ‹©åˆå¿ƒï¼Œå¸Œæœ›è¿™æ¬¡ä¸è¦é€‰é”™ï¼Œæˆ‘å¯æ˜¯æ‹’äº†é˜¿é‡Œ</p><h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>  è¿™ä¸€å¹´æœ€å¤§çš„æ”¶è·å°±æ˜¯çŸ¥é“è‡ªå·±æƒ³è¦ä»€ä¹ˆäº†ï¼Œæœªæ¥çš„è·¯ä¹Ÿé€æ¸æ¸…æ™°ï¼Œé¢è¯•è¿‡ç¨‹ä¸­å¬åˆ°æœ€å¤šçš„è¯å°±æ˜¯ä½ è¿˜å¹´è½»ï¼Œè·¯è¿˜å¾ˆé•¿ï¼Œæ¯•ç«Ÿå·¥ä½œä¸ä¹…ï¼Œä¹Ÿç®—æ˜¯ä¸€ç‚¹ç‚¹ä¼˜åŠ¿å§ã€‚æœ€åï¼Œè¯¥å¼€å§‹æ–°ä¸€å¹´çš„Flagäº†</p><ul><li>åšå®¢ä¸èƒ½æ–­ï¼Œä¸€å¹´ä¸èƒ½å°‘äº20ç¯‡å§</li><li>Goè¯­è¨€ã€k8sã€Istioã€Mosnéƒ½æ•´æ˜ç™½äº†ï¼Œæœ€èµ·ç èƒ½ç‹¬ç«‹è§£å†³é—®é¢˜å§</li><li>ä¹°äº†ç›¸æœºä¸èƒ½åƒç°å§ï¼Œæ•´ä¸¤ç¯‡æ–‡ç« çœ‹ä¸‹æˆåŠŸ</li><li>æ—…è¡Œä¸èƒ½å°‘å“¦ï¼Œè¯»ä¸‡å·ä¹¦è¡Œä¸‡é‡Œè·¯</li><li>å‚ä¸å¼€æºé¡¹ç›®æˆ–è€…ç¤¾åŒºï¼ˆç»ˆæç›®æ ‡ğŸ˜¬ï¼‰</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;2021å¹´å·²ç»è¿‡å»äº†39å¤©ï¼Œä¸Šä¸€å¹´çš„æ€»ç»“èµ¶ç´§è¡¥ä¸Šï¼Œå…ˆç›˜ç‚¹ä¸‹ä¹‹å‰ç«‹è¿‡çš„Flagï¼Œç„¶åå†™ä¸€ä¸‹è‡ªå·±çš„å¿ƒè·¯å†ç¨‹å§&lt;/p&gt;
&lt;h3 id=&quot;Flag&quot;&gt;&lt;a href=&quot;#Flag&quot; class=&quot;headerlink&quot; title=&quot;Flag&quot;&gt;&lt;/a&gt;Flag&lt;/h3&gt;&lt;p&gt;è¿˜è®°
      
    
    </summary>
    
      <category term="ç”Ÿæ´»æ‚è°ˆ" scheme="http://yoursite.com/categories/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="ç”Ÿæ´»æ‚è°ˆ" scheme="http://yoursite.com/tags/%E7%94%9F%E6%B4%BB%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ¬¡MySQLæ­»é”çš„è¸©å‘è®°å½•</title>
    <link href="http://yoursite.com/2020/11/17/%E4%B8%80%E6%AC%A1MySQL%E6%AD%BB%E9%94%81%E7%9A%84%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    <id>http://yoursite.com/2020/11/17/ä¸€æ¬¡MySQLæ­»é”çš„è¸©å‘è®°å½•/</id>
    <published>2020-11-17T06:23:43.000Z</published>
    <updated>2021-07-13T12:27:08.591Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘åˆå†™bugäº†ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ï¼Œè¿™æ¬¡æ˜¯MySQLæ•°æ®åº“çš„æ­»é”ï¼ŒçœŸå®å¤ªèœäº†ğŸ¤·â€â™€ï¸(æ—¥å¸¸ä¸€èœ)</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><ul><li>æˆ‘åœ¨å®ç°ä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨åŠ¨æ€é…ç½®ä¸­å¿ƒçš„APIï¼Œåˆ›å»ºé…ç½®å¹¶å‘å¸ƒï¼Œå› ä¸ºè¦ä¿è¯æ¥å£çš„å¹‚ç­‰æ€§ï¼Œæˆ‘ä¸ºäº†æ–¹ä¾¿æ¯æ¬¡å°†é…ç½®åˆ é™¤å¹¶é‡æ–°åˆ›å»ºå†å‘å¸ƒï¼Œç›¸è¾ƒäºå…ˆæŸ¥è¯¢æ‰€æœ‰çš„é…ç½®ï¼Œåˆ¤æ–­å½“å‰é…ç½®ä¸å­˜åœ¨åå†åˆ›å»ºçš„æ–¹æ³•ï¼Œæˆ‘è§‰ç€ä¼šå¤šäº†åˆ¤æ–­çš„é€»è¾‘æ¶ˆè€—ï¼Œæ‰€ä»¥é‡‡ç”¨äº†ç¬¬ä¸€ç§æ–¹å¼ï¼š è°ƒç”¨åˆ é™¤é…ç½®çš„apiæ¥å£æ¸…ç©ºå†å²æ•°æ® -&gt; åˆ›å»ºæ–°çš„é…ç½® -&gt; å‘å¸ƒæ–°çš„é…ç½®</li><li>æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹åŠ¨æ€é…ç½®ä¸­å¿ƒçš„èƒŒæ™¯ï¼Œåˆ›å»ºçš„é…ç½®ä¿å­˜åœ¨config_itemè¡¨ä¸­ï¼Œå‘å¸ƒçš„é…ç½®å°†config_itemè¡¨ä¸­çš„æ•°æ®æ’å…¥åˆ°config_item_releaseè¡¨ä¸­ï¼Œä¸¤ä¸ªè¡¨çš„ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦ä¿¡æ¯ç²˜ä¸€ä¸‹ï¼Œå‘å¸ƒé…ç½®æ˜¯ä»¥profileç»´åº¦(å°±ç†è§£ä¸ºé…ç½®çš„è·¯å¾„)ï¼Œæ‰€ä»¥ä¼šæœ‰profile_id+keyçš„å”¯ä¸€ç´¢å¼•ï¼›</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">config_itemå’Œconfig_item_release</span><br><span class="line">(</span><br><span class="line">  id bigint not null comment &apos;ä¸»é”®id&apos; primary key,</span><br><span class="line">  profile_id bigint not null comment &apos;profile id&apos;,</span><br><span class="line">  `key` varchar(200) not null comment &apos;é…ç½®é¡¹key&apos;,</span><br><span class="line">  value varchar(6144) not null comment &apos;é…ç½®é¡¹value&apos;,</span><br><span class="line">  constraint uniq_profile_key</span><br><span class="line">    unique (profile_id, `key`)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·ç»è¿‡æµ‹è¯•æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œåé¢æˆ‘çš„æ“ä½œå°±å†™äº†bugï¼Œæˆ‘åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­å‘ç°æ¥å£æ¯”è¾ƒæ…¢ï¼Œæƒ³ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œå‘ç°æ¥å£çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œæˆ‘åˆ›å»ºå¹¶å‘å¸ƒçš„é…ç½®æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥é©¬ä¸Šå°±ä¼šæƒ³åˆ°æ”¹ä¸ºå¤šçº¿ç¨‹ï¼Œå†è”æƒ³åˆ°æ’å…¥config_item_releaseè¡¨æ˜¯ä»¥profileIdç»´åº¦ï¼Œä¸åŒprofileæ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œè„‘è¡¥äº†ä¸€ä¸‹æ²¡é—®é¢˜å°±å¼€å¹²äº†</li><li>å¤šçº¿ç¨‹ç‰ˆæœ¬åï¼Œè¿è¡Œå‡ æ¬¡ååªæœ‰å¾ˆå°çš„æ¦‚ç‡ä¼šæˆåŠŸï¼Œè¿™å°±è¸©åˆ°å‘äº†</li></ul><h3 id="å®šä½"><a href="#å®šä½" class="headerlink" title="å®šä½"></a>å®šä½</h3><p>é¦–å…ˆè¦çœ‹æ—¥å¿—ï¼Œå…·ä½“æ—¥å¿—æ‰¾ä¸åˆ°äº†ï¼Œä¸»è¦æ˜¯æœ‰ä¸‹é¢è¿™ä¹ˆä¸€è¡Œï¼Œdeadlockå…³é”®å­—å¯ä»¥å®šä½åˆ°é—®é¢˜äº†ï¼Œç®€å•æ€è€ƒä¸€ä¸‹ï¼Œæ•°æ®åº“çš„å¹¶å‘æ“ä½œéƒ½æ˜¯ä¸åŒçš„æ•°æ®è¡Œï¼Œæ²¡æœ‰å¹¶å‘å¯¹ç»Ÿä¸€æ•°æ®çš„å†™æ“ä½œï¼Œä¸‹é¢å°±å¼€å§‹ç§‘å­¦æ’æŸ¥äº†ï¼ˆGoogleï¼‰</p><p><strong><em>### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException: Deadlock found when trying to get lock; try restarting transaction</em></strong></p><p>é¦–å…ˆè¦æ‰¾åˆ°MySQLæ­»é”çš„æ—¥å¿—ï¼Œéƒ½è¯´ç”¨è¿™ä¸ªSQL <em>SHOW ENGINE INNODB STATUS</em> å¯ä»¥çœ‹ï¼›æˆ‘æ€ä¹ˆæéƒ½ä¸è¡Œï¼Œæœ€åæ˜¯ç”¨ <em>select @@log_error</em> æ‰¾åˆ°MySQLé”™è¯¯æ—¥å¿—çš„ä½ç½®ï¼Œå†é€šè¿‡å‘½ä»¤è¡Œå»çœ‹çš„ï¼Œå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">------------------------</span><br><span class="line">LATEST DETECTED DEADLOCK</span><br><span class="line">------------------------</span><br><span class="line">-- è¿™è¡Œå¯ä»¥å®šä½åˆ°å¤´å‘è¶Šæ¥è¶Šå°‘çš„åŸå› äº†ğŸ˜¹</span><br><span class="line">2020-11-12 03:04:06 0x70000fccb000</span><br><span class="line">-- ç¬¬ä¸€ä¸ªäº‹åŠ¡</span><br><span class="line">*** (1) TRANSACTION:</span><br><span class="line">-- äº‹åŠ¡id=69581 æ­£åœ¨æ‰§è¡Œæ’å…¥è¯­å¥</span><br><span class="line">TRANSACTION 69581, ACTIVE 0 sec inserting</span><br><span class="line">-- ä½¿ç”¨åˆ°äº†ä¸¤å¼ è¡¨ï¼ŒåŠ é”äº†ä¸¤å¼ è¡¨</span><br><span class="line">mysql tables in use 2, locked 2</span><br><span class="line">-- äº‹åŠ¡å¤„äºLOCK WAITçŠ¶æ€ï¼Œæœ‰6ç§é”ç»“æ„ å…¶ä¸­4ä¸ªè¡Œé”</span><br><span class="line">LOCK WAIT 6 lock struct(s), heap size 1136, 4 row lock(s), undo log entries 1</span><br><span class="line">-- çº¿ç¨‹ä¿¡æ¯</span><br><span class="line">MySQL thread id 627, OS thread handle 123145568219136, query id 21548 localhost 127.0.0.1 root Sending data</span><br><span class="line">-- äº‹åŠ¡å‘ç”Ÿé˜»å¡çš„SQLè¯­å¥</span><br><span class="line">INSERT INTO config_item_release</span><br><span class="line">        SELECT * FROM config_item c WHERE c.profile_id=8720</span><br><span class="line">-- ç­‰å¾…è·å–çš„é”</span><br><span class="line">*** (1) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">-- ç­‰å¾…è·å–å”¯ä¸€ç´¢å¼•insert intentioné” ç»†èŠ‚1</span><br><span class="line">RECORD LOCKS space id 1112 page no 1955 n bits 376 index uniq_profile_key of table `my_table`.`config_item_release` trx id 69581 lock_mode X insert intention waiting</span><br><span class="line">-- è¯¥è®°å½•çš„ä¿¡æ¯</span><br><span class="line">Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0</span><br><span class="line">-- supremum ç»†èŠ‚2</span><br><span class="line"> 0: len 8; hex 73757072656d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">-- ç¬¬äºŒä¸ªäº‹åŠ¡</span><br><span class="line">*** (2) TRANSACTION:</span><br><span class="line">TRANSACTION 69580, ACTIVE 0 sec inserting</span><br><span class="line">mysql tables in use 2, locked 2</span><br><span class="line">6 lock struct(s), heap size 1136, 4 row lock(s), undo log entries 1</span><br><span class="line">MySQL thread id 626, OS thread handle 123145567383552, query id 21549 localhost 127.0.0.1 root Sending data</span><br><span class="line">INSERT INTO config_item_release</span><br><span class="line">        SELECT * FROM config_item c WHERE c.profile_id=8721</span><br><span class="line">-- å½“å‰è·å–åˆ°é”çš„ä¿¡æ¯</span><br><span class="line">*** (2) HOLDS THE LOCK(S):</span><br><span class="line">-- å½“å‰è·å–åˆ°çš„æ—¶å”¯ä¸€ç´¢å¼•çš„Xé” ç»†èŠ‚3</span><br><span class="line">RECORD LOCKS space id 1112 page no 1955 n bits 376 index uniq_profile_key of table `my_table`.`config_item_release` trx id 69580 lock_mode X</span><br><span class="line">Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0</span><br><span class="line"> 0: len 8; hex 73757072656d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">-- äº‹åŠ¡ç­‰å¾…è·å–çš„é”</span><br><span class="line">*** (2) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">-- ç­‰å¾…è·å–å”¯ä¸€ç´¢å¼•insert intentioné” ç»†èŠ‚4</span><br><span class="line">RECORD LOCKS space id 1112 page no 1955 n bits 376 index uniq_profile_key of table `laf_config`.`config_item_release` trx id 69580 lock_mode X insert intention waiting</span><br><span class="line">Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0</span><br><span class="line"> 0: len 8; hex 73757072656d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">-- å›æ»šäº†äº‹åŠ¡2</span><br><span class="line">*** WE ROLL BACK TRANSACTION (2)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ®µæ—¥å¿—ä¸­ï¼Œå¿½ç•¥äº†å‡ ä¸ªç»†èŠ‚å¯¼è‡´åœ¨æ’æŸ¥é—®é¢˜çš„æ—¶å€™èµ°äº†å¾ˆå¤šçš„å¼¯è·¯</p><ul><li>äº‹åŠ¡åœ¨ç­‰å¾…çš„é”æ˜¯Insert Intentioné”ï¼Œè¿™ä¸ªé”æ˜¯é—´éš™é”çš„ä¸€ç§ï¼Œå®¹æ˜“è¢«å¿½ç•¥æ‰ï¼Œåˆšå¼€å§‹çš„æˆ‘è¿˜ä»¥ä¸ºæ˜¯insertæ“ä½œåœ¨ç­‰å¾…Xé”å¯¼è‡´æ’æŸ¥çš„æ–¹å‘å°±åšäº†</li><li>supremum ä»£è¡¨æ— ç©·å¤§ï¼Œè¿™é‡Œä¹Ÿèƒ½å¤ŸçŒœæƒ³åˆ°ç­‰å¾…é”çš„æ—¶ä¸€ä¸ªåŒºé—´æ˜¯(8720,+âˆ)çš„é—´éš™é”ï¼Œè¿™ä¸ªç»†èŠ‚ä¹Ÿè¢«æˆ‘å¿½ç•¥æ‰äº†ï¼Œæ³¨æ„åŠ›å®Œå…¨è¢« lock model X å¸å¼•èµ°äº†</li><li>äº‹åŠ¡2å½“å‰è·å–åˆ°çš„é”æ˜¯å”¯ä¸€ç´¢å¼•çš„Xé”ï¼Œä¸äº‹åŠ¡1ç­‰å¾…çš„é”æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿˜æ˜¯å¯¹Insert Intentioné”ä¸äº†è§£å¯¼è‡´è¿™ä¸ªç»†èŠ‚å¿½ç•¥æ‰äº†</li><li>äº‹åŠ¡2ç­‰å¾…çš„é”å’Œäº‹åŠ¡1ç­‰å¾…çš„é”æ˜¯ç›¸åŒçš„ï¼Œåº”è¯¥æ˜¯äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾å½¢æˆäº†é—­ç¯æ‰€ä»¥æ‰ä¼šå‘ç”Ÿæ­»é”ï¼Œæ­»é”çš„åŸºæœ¬æ¦‚å¿µéƒ½å¿˜äº†ï¼Œæ„Ÿè§‰è‡ªå·±åƒåšæ¢¦ä¸€æ ·ğŸ¤·â€â™€ï¸</li></ul><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ul><li>ä»æ­»é”çš„å®šä¹‰æ¥çœ‹ï¼Œå¤šä¸ªäº‹ç‰©è¦è·å–çš„èµ„æºå½¢æˆäº†é—­ç¯ï¼Œç»“åˆæ—¥å¿—æ¥çœ‹ä¸¤ä¸ªäº‹åŠ¡éƒ½åœ¨insertæ“ä½œæ—¶é˜»å¡ï¼Œç­‰å¾…ç›¸åŒä½ç½®èµ„æºé”ï¼Œå¹¶ä¸”è¢«å¯¹æ–¹é™åˆ¶</li><li>åœ¨ä»æ—¥å¿—æ¥çœ‹äº‹åŠ¡1å¹¶æ²¡æœ‰è·å–åˆ°ä»»ä½•çš„é”ï¼Œäº‹åŠ¡2è·å¾—çš„æ˜¯å”¯ä¸€ç´¢å¼•çš„è®°å½•é”ï¼Œçœ‹ä¸å‡ºæ¥æœ‰ä»€ä¹ˆèµ„æºè¢«äº’ç›¸é™åˆ¶ï¼›å¤§èƒ†çŒœæƒ³ä¸€ä¸‹ï¼Œè¿™é‡Œä¸€å®šå­˜åœ¨äº‹åŠ¡å·²ç»è·å–åˆ°çš„é”ä½†æ˜¯æ²¡æœ‰åœ¨æ—¥å¿—ä¸­ä½“ç°å‡ºæ¥</li><li>ä»æ—¥å¿—ä¸­è¢«é˜»å¡åˆ°çš„insertæ“ä½œå’ŒInsert Intentionå…³é”®å­—å…¥æ‰‹æŸ¥æ‰¾èµ„æ–™å‘ç°äº†æƒŠäººçš„ä¸œè¥¿ï¼Œæˆ‘çš„çŸ¥è¯†ä½“ç³»ä¸­å­˜åœ¨è¿™å·¨å¤§æ¼æ´ï¼Œä¸‹é¢å°±æ˜¯è¢«å¿½ç•¥çš„ç»†èŠ‚<ul><li>åœ¨insertæ“ä½œä¹‹å‰ä¼šæœ‰Insert Intentioné”(æ’å…¥æ„å‘é”)æ˜¯é—´éš™é”çš„ä¸€ç§ï¼Œä»æ—¥å¿—æ¥çœ‹åŠ é”çš„é—´éš™ä¸º(max,+âˆ)</li><li>Insert Intentioné”ä¹‹é—´åªè¦æ’å…¥çš„æ•°æ®ä¸æ˜¯åŒä¸€ä¸ªæ•°æ®æ˜¯ä¸ä¼šå†²çªçš„</li><li>é—´éš™é”å’ŒInsert Intentioné”ä¹‹é—´ä¹Ÿä¼šæœ‰äº’æ–¥çš„å…³ç³»ï¼Œå·²ç»å­˜åœ¨äº†Gé”(é—´éš™é”)æ˜¯ä¸èƒ½åœ¨åŠ Ié”(æ’å…¥æ„å‘é”)ï¼Œç›¸åå·²ç»å­˜åœ¨Ié”æ˜¯å¯ä»¥å†åŠ Gé”çš„</li><li>ä¸¤ä¸ªGé”ç›´æ¥æ˜¯ç›¸äº’å…¼å®¹çš„</li></ul></li><li>åœ¨è¡¥å……äº†è¿™äº›çŸ¥è¯†ç›²åŒºåï¼ŒçœŸç›¸æµ®å‡ºæ°´é¢ï¼Œä¸¤ä¸ªäº‹åŠ¡éƒ½å…ˆåŠ äº†èŒƒå›´æ˜¯çš„Gé”ï¼Œä¸‹ä¸€æ­¥éƒ½è¦æ‰§è¡Œinsertæ“ä½œï¼Œinsertä¹‹å‰éƒ½è¦åŠ Ié”ï¼ŒIé”éƒ½è¢«å¯¹æ–¹äº‹åŠ¡äº‹å…ˆåŠ å·çš„Gé”é˜»å¡ï¼Œå½¢æˆäº†é—­ç¯ï¼Œå‘ç”Ÿæ­»é”</li><li>ç»“åˆä¸šåŠ¡é€»è¾‘æ¥çœ‹<ul><li>ç¬¬ä¸€æ­¥åˆ é™¤å†å²æ•°æ®æ¸…ç©ºäº†config_item_releaseè¡¨çš„æ•°æ®</li><li>ç¬¬äºŒæ­¥æ›´æ–°é…ç½®ï¼Œåœ¨config_itemè¡¨ä¸­updateæ“ä½œ</li><li>ç¬¬ä¸‰æ­¥å‘å¸ƒé…ç½®ï¼Œè¿™ä¸ªapiçš„é€»è¾‘æ˜¯å…ˆåˆ é™¤config_item_releaseä¸­çš„è®°å½•ï¼Œåœ¨å°†config_itemè¡¨ä¸­çš„æ•°æ®æ’å…¥è¿›æ¥</li><li>é—®é¢˜å°±å‡ºç°åœ¨ç¬¬ä¸€æ­¥æ¸…ç©ºäº†config_item_releaseè¡¨çš„æ•°æ®åè¯¥è¡¨ä¸­æ˜¯æ²¡æœ‰æ•°æ®çš„ï¼Œç¬¬ä¸‰æ­¥å…ˆdeleteæ“ä½œè¿™æ—¶å€™ä¸¤ä¸ªäº‹åŠ¡ä¼šåŠ åŒºé—´ä¸º(max,+âˆ)çš„Gé”ï¼Œç„¶åinsertæ“ä½œå‰ä¼šåœ¨è¿™ä¸ªåŒºé—´åŠ Ié”ï¼Œéƒ½è¢«å¯¹æ–¹çš„Gé”æ’æ–¥å½¢æˆæ­»é”ï¼Œ</li></ul></li><li>é‚£ä¹ˆå¦‚æœæ˜¯è¿™ä¸ªé—®é¢˜ï¼Œåœ¨config_item_releaseè¡¨ä¸­å­˜åœ¨æ•°æ®æ—¶ï¼Œä¸åŒäº‹åŠ¡deleteåŠ Gé”çš„åŒºé—´ä¸åŒåœ¨åŠ Ié”å°±ä¸ä¼šè¢«é˜»å¡å°±å¯ä»¥é¿å…æ­»é”äº†(deleteæ“ä½œçš„åŠ é”è¿‡ç¨‹è§å‚è€ƒæ–‡ç« )</li></ul><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>è¿™é‡Œé€šè¿‡ä¸¤ä¸ªå®éªŒæ¥éªŒè¯ä¸Šé¢çš„åˆ†æç»“æœ</p><h4 id="å®éªŒä¸€ï¼šconfig-item-releaseä¸å­˜åœ¨æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡å…ˆdeleteåinsertä¼šå‘ç”Ÿæ­»é”"><a href="#å®éªŒä¸€ï¼šconfig-item-releaseä¸å­˜åœ¨æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡å…ˆdeleteåinsertä¼šå‘ç”Ÿæ­»é”" class="headerlink" title="å®éªŒä¸€ï¼šconfig_item_releaseä¸å­˜åœ¨æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡å…ˆdeleteåinsertä¼šå‘ç”Ÿæ­»é”"></a>å®éªŒä¸€ï¼šconfig_item_releaseä¸å­˜åœ¨æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡å…ˆdeleteåinsertä¼šå‘ç”Ÿæ­»é”</h4><table><thead><tr><th>äº‹åŠ¡1</th><th>äº‹åŠ¡2</th><th>ç»“æœ</th><th>åˆ†æ</th></tr></thead><tbody><tr><td>begain</td><td></td><td></td><td></td></tr><tr><td></td><td>begain</td><td></td><td></td><td></td></tr><tr><td>DELETE FROM config_item_release WHERE profile_id=9118</td><td></td><td>Affected rows: 0, Time: 0.002000s</td><td>äº‹åŠ¡1å¯¹(max,+âˆ)åŒºé—´åŠ Gé”</td></tr><tr><td></td><td>DELETE FROM config_item_release WHERE profile_id=9112</td><td>Affected rows: 0, Time: 0.002000s</td><td>äº‹åŠ¡2å¯¹(max,+âˆ)åŒºé—´åŠ Gé”</td></tr><tr><td>INSERT INTO config_item_release SELECT * FROM config_item c WHERE c.profile_id=9108</td><td></td><td></td><td>äº‹åŠ¡1å¯¹(max,+âˆ)åŠ æ’å…¥æ„å‘é”ï¼Œè¢«äº‹åŠ¡2é˜»å¡</td></tr><tr><td></td><td>INSERT INTO config_item_release SELECT * FROM config_item c WHERE c.profile_id=9112</td><td>1213 - Deadlock found when trying to get lock; try restarting transaction, Time: 0.008000s</td><td>äº‹åŠ¡2å¯¹(max,+âˆ)åŠ æ’å…¥æ„å‘é”ï¼Œè¢«äº‹åŠ¡1é˜»å¡ï¼Œå‡ºç°æ­»é”</td></tr></tbody></table><h4 id="å®éªŒäºŒï¼šconfig-item-releaseå­˜åœ¨æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡å…ˆdeleteåinsertä¸ä¼šå‘ç”Ÿæ­»é”"><a href="#å®éªŒäºŒï¼šconfig-item-releaseå­˜åœ¨æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡å…ˆdeleteåinsertä¸ä¼šå‘ç”Ÿæ­»é”" class="headerlink" title="å®éªŒäºŒï¼šconfig_item_releaseå­˜åœ¨æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡å…ˆdeleteåinsertä¸ä¼šå‘ç”Ÿæ­»é”"></a>å®éªŒäºŒï¼šconfig_item_releaseå­˜åœ¨æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡å…ˆdeleteåinsertä¸ä¼šå‘ç”Ÿæ­»é”</h4><p>é¦–å…ˆæ‰§è¡Œä¸‹é¢ä¸¤æ¡è¯­å¥åˆå§‹åŒ–è¡¨ä¸­çš„æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO config_item_release SELECT * FROM config_item c WHERE c.profile_id=9111;</span><br><span class="line">INSERT INTO config_item_release SELECT * FROM config_item c WHERE c.profile_id=9112;</span><br></pre></td></tr></table></figure><table><thead><tr><th>äº‹åŠ¡1</th><th>äº‹åŠ¡2</th><th>ç»“æœ</th><th>åˆ†æ</th></tr></thead><tbody><tr><td>begain</td><td></td><td></td><td></td></tr><tr><td></td><td>begain</td><td></td><td></td><td></td></tr><tr><td>DELETE FROM config_item_release WHERE profile_id=9111</td><td></td><td>Affected rows: 1, Time: 0.000000s</td><td>äº‹åŠ¡1å¯¹profile_id=9111è®°å½•å‰çš„é—´éš™åŠ Gé”</td></tr><tr><td></td><td>DELETE FROM config_item_release WHERE profile_id=9112</td><td>Affected rows: 3, Time: 0.000000s</td><td>äº‹åŠ¡2å¯¹profile_id=9112è®°å½•å‰çš„é—´éš™åŠ Gé”</td></tr><tr><td>INSERT INTO config_item_release SELECT * FROM config_item c WHERE c.profile_id=9111</td><td></td><td></td><td>äº‹åŠ¡1é˜»å¡ï¼Œå› ä¸ºäº‹åŠ¡2å¯¹profile_id=9112ä¹‹å‰çš„é—´éš™åŠ äº†Gé”ï¼Œ9111è¿™æ¡è®°å½•åˆšå¥½åœ¨è¿™ä¸ªåŒºé—´ï¼Œäº‹åŠ¡1è¦åŠ Ié”æ—¶è¢«äº‹åŠ¡2çš„Gé”é˜»å¡</td></tr><tr><td></td><td>INSERT INTO config_item_release SELECT * FROM config_item c WHERE c.profile_id=9112</td><td>Affected rows: 3, Time: 0.000000s</td><td>äº‹åŠ¡2å…ˆå¯¹9112ä¹‹å‰çš„é—´éš™åŠ Ié”è¿™ä¸ªé—´éš™æ˜¯å½“å‰äº‹åŠ¡çš„Gé”ä¸å†²çªæ²¡æœ‰é˜»å¡</td></tr><tr><td></td><td>commit</td><td>OK, Time: 0.001000s</td><td>äº‹åŠ¡2æˆåŠŸæäº¤ï¼Œäº‹åŠ¡1ç»“æŸé˜»å¡çŠ¶æ€</td></tr><tr><td>commit</td><td></td><td>OK, Time: 0.001000s</td><td>äº‹åŠ¡1æˆåŠŸæäº¤</td></tr></tbody></table><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ­£å¼ç”±äºæˆ‘å…ˆæ¸…é™¤äº†å†å²æ•°æ®ï¼Œåœ¨åˆ é™¤è¡¨é‡Œä¸å­˜åœ¨çš„è®°å½•æ—¶å¤šä¸ªäº‹åŠ¡å°†ç›¸åŒçš„åŒºé—´åŠ äº†Gé”ï¼Œå†åŠ Ié”æ—¶äº§ç”Ÿæ­»é”ï¼Œè§£å†³ï¼šåˆ é™¤ä¸šåŠ¡é€»è¾‘ä¸­çš„æ¸…é™¤å†å²æ•°æ®çš„æ“ä½œï¼Œä¿è¯è¡¨ä¸­æ•°æ®å­˜åœ¨ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>è¡¥å……ä¸€ä¸‹è‡ªå·±çš„çŸ¥è¯†ç›²åŒºï¼Œé‡æ–°æ¢³ç†æ•°æ®åº“çš„é”ï¼Œè¯¦ç»†è§<a href="http://yywang.top/2020/11/16/%E6%8D%8B%E4%B8%80%E6%8D%8BMySQL%E7%9A%84%E9%94%81/#more" target="_blank" rel="noopener">ä¸Šä¸€ç¯‡æ–‡ç« </a></li><li>é¿å…åˆ é™¤ä¸å­˜åœ¨çš„è®°å½•çš„æ“ä½œï¼Œè¿™ä¸ªæ“ä½œä¼šåŠ Gé”ï¼Œå¯èƒ½å¤šä¸ªäº‹åŠ¡çš„Gé”é‡å äº†å¯¼è‡´æ­»é”</li><li>åˆ é™¤æ“ä½œæœ€å¥½æ˜¯å…ˆæ‰¾åˆ°è®°å½•çš„idå†æ ¹æ®idåˆ é™¤ï¼›å› ä¸ºåªæœ‰åœ¨å”¯ä¸€ç´¢å¼•çš„åˆ é™¤æ“ä½œæ‰ä¼šåŠ Ré”å…¶ä»–æƒ…å†µéƒ½ä¼šæœ‰Gé”</li></ul><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://www.fordba.com/lock-analyse-of-delete.html" target="_blank" rel="noopener">MySQL DELETE åˆ é™¤è¯­å¥åŠ é”åˆ†æ</a></p><p><a href="https://www.iteye.com/blog/narcissusoyf-1637309" target="_blank" rel="noopener">ä»ä¸€ä¸ªæ­»é”çœ‹mysql innodbçš„é”æœºåˆ¶</a></p><p><a href="http://xiaobaoqiu.github.io/blog/2016/07/22/%5B%3F%5D-ge-si-suo-wen-ti/" target="_blank" rel="noopener">ä¸€ä¸ªæ­»é”é—®é¢˜</a></p><p><a href="http://www.fanyilun.me/2017/04/20/MySQL%E5%8A%A0%E9%94%81%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">MySQLåŠ é”åˆ†æ</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘åˆå†™bugäº†ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ï¼Œè¿™æ¬¡æ˜¯MySQLæ•°æ®åº“çš„æ­»é”ï¼ŒçœŸå®å¤ªèœäº†ğŸ¤·â€â™€ï¸(æ—¥å¸¸ä¸€èœ)&lt;/p&gt;
&lt;h3 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æˆ‘åœ¨å®ç°ä¸€ä¸ª
      
    
    </summary>
    
      <category term="MySQL" scheme="http://yoursite.com/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>æ‹ä¸€æ‹MySQLçš„é”</title>
    <link href="http://yoursite.com/2020/11/16/%E6%8D%8B%E4%B8%80%E6%8D%8BMySQL%E7%9A%84%E9%94%81/"/>
    <id>http://yoursite.com/2020/11/16/æ‹ä¸€æ‹MySQLçš„é”/</id>
    <published>2020-11-16T07:04:15.000Z</published>
    <updated>2021-07-13T12:27:08.594Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>æœ¬æ–‡ä¸»è¦æ¢³ç†MySQLçš„é”æœºåˆ¶ï¼Œä¸»è¦æ˜¯é’ˆå¯¹äºInnodbå¼•æ“ï¼Œç›®å‰ç½‘ç»œä¸ŠæŸ¥çš„æ–‡ç« åŸºæœ¬ä¸Šéƒ½å·®ä¸å¤šï¼Œå®é™…ä¸Šæ˜¯å¿½ç•¥äº†ä¸€äº›ç»†èŠ‚çš„ï¼Œè¿™äº›ç»†èŠ‚å¯èƒ½ä¼šæˆä¸ºä»Šåæ¬ç –è¿‡ç¨‹ä¸­çš„æ¶é­”ï¼Œæ¯”å¦‚è¯´æ’å…¥æ„å‘é”ï¼Œè¡Œé”ä¹‹é—´çš„å…¼å®¹å…³ç³»è¿™äº›ï¼Œæœ¬æ–‡é€šè¿‡æŸ¥é˜…èµ„æ–™åŠ é”MySQLå®˜ç½‘çš„è¯´æ˜å†ç»“åˆè‡ªå·±çš„ç†è§£æ¢³ç†äº†ä¸€ä¸‹MySQLçš„é”æœºåˆ¶~</p><h2 id="é”çš„åˆ’åˆ†"><a href="#é”çš„åˆ’åˆ†" class="headerlink" title="é”çš„åˆ’åˆ†"></a>é”çš„åˆ’åˆ†</h2><p>è¿™é‡Œè¦æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯MySQLå¯¹é”çš„åˆ’åˆ†æ˜¯ä¸¤ç§ä¸åŒçš„ç»´åº¦ï¼ŒæŒ‰ç…§åŠ é”çš„ç²’åº¦å’Œé”çš„ç±»å‹ï¼Œå¹¶ä¸æ˜¯å›ºå®šçš„ä»€ä¹ˆé”ä»€ä¹ˆé”ï¼Œå°±æ¯”å¦‚è¡¨é”å’Œè¡Œé”é‡Œéƒ½æœ‰å…±äº«é”æˆ–è€…æ’ä»–é”ï¼ŒåŒæ ·ï¼Œå…±äº«é”æˆ–æ’ä»–é”ä¸­ä¹Ÿéƒ½æœ‰è¡Œé”å’Œè¡¨é”ï¼Œæ˜¯ä½ ä¸­æœ‰æˆ‘æˆ‘ä¸­æœ‰ä½ çš„å…³ç³»ï¼ŒæŒ‰ç…§ä¸åŒç»´åº¦åˆ’åˆ†çš„ç»“æœï¼Œä¸‹é¢å°±æ¥ä¸€ä¸€åˆ—ä¸¾è¿™äº›é”</p><h3 id="é”ç²’åº¦"><a href="#é”ç²’åº¦" class="headerlink" title="é”ç²’åº¦"></a>é”ç²’åº¦</h3><p>ä»¥åŠ é”çš„ç²’åº¦ä¸ºå‡†å¯ä»¥åˆ†ä¸ºï¼Œå…¨å±€é”ï¼Œè¡¨é”å’Œè¡Œé”ï¼›</p><ul><li>å…¨å±€é”ï¼›å¯¹æ•´ä¸ªæ•°æ®åº“åŠ é”ï¼Œè®©æ•´ä¸ªæ•°æ®åº“åœ¨åªè¯»çŠ¶æ€ï¼Œåœ¨æ•°æ®åº“å¤‡ä»½æ—¶ä½¿ç”¨ï¼ˆä¸»åº“ä¸Šå¤‡ä»½ï¼Œæ‰€æœ‰å†™æ“ä½œå°†ä¸èƒ½è¿›è¡Œå½±å“ä¸šåŠ¡ï¼›ä»åº“ä¸Šå¤‡ä»½ï¼Œå¤‡ä»½æœŸé—´ä¸èƒ½æœ‰å†™æ“ä½œï¼Œä¸èƒ½æ‰§è¡Œbinlogï¼Œä¸»ä»å»¶è¿Ÿå¢å¤§ï¼‰</li><li>è¡¨é”ï¼ŒåŠ é”çš„ç²’åº¦ä¸ºæ•°æ®è¡¨<ul><li>è‡ªå¢é” AUTO-INC Locks æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¡¨é”ï¼Œå¯ä»¥ä¿è¯ä¸€ä¸ªäº‹åŠ¡æ’å…¥æ•°æ®çš„idè¿ç»­</li></ul></li><li>è¡Œé”ï¼ŒåŠ é”çš„ç²’åº¦ä¸ºæ•°æ®è¡Œ<ul><li>è®°å½•é” Record Locksï¼›é”å®šå½“å‰æ•°æ®è¡Œ</li><li>é—´éš™é” Gap Locksï¼›é”å®šæ•°æ®è¡Œçš„å‰åé—´éš™<ul><li>æ’å…¥æ„å‘é” Insert Intention Locksï¼›åœ¨æ’å…¥æ“ä½œä¹‹å‰ä¼šæŠŠæ’å…¥çš„åŒºåŸŸåŠ å…¥æ’å…¥æ„å‘é”ï¼Œä¸åŒåŒºåŸŸçš„çš„é”äº’ç›¸å…¼å®¹</li></ul></li><li>ä¸´é”®é” Next-Key Locksï¼›é”å®šæ•°æ®è¡Œ+å‰åçš„é—´éš™</li></ul></li></ul><h3 id="é”ç±»å‹"><a href="#é”ç±»å‹" class="headerlink" title="é”ç±»å‹"></a>é”ç±»å‹</h3><ul><li>å…±äº«é”ï¼ˆSï¼‰å’Œ æ’ä»–é”ï¼ˆXï¼‰ï¼›ç›¸å½“äºï¼Œè¯»é”å’Œå†™é”ï¼Œè¯»å¯ä»¥å…±äº«é”ï¼Œå†™åªèƒ½ç‹¬å èµ„æºï¼›ç²’åº¦å¯ä»¥æœ‰è¡Œé”å’Œè¡¨é”ï¼Œæ¯”å¦‚è¡Œçº§æˆ–è€…è¡¨çº§çš„Sé”ï¼ˆæˆ–Xé”ï¼‰</li><li>æ„å‘é”(æ„å‘å…±äº«é”ISï¼Œæ„å‘æ’ä»–é”IX)ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨ç»™æ•°æ®è¡ŒåŠ é”æ—¶ä¼šåœ¨æ•°æ®æ‰€åœ¨çš„è¡¨åŠ ç›¸åŒç±»å‹çš„æ„å‘é”(æ¯”å¦‚å¯¹æ•°æ®è¡ŒåŠ Xé”å°±ä¼šåœ¨è¯¥è¡¨åŠ è¡¨çº§åˆ«çš„Xæ„å‘é”)ï¼Œè¡¨ç¤ºè¯¥è¡¨æœ‰äº‹åŠ¡å¯¹æ•°æ®è¡ŒåŠ äº†é”ï¼Œæ„å‘é”ç›´æ¥æ˜¯ç›¸äº’å…¼å®¹çš„ï¼Œä½†æ˜¯ä¸å…·ä½“çš„è¡¨é”æˆ–è€…è¡Œé”æœ‰ç€äº’æ–¥å…³ç³»çš„ï¼Œå…·ä½“å…³ç³»è§ä¸‹é¢åˆ†æ</li></ul><h2 id="é”ä¹‹é—´çš„å…¼å®¹å…³ç³»"><a href="#é”ä¹‹é—´çš„å…¼å®¹å…³ç³»" class="headerlink" title="é”ä¹‹é—´çš„å…¼å®¹å…³ç³»"></a>é”ä¹‹é—´çš„å…¼å®¹å…³ç³»</h2><table><thead><tr><th></th><th>S</th><th>X</th><th>IS</th><th>IX</th></tr></thead><tbody><tr><td>S</td><td>âœ…</td><td>â</td><td>âœ…</td><td>â</td></tr><tr><td>X</td><td>â</td><td>â</td><td>â</td><td>â</td></tr><tr><td>IS</td><td>âœ…</td><td>â</td><td>âœ…</td><td>âœ…</td></tr><tr><td>IX</td><td>â</td><td>â</td><td>âœ…</td><td>âœ…</td></tr></tbody></table><p><strong>æ³¨:</strong> æ„å‘é”æ˜¯è¡¨çº§åˆ«çš„é”ï¼Œä¸Šé¢è¡¨æ ¼ä¸­ä¸æ„å‘é”å…¼å®¹å’Œäº’æ–¥å…³ç³»æŒ‡çš„æ˜¯ä¸è¡¨çº§åˆ«çš„Sé”æˆ–è€…Xé”ï¼Œæ„å‘é”å’Œè¡Œçº§åˆ«çš„é”æ˜¯ä¸å†²çªçš„ï¼›ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ä¸€ä¸ªäº‹åŠ¡åœ¨æ’å…¥æˆ–è€…ä¿®æ”¹æ•°æ®çš„æ—¶å€™å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†è¡¨ç»“æ„ä¹‹é—´ä¼šå†²çªï¼›æ’å…¥æˆ–è€…ä¿®æ”¹æ•°æ®æ˜¯ä¸€èˆ¬ä¼šåŠ è¡Œé”æˆ–è€…é—´éš™é”ï¼ŒåŒæ—¶åœ¨è¡¨ä¸ŠåŠ IXé”(æ„å‘æ’ä»–é”)ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡è¦ä¿®æ”¹è¡¨ç»“æ„æ˜¯è¦ç»™è¡¨åŠ Xé”ï¼Œè¿™æ—¶ä¼šå’ŒIXé”å†²çªç­‰å¾…IXé”é‡Šæ”¾</p><p>è¿™ä¸ªåªæ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„é”ä¹‹é—´çš„å…¼å®¹å…³ç³»ï¼Œé™¤æ­¤ä¹‹å¤–å‘¢ï¼ŒMySQLä¸­è¿˜æœ‰æ›´åŠ ç²¾ç¡®çš„é”ä¹‹é—´çš„å…¼å®¹å…³ç³»ï¼Œä¹Ÿå°±æ˜¯åœ¨æ‰€æœ‰ç±»å‹çš„è¡Œé”ä¹‹é—´çš„å…¼å®¹å…³ç³»ï¼Œ(<a href="https://www.iteye.com/blog/narcissusoyf-1637309" target="_blank" rel="noopener">è§å‚è€ƒæ–‡ç« 3</a>)ï¼›è¿™ä¸ªå…³ç³»æ˜¯åœ¨Xé”ä¸Xé”æˆ–è€…Sé”ä¸Xé”ä¸å…¼å®¹çš„æƒ…å†µä¸‹å†è¿›è¡Œæ¯”å¯¹</p><table><thead><tr><th></th><th>G</th><th>I</th><th>R</th><th>N</th></tr></thead><tbody><tr><td>G</td><td>âœ…</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr><tr><td>I</td><td>â</td><td>âœ…</td><td>âœ…</td><td>â</td></tr><tr><td>R</td><td>âœ…</td><td>âœ…</td><td>â</td><td>â</td></tr><tr><td>N</td><td>âœ…</td><td>âœ…</td><td>â</td><td>â</td></tr></tbody></table><p><strong>æ³¨:</strong>  G=Gapé”ï¼ŒI=Insert Intentioné”ï¼ŒR=Recordé”ï¼ŒN=Next-Keyé”ï¼›</p><p>ä¸Šè¡¨ä¸­çš„è¡Œä»£è¡¨å½“å‰å·²ç»å­˜åœ¨çš„é”ï¼Œç†è§£ä¸€ä¸‹è¿™å¼ è¡¨å°±å‡è®¾ä¸¤ä¸ªXé”æ’æ–¥çš„å‰æä¸‹ï¼š</p><ul><li>ç¬¬ä¸€åˆ—<ul><li>å·²ç»å­˜åœ¨Gé”ï¼Œä¸å…è®¸å†åŠ Ié”ï¼ˆåŠ äº†é—´éš™é”å°±ä¸å…è®¸åœ¨é—´éš™ä¸­æ’å…¥æ“ä½œäº†ï¼‰</li><li>å·²ç»å­˜åœ¨Gé”ï¼Œè¿˜å¯ä»¥å†åŠ Gé”ã€Ré”å’ŒNé”ï¼ˆä¹Ÿå°±æ˜¯è¯´Gé”ä¹‹é—´æ˜¯ç›¸äº’å…¼å®¹çš„ï¼ŒRé”å’ŒGé”æœ¬èº«å°±ä¸å†²çªå½“ç„¶å…¼å®¹ï¼ŒNé”å®è´¨ä¸Šå°±æ˜¯Gé”+Ré”ï¼ŒGé”å’ŒRé”éƒ½å…¼å®¹é‚£ä¹ˆNé”ä¸€å®šå…¼å®¹ï¼‰</li></ul></li><li>ç¬¬äºŒåˆ—ï¼Œå·²ç»å­˜åœ¨Ié”ï¼Œå‰©ä¸‹çš„æ‰€æœ‰ç±»å‹é”éƒ½å¯ä»¥å†åŠ <ul><li>è¿™é‡Œçœ‹åˆ°å†åŠ Gé”ä¹Ÿæ˜¯å…¼å®¹çš„å³ä½¿åŠ é”çš„é—´éš™æ˜¯ä¸€æ ·çš„</li><li>æ ¹æ®å®˜æ–¹æ–‡æ¡£ä¸¤ä¸ªIé”å¦‚æœæ’å…¥ä¸æ˜¯åŒä¸€ä¸ªä½ç½®æ˜¯ç›¸äº’å…¼å®¹çš„ï¼Œè¿™æ ·å¯ä»¥æé«˜å¹¶å‘</li><li>å…¼å®¹Ré”ä¹Ÿå¾ˆå¥½ç†è§£ï¼ŒIé”æ˜¯é—´éš™ï¼ŒRé”æ˜¯è®°å½•æœ¬èº«å°±ä¸å†²çª</li><li>Gé”å’ŒRé”éƒ½å…¼å®¹äº†é‚£ä¹ˆNé”ä¸€å®šå…¼å®¹</li></ul></li><li>ç¬¬ä¸‰åˆ—ï¼Œå·²ç»å­˜åœ¨Ré”ï¼Œæ˜¯å¯ä»¥åŠ é—´éš™é”çš„(Gé”å’ŒIé”)ï¼Œä½†å¦‚æœåŒ…å«è®°å½•çš„é”å°±ä¸å…¼å®¹(Ré”å’ŒNé”)</li><li>ç¬¬å››åˆ—ï¼Œå·²ç»å­˜åœ¨Né”ï¼Œé¦–å…ˆåŒ…å«è®°å½•çš„é”(Ré”å’ŒNé”)æ˜¯ä¸å…¼å®¹çš„ï¼ŒIé”è¡¨æ˜è¦æ’å…¥æ•°æ®ä¹Ÿæ˜¯ä¸å…¼å®¹çš„ï¼ŒGé”æ˜¯å…¼å®¹çš„</li></ul><p>æ€»ç»“ï¼šGé”ä¸å…¶ä»–é”ä¹‹é—´æ˜¯ç›¸äº’å…¼å®¹çš„ï¼Œæ— è®ºé—´éš™æ˜¯å¦ç›¸åŒï¼Œä¹Ÿæ— è®ºå½“å‰æ˜¯ä»€ä¹ˆç±»å‹çš„é”ï¼Œå†åŠ Gé”ä¹Ÿæ˜¯å…¼å®¹çš„ï¼›Ié”æ˜¯Gé”çš„ä¸€ç§ï¼Œæ˜¯åœ¨æ’å…¥ä¹‹å‰è¡¨æ˜æ’å…¥æ“ä½œçš„æ„å‘ï¼Œå¦‚æœå½“å‰å­˜åœ¨Gé”æˆ–è€…Né”ï¼Œä¹Ÿå°±æ˜¯åŠ é”çš„åŒºåŸŸç›¸åŒå°±ä¸èƒ½å†åŠ Ié”ï¼Œéœ€è¦ç­‰å¾…ï¼Œå…¶ä»–æƒ…å†µä¸Gé”ç›¸åŒéƒ½æ˜¯å…¼å®¹çš„ï¼›Ré”å’ŒNé”å°±çœ‹åŠ é”çš„æ•°æ®æ˜¯å¦å†²çªæ¥åˆ¤æ–­é”æ˜¯å¦å…¼å®¹</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://i6448038.github.io/2019/02/23/mysql-lock/" target="_blank" rel="noopener">ç§’æ‡‚InnoDBçš„é”</a></p><p><a href="https://dev.mysql.com/doc/refman/5.6/en/innodb-locking.html" target="_blank" rel="noopener">InnoDB Locking</a></p><p><a href="https://www.iteye.com/blog/narcissusoyf-1637309" target="_blank" rel="noopener">ä»ä¸€ä¸ªæ­»é”çœ‹mysql innodbçš„é”æœºåˆ¶</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä¸»è¦æ¢³ç†MySQLçš„é”æœºåˆ¶ï¼Œä¸»è¦æ˜¯é’ˆå¯¹äºInnodbå¼•æ“ï¼Œç›®å‰ç½‘ç»œä¸ŠæŸ¥çš„æ–‡ç« åŸºæœ¬ä¸Šéƒ½å·®ä¸å¤šï¼Œå®é™…ä¸Šæ˜¯å¿½ç•¥äº†ä¸€äº›ç»†èŠ‚çš„ï¼Œè¿™äº›ç»†èŠ‚å¯èƒ½ä¼šæˆä¸º
      
    
    </summary>
    
      <category term="MySQL" scheme="http://yoursite.com/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Java NIO</title>
    <link href="http://yoursite.com/2020/10/23/JavaNIO/"/>
    <id>http://yoursite.com/2020/10/23/JavaNIO/</id>
    <published>2020-10-23T09:19:32.000Z</published>
    <updated>2021-07-13T12:27:08.584Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€é—¨è§å±±ï¼Œæœ€è¿‘æ‰“ç®—çœ‹ä¸€ä¸‹nettyï¼Œåšè¿™ä¹ˆé•¿æ—¶é—´å¾®æœåŠ¡nettyè¿˜æ²¡çœ‹è¿‡æ˜¯ä¸æ˜¯å¤ªé£˜äº†ï¼Œè¿™ç¯‡æ˜¯nettyçš„èƒŒæ™¯çŸ¥è¯†</p><h3 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h3><p>Non-blocking I/O éé˜»å¡I/Oï¼›ä¸ä¼ ç»Ÿé˜»å¡I/Oç›¸æ¯”æœ€å¤§çš„æ—¶é˜»å¡å’Œéé˜»å¡çš„åŒºåˆ«ï¼›é™¤æ­¤ä¹‹å¤–NIOæ“ä½œçš„æ˜¯ç¼“å†²åŒºï¼Œä»¥å—çš„å½¢å¼å¤„ç†æ•°æ®ï¼Œä¼ ç»ŸI/Oä»¥æ•°æ®æµçš„å½¢å¼å¤„ç†æ•°æ®ï¼›è€Œä¸”NIOæ”¯æŒäº†Selectorï¼›æˆ‘çš„ç®€å•ç†è§£ï¼Œä¼ ç»ŸI/Oç›¸å½“äºæ‹¿ä¸€æ ¹æ°´ç®¡ï¼ˆå•å‘çš„ï¼‰æ’å…¥åˆ°æ°´æ¡¶é‡Œï¼Œè®©æ°´ä»æ°´æ¡¶ä¸­æµå‡ºï¼Œä»æ°´ç®¡ä¸­å¾—åˆ°æ°´ï¼ˆæ•°æ®ï¼‰ï¼›NIOåˆ™æ˜¯ç”¨æ°´ç®¡ï¼ˆåŒå‘çš„æ°´ç®¡ï¼Ÿæ —å­å¯èƒ½æ¯”è¾ƒç³™ä½†å°±æ˜¯è¿™ä¹ˆä¸ªæ„æ€ï¼‰å°†æ¡¶ä¸­çš„æ°´æµå…¥ä¸€ä¸ªå°æ°´æ± ä¸­ï¼ˆç¼“å†²åŒºï¼‰ï¼Œä»å°æ°´æ± ä¸­å¾—åˆ°æ°´ï¼ˆæ•°æ®ï¼‰ï¼›æ‰€ä»¥åŸºäºæµçš„è¯»å†™åªèƒ½æŒ‰é¡ºåºæ¥ï¼Œä¸èƒ½æ”¹å˜è¯»å†™çš„ä½ç½®ï¼Œä¸”åªèƒ½æ˜¯å•å‘çš„ï¼Œè€Œå¯¹äºç¼“å†²åŒºçš„æ•°æ®æ¥è¯´å°±å¯ä»¥éšæ„ä¿®æ”¹è¯»å†™çš„æŒ‡é’ˆäº†</p><h4 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h4><ul><li>ç”¨æ¥è¿›è¡ŒIOæ“ä½œï¼ˆæ–‡ä»¶IOæˆ–ç½‘ç»œIOï¼‰ï¼Œä¸BIOçš„Streamç±»ä¼¼ï¼Œä¸åŒçš„æ—¶Channelæ˜¯åŒå‘çš„Streamåªèƒ½æ˜¯å•å‘çš„ï¼›Channelè¯»å†™çš„å¯¹è±¡æ˜¯Buffer</li></ul><h4 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h4><ul><li>ç”¨æ¥å­˜æ”¾Channelè¯»å†™çš„æ•°æ®ï¼Œå…¶å®å°±æ˜¯å†…å­˜ä¸­çš„ä¸€å—åŒºåŸŸï¼Œä¿å­˜ä¸åŒç±»å‹çš„æ•°æ®(ByteBufferï¼ŒCharBufferç­‰ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°ç»„ï¼Œå­—èŠ‚æ•°ç»„ï¼Œå­—ç¬¦æ•°ç»„ç­‰)ï¼›é¦–å…ˆé€šè¿‡Channelå°†æ•°æ®å†™å…¥åˆ°Bufferä¸­ï¼Œå†å¯¹Bufferè¿›è¡Œè¯»å†™ï¼Œflip()åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œclear()æˆ–compact()åˆ‡æ¢åˆ°å†™æ¨¡å¼<ul><li>å¯¹Bufferæ¯æ¬¡è¯»å†™ä¹‹åBufferéƒ½ä¼šè®°å½•å½“å‰çš„çŠ¶æ€ï¼Œé€šè¿‡capacityï¼ˆBufferçš„æœ€å¤§å€¼ï¼‰ï¼Œpositionï¼ˆä¸‹æ¬¡è¯»æˆ–å†™çš„ä½ç½®ï¼Œæ¯æ¬¡è¯»å†™åæ›´æ–°ï¼‰ï¼Œlimitï¼ˆBufferä¸­æ•°æ®çš„å¤§å°ï¼‰ä¸‰ä¸ªå±æ€§ï¼›0 &lt;= position &lt;= limit &lt;= capacity</li><li>å‘ç¼“å†²åŒºå†™å…¥æ•°æ®æ—¶ï¼Œlimit = capacityï¼Œ position = ä¸‹ä¸€æ¬¡å†™å…¥çš„ä½ç½®ï¼ˆåˆå§‹ä¸º0ï¼‰ï¼›å¦‚æœæƒ³è¯»å‡ºç¼“å†²åŒºçš„æ•°æ®ï¼Œè°ƒç”¨filp()æ–¹æ³•åˆ‡æ¢ä¸ºè¯»ï¼Œlimit = ä¸‹ä¸€æ¬¡å†™å…¥çš„ä½ç½®ï¼ˆå³è¯»çš„è¾¹ç•Œï¼‰ï¼Œposition = 0ï¼ˆä»å¤´å¼€å§‹è¯»ï¼‰ï¼›è¯»å®Œæ•°æ®æƒ³è¦ç»§ç»­å†™ï¼Œè°ƒç”¨clear()æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯ç¼“å†²åŒºé‡Œçš„æ•°æ®æ¸…ç©ºï¼Œè€Œæ˜¯å°†positioné‡æ–°æŒ‡å‘0ï¼Œlimit = capacity ä¸å†™çš„çŠ¶æ€ä¸€æ ·ï¼Œæ–°å†™å…¥çš„æ•°æ®ä¼šè¦†ç›–åˆ°ç¼“å†²åŒºä¸­ï¼›compact()æ–¹æ³•ï¼Œå°†è¯»æ¨¡å¼ä¸‹position-limitçš„æ•°æ®å¤åˆ¶åˆ°bufferçš„å¼€å¤´ï¼Œç›¸å½“ä¸å°†å·²ç»è¯»è¿‡çš„æ•°æ®è¦†ç›–æ‰ï¼Œlimit = capacityï¼Œposition = limit - position</li></ul></li></ul><h4 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h4><ul><li>NIOéé˜»å¡çš„ç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡Selectorä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ç›‘å¬å¤šä¸ªChannelçš„IOäº‹ä»¶ï¼Œæ–¹æ³•æ˜¯å°†æ‰€æœ‰Channelæ³¨å†Œåˆ°Selectorä¸­(è¿™é‡ŒChannelå¿…é¡»æ˜¯éé˜»å¡çš„)ï¼Œå¹¶æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼ŒSelector#selectæ–¹æ³•æ‰¾åˆ°äº‹ä»¶å‘ç”Ÿçš„Channelè¿›è¡Œä¸‹ä¸€æ­¥å·¥ä½œï¼Œselectè¿™ä¸€æ­¥æ˜¯é˜»å¡çš„å¦‚æœäº‹ä»¶æ²¡æœ‰å‘ç”Ÿå°†ä¸€ç›´é˜»å¡ï¼Œselectçš„æ“ä½œç³»ç»Ÿçš„å®ç°ä¸ºIOå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼ˆselectï¼Œpollï¼Œepollï¼‰ï¼ŒLinuxä¸‹ä½¿ç”¨epoll</li></ul><p>ç®€å•ç½—åˆ—ä¸€ä¸‹IOæ¨¡å‹ï¼Œå’Œç›¸å…³å®ç°</p><h5 id="é˜»å¡I-O"><a href="#é˜»å¡I-O" class="headerlink" title="é˜»å¡I/O"></a>é˜»å¡I/O</h5><p>çº¿ç¨‹å‘èµ·I/Oè¯·æ±‚ä¼šä¸€ç›´é˜»å¡ç­‰å¾…I/Oæ¡ä»¶å°±ç»ª</p><h5 id="éé˜»å¡I-O"><a href="#éé˜»å¡I-O" class="headerlink" title="éé˜»å¡I/O"></a>éé˜»å¡I/O</h5><p>çº¿ç¨‹å‘èµ·I/Oè¯·æ±‚åï¼Œå¦‚æœI/Oæ¡ä»¶ä¸æ˜¯å°±ç»ªçŠ¶æ€ç«‹å³è¿”å›ä¸€ä¸ªçŠ¶æ€ä¸ä¼šä¸€ç›´ç­‰å¾…ï¼Œå¯ä»¥å…ˆåšå…¶ä»–çš„ä»»åŠ¡ï¼Œé—´éš”ä¸€æ®µæ—¶é—´æŸ¥çœ‹I/Oæ¡ä»¶æ˜¯å¦å°±ç»ªï¼Œå¦‚æœå°±ç»ªè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ</p><h5 id="å¤šè·¯å¤ç”¨I-O"><a href="#å¤šè·¯å¤ç”¨I-O" class="headerlink" title="å¤šè·¯å¤ç”¨I/O"></a>å¤šè·¯å¤ç”¨I/O</h5><p>éé˜»å¡I/Oçº¿ç¨‹éœ€è¦ä¸€ç›´å»è¯¢é—®I/Oäº‹ä»¶æ˜¯å¦å°±ç»ªï¼Œå¦‚æœçº¿ç¨‹å¾ˆå¤šæ¯ä¸ªçº¿ç¨‹éƒ½ä¸å¬çš„å»è½®è¯¢I/Oäº‹ä»¶å¿…å°†é€ æˆèµ„æºçš„æµªè´¹ï¼›å¤šè·¯å¤ç”¨I/Oå°†æ‰€æœ‰çº¿ç¨‹çš„I/Oè¯·æ±‚æ³¨å†Œåˆ°ä¸€ä¸ªæ–°çš„çº¿ç¨‹ä¸­ï¼ˆselectï¼‰ï¼Œç”±è¿™ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè½®è¯¢å»æŸ¥çœ‹I/Oæ¡ä»¶æ˜¯å¦å°±ç»ªï¼Œæœ‰å°±ç»ªçŠ¶æ€å°±é€šçŸ¥å¯¹åº”çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼›ç›¸å½“äºæ˜¯æŠŠéé˜»å¡I/Oä¸­å¤šçº¿ç¨‹æŸ¥çœ‹I/Oæ¡ä»¶çš„äº‹æƒ…å§”æ‰˜ç»™äº†å•ç‹¬çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œæé«˜äº†ç³»ç»Ÿçš„ååé‡ï¼›</p><p>åœ¨Linuxä¸­è¯¥æ¨¡å‹çš„å®ç°æœ‰selectï¼Œpollå’Œepollçš„ç³»ç»Ÿè°ƒç”¨ï¼ŒæœåŠ¡ç«¯æ¥å—è¿æ¥ï¼Œselectå’Œpolléƒ½ä¼šå°†è¿æ¥æ„Ÿå…´è¶£çš„I/Oäº‹ä»¶ä¿å­˜åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼ˆfdé›†åˆï¼Œåœ¨Linuxä¸­I/Oæ˜¯æ–‡ä»¶ï¼‰ï¼Œæ¯æ¬¡Selector#selectä¼ é€’ç»™å†…æ ¸ï¼Œå†…æ ¸å»å¯»æ‰¾é›†åˆä¸­æ»¡è¶³æ¡ä»¶çš„I/Oï¼Œè¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°é‡ï¼Œç”¨æˆ·çº¿ç¨‹å¾—åˆ°æ»¡è¶³I/Oæ¡ä»¶çš„æ•°é‡ï¼Œéœ€è¦å†æ¬¡éå†é›†åˆæ‰¾åˆ°æ»¡è¶³I/Oæ¡ä»¶çš„è¿æ¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(2n)ï¼›epollä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼Œé¦–å…ˆå°†è¿æ¥æ„Ÿå…´è¶£çš„I/Oæ³¨å†Œåˆ°å†…æ ¸ï¼Œå¹¶ä¸”æ³¨å†Œäº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“æ»¡è¶³I/Oæ¡ä»¶ä¼šå‘ç”Ÿå›è°ƒå°†è¯¥I/Oå¯¹åº”çš„fdç§»åŠ¨åˆ°å†…æ ¸ä¸­çš„å°±ç»ªé˜Ÿåˆ—ï¼Œæ¯æ¬¡selectåªéœ€ä»å°±ç»ªé˜Ÿåˆ—ä¸­è¯»å–å…·å¤‡I/Oæ¡ä»¶çš„æ•°é‡å³å¯ï¼Œå†è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œï¼Œå½“æœ‰mï¼ˆm&lt;=nï¼‰ä¸ªè¿æ¥å…·å¤‡æ¡ä»¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(m)</p><h5 id="ä¿¡å·é©±åŠ¨I-O"><a href="#ä¿¡å·é©±åŠ¨I-O" class="headerlink" title="ä¿¡å·é©±åŠ¨I/O"></a>ä¿¡å·é©±åŠ¨I/O</h5><p>è¿™ä¸ªæ„Ÿè§‰å’Œå¤šè·¯å¤ç”¨I/Oå·®ä¸å¤šï¼Œè¿™é‡Œå°†å¤šçº¿ç¨‹çš„I/Oæ“ä½œæ³¨å†Œä¸ºä¸€ä¸ªä¿¡å·ï¼Œä¿¡å·ä¸­æœ‰å›è°ƒå‡½æ•°ï¼Œå½“ä¿¡å·å‘ç”Ÿcallå›è°ƒå‡½æ•°é€šçŸ¥ç”¨æˆ·çº¿ç¨‹ï¼Œå…ˆç®€å•è¿™ä¹ˆç†è§£</p><h5 id="å¼‚æ­¥I-O"><a href="#å¼‚æ­¥I-O" class="headerlink" title="å¼‚æ­¥I/O"></a>å¼‚æ­¥I/O</h5><p>çº¿ç¨‹å‘å‡ºI/Oè¯·æ±‚åä¸éœ€è¦åšä»»ä½•æ“ä½œï¼ŒI/Oæ“ä½œå®Œå…¨ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®Œæˆï¼Œä¹‹åä¼šé€šçŸ¥çº¿ç¨‹I/Oå·²ç»å®Œæˆ</p><p>å…·ä½“ä¾‹å­å¯ä»¥å‚è€ƒ<a href="https://segmentfault.com/a/1190000006824091" target="_blank" rel="noopener">è¿™é‡Œ</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¼€é—¨è§å±±ï¼Œæœ€è¿‘æ‰“ç®—çœ‹ä¸€ä¸‹nettyï¼Œåšè¿™ä¹ˆé•¿æ—¶é—´å¾®æœåŠ¡nettyè¿˜æ²¡çœ‹è¿‡æ˜¯ä¸æ˜¯å¤ªé£˜äº†ï¼Œè¿™ç¯‡æ˜¯nettyçš„èƒŒæ™¯çŸ¥è¯†&lt;/p&gt;
&lt;h3 id=&quot;NIO&quot;&gt;&lt;a href=&quot;#NIO&quot; class=&quot;headerlink&quot; title=&quot;NIO&quot;&gt;&lt;/a&gt;NIO&lt;/h3&gt;&lt;p&gt;No
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼é”çš„å¥—è·¯-watchdogå®ç°</title>
    <link href="http://yoursite.com/2020/10/19/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E5%A5%97%E8%B7%AF-watchdog%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2020/10/19/åˆ†å¸ƒå¼é”çš„å¥—è·¯-watchdogå®ç°/</id>
    <published>2020-10-19T13:38:46.000Z</published>
    <updated>2021-07-13T12:27:08.592Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€é—¨è§å±±ï¼Œåˆ†å¸ƒå¼é”ç”¨æ¥ä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¸šåŠ¡é€»è¾‘çš„åŸå­æ€§ä»¥åŠäº’æ–¥ï¼ŒåŸç†å°±æ˜¯é”çš„åŸç†ï¼Œå¤šä¸ªç³»ç»Ÿä¸€åŒå»ç«äº‰åŒä¸€ä¸ªèµ„æºï¼ˆç±»æ¯”å•æœºç¯å¢ƒä¸‹å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€å—å†…å­˜ï¼‰ï¼Œè·å¾—èµ„æºçš„ç³»ç»Ÿå¯ä»¥è®¤ä¸ºæ˜¯åŠ é”æˆåŠŸï¼Œå¦åˆ™åŠ é”å¤±è´¥ï¼›ä¸‹é¢æ€»ç»“ä¸€ä¸ªç®€å•å¯ç”¨çš„åˆ†å¸ƒå¼é”çš„å®ç°</p><h3 id="ä¸šåŠ¡åœºæ™¯"><a href="#ä¸šåŠ¡åœºæ™¯" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h3><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œä¸€å®šä¼šæœ‰å®šæ—¶ä»»åŠ¡æ“ä½œä¸€äº›æ•°æ®çš„éœ€æ±‚ï¼Œè€Œä¸”è¿™ä¸ªå®šæ—¶ä»»åŠ¡è¿˜å¿…é¡»è¦é«˜å¯ç”¨ï¼Œæ‰€ä»¥å°±å¿…é¡»è¦åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹è¿è¡Œï¼Œä½†æ˜¯åˆä¸èƒ½å¤šä¸ªç³»ç»Ÿä¸€èµ·è¿è¡Œï¼Œæ‰€ä»¥å°±éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Œèƒ½å¤Ÿä¿è¯ä¸€ä¸ªç³»ç»Ÿå»è¿è¡Œå®šæ—¶ä»»åŠ¡ï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿå‡ºç°å¼‚å¸¸äº†ï¼Œå…¶ä»–çš„ç³»ç»Ÿèƒ½å¤Ÿé¡¶ä¸Šæ¥å®Œæˆå‰©ä¸‹çš„ä»»åŠ¡ï¼Œç±»ä¼¼äºwatchdogçš„åŠŸèƒ½</p><p>æ€»ç»“äº†ä¸€ä¸ªæµç¨‹å›¾å¦‚ä¸‹</p><p><img src="/images/åˆ†å¸ƒå¼é”.png" alt="åˆ†å¸ƒå¼é”"></p><p>å¦‚å›¾æ‰€ç¤ºè¿™ä¸ªå¥—è·¯ï¼Œç®€å•æ— è„‘ï¼Œå®šæ—¶ä»»åŠ¡çš„æ—¶å€™lockä¸€ä¸‹ï¼ŒæˆåŠŸäº†å°±ç»§ç»­æ‰§è¡Œï¼Œå¤±è´¥äº†å°±returnï¼Œä¸‹ä¸€ä¸ªå‘¨æœŸå†lockï¼›æŠŠè¿‡æœŸæ—¶é—´è®¾ç½®çš„æ¯”å®šæ—¶ä»»åŠ¡å‘¨æœŸç¨å¾®é•¿ä¸€äº›ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªç³»ç»Ÿè·å–é”æˆåŠŸåï¼Œå¦‚æœæ²¡æœ‰æ„å¤–æƒ…å†µåé¢çš„å‘¨æœŸè¿˜æ˜¯è¿™ä¸ªç³»ç»Ÿè¿è¡Œï¼ˆç±»æ¯”äºjvmä¸­çš„åå‘é”ï¼Œä¸åŒçš„æ—¶è¿™ä¸ªä¼šä¸€ç›´åä¸ä¼šé”å‡çº§ï¼‰ï¼Œå½“ç³»ç»Ÿå‘é€å¼‚å¸¸æƒ…å†µï¼Œå…¶ä»–çš„ç³»ç»Ÿå°±ä¼šlockæˆåŠŸï¼Œç»§ç»­åé¢çš„ä»»åŠ¡ï¼Œå¯ä»¥å®Œæˆä¸€ä¸ªç®€å•é«˜å¯ç”¨çš„å®šæ—¶ä»»åŠ¡</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>ä¸Šé¢è®²è¿‡ï¼Œåˆ†å¸ƒå¼é”çš„åŸç†å°±æ˜¯èƒ½å¤Ÿä¿è¯äº’æ–¥ï¼Œåœ¨ä¸€ä¸ªæ‰€æœ‰ç³»ç»Ÿéƒ½èƒ½è®¿é—®åˆ°çš„åœ°æ–¹å»åšæ–‡ç« ï¼ŒåŸºäºè¿™ç‚¹å°±æœ‰å¾ˆå¤šç§å®ç°ï¼Œæ¯”å¦‚æ•°æ®åº“è¿™æ ·æä¾›å­˜å‚¨çš„å·¥å…·(mysqlã€redisã€zkã€etcdç­‰ç­‰)ï¼Œç†è®ºä¸Šæ‰€æœ‰æ•°æ®åº“éƒ½å¯ä»¥ç”¨æ¥å®ç°åˆ†å¸ƒå¼é”ç”šè‡³æ–‡ä»¶éƒ½å¯ä»¥ï¼Œå°±çœ‹è‡ªå·±çš„éœ€æ±‚äº†ï¼›é€šå¸¸çš„è¯ä½¿ç”¨æ•°æ®åº“ã€rediså’Œzkçš„æ¯”è¾ƒå¤š</p><h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p>mysqlçš„è¯æ˜¯é€šè¿‡æ•°æ®åº“çš„å”¯ä¸€ç´¢å¼•ä¿è¯åŸå­æ€§ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªè¡¨ç”¨äºå­˜é”çš„ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦ä¸€äº›å¿…å¡«å­—æ®µ</p><ul><li>lockName - å”¯ä¸€ç´¢å¼•ï¼Œé”çš„åç§°</li><li>modifyTime - ä¿®æ”¹æ—¶é—´</li><li>owerIp - è·å–é”çš„Ip</li><li>lockTime - é”çš„æœ‰æ•ˆæ—¶é—´</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">public boolean lock(lockName, lockTime)&#123;</span><br><span class="line">    // è·å–å½“å‰çš„é”</span><br><span class="line">Lock currentLock = lockDao.findLockByLockName(lockName);</span><br><span class="line">// å½“å‰æ²¡æœ‰åŠ é”</span><br><span class="line">if (currentLock == null) &#123;</span><br><span class="line">    return tryLock(lockName, maxLockTime);//åŠ é”</span><br><span class="line">&#125;</span><br><span class="line">//  é”è¿‡æœŸäº†å¹¶ä¸”æˆåŠŸé‡Šæ”¾é” -&gt; é‡æ–°åŠ é”ï¼Œé‡Šæ”¾é”å¼‚å¸¸è¿”å›false</span><br><span class="line">    if (currentTimeMillis-currentLock.getModifyTime().TimeMills &gt; currentLock.getMaxLockTime()) &#123;</span><br><span class="line">        return unlock(lockName) ? tryLock(lockName, maxLockTime) : false;</span><br><span class="line">    &#125;</span><br><span class="line">    // é”æ²¡è¿‡æœŸä¸”è‡ªå·±å æœ‰é”ä¸”é”æ²¡è¿‡æœŸ ç»­ç§Ÿ</span><br><span class="line">    if (currentLock.getOwnerIP().equals(NetUtils.getLocalHost())) &#123;</span><br><span class="line">        renewLock(currentLock);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void renewLock(Lock currentLock) &#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        currentLock.setModifyTime(new Date());</span><br><span class="line">        lockDao.update(currentLock);</span><br><span class="line">    &#125;catch(Exception e)&#123;</span><br><span class="line">        // ç»­ç§Ÿå¤±è´¥ï¼Œä½†é”æ²¡è¿‡æœŸï¼Œä»ç„¶æœ‰æ•ˆ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public boolean tryLock(String lockName, long maxLockTime) &#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        lockDao.save(new Lock(lockName, NetUtils.getLocalHost(), maxLockTime));</span><br><span class="line">        return true;</span><br><span class="line">    &#125;catch (Exception e)&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public boolean unlock(String lockName) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        lockDao.deleteLockByLockName(lockName);</span><br><span class="line">        // å¯èƒ½å­˜åœ¨å…¶ä»–çº¿ç¨‹æŠŠå½“å‰çº¿ç¨‹çš„é”é‡Šæ”¾æ‰ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®çº¿ç¨‹çš„æŒæœ‰è€…è¿›è¡Œé‡Šæ”¾é”çš„æ“ä½œ</span><br><span class="line">        // åœ¨æˆ‘çš„åœºæ™¯ä¸‹å¯ä»¥ä¿è¯å®šæ—¶ä»»åŠ¡ä¸€å®šä¼šåœ¨é”çš„æœ‰æ•ˆæ—¶é—´å†…æ‰§è¡Œå®Œæˆï¼Œæ•…ä¸è€ƒè™‘è¿™ç§æƒ…å†µ</span><br><span class="line">        return true;</span><br><span class="line">    &#125;catch (Exception e) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h4><p>redisç›¸è¾ƒäºmysqlè€Œè¨€ååé‡æœ‰äº†æ˜¾è‘—çš„æé«˜ï¼Œå¹¶ä¸”ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—åŸå­æ“ä½œçš„apiï¼Œè€Œä¸”è¿˜æœ‰è¿‡æœŸæ—¶é—´çš„apiä¸éœ€è¦ï¼Œå¯ä»¥å¾ˆç®€å•çš„å®ç°åˆ†å¸ƒå¼é”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public boolean lock(lockName, lockTime)&#123;</span><br><span class="line">    // è·å–å½“å‰çš„é”</span><br><span class="line">String value = redis.get(lockName);</span><br><span class="line">// å½“å‰æ²¡æœ‰åŠ é”</span><br><span class="line">if (value == null) &#123;</span><br><span class="line">    return tryLock(lockName, maxLockTime);//åŠ é”</span><br><span class="line">&#125;</span><br><span class="line">    // redisè‡ªå·±ä¼šæ¸…ç†è¿‡æœŸçš„key, é”æ²¡è¿‡æœŸä¸”è‡ªå·±å æœ‰é”ä¸”é”æ²¡è¿‡æœŸ ç»­ç§Ÿ</span><br><span class="line">    if (value.equals(NetUtils.getLocalHost())) &#123;</span><br><span class="line">        renewLock(lockName, period);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void renewLock(Strng lockName, long period) &#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        // periodä¸ºå®šæ—¶ä»»åŠ¡çš„å‘¨æœŸæ—¶é—´ï¼Œå› ä¸ºlockTimeè¦æ¯”periodå¤§ï¼Œæ¯æ¬¡ç»­æœŸlockTimeåé”çš„è¿‡æœŸæ—¶é—´ä¼šè¶Šæ¥è¶Šå¤§</span><br><span class="line">        redis.expire(lockName, redis.ttl(lockName)+period);</span><br><span class="line">    &#125;catch(Exception e)&#123;</span><br><span class="line">        // ç»­ç§Ÿå¤±è´¥ï¼Œä½†é”æ²¡è¿‡æœŸï¼Œä»ç„¶æœ‰æ•ˆ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public boolean tryLock(String lockName, long maxLockTime) &#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        return redis.setNx(lockName, NetUtils.getLocalHost(), maxLockTime));</span><br><span class="line">    &#125;catch (Exception e)&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public boolean unlock(String lockName) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        lockDao.deleteLockByLockName(lockName);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;catch (Exception e) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç»™äº†ä¸¤ç§æ–¹å¼çš„ç®€å•å®ç°ï¼Œå®é™…è¿‡ç¨‹ä¸­è¿˜éœ€è¦è€ƒè™‘å¼‚å¸¸æƒ…å†µçš„ç»†èŠ‚ï¼Œé™¤æ­¤ä»¥å¤–è¿˜æœ‰å¾ˆå¤šç§å®ç°çš„æ–¹å¼åªæ˜¯åˆ—ä¸¾äº†ä¸¤ç§ï¼Œå¥—ç”¨æµç¨‹å›¾ä¸Šçš„å¥—è·¯ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„watchdogçš„åŠŸèƒ½</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¼€é—¨è§å±±ï¼Œåˆ†å¸ƒå¼é”ç”¨æ¥ä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¸šåŠ¡é€»è¾‘çš„åŸå­æ€§ä»¥åŠäº’æ–¥ï¼ŒåŸç†å°±æ˜¯é”çš„åŸç†ï¼Œå¤šä¸ªç³»ç»Ÿä¸€åŒå»ç«äº‰åŒä¸€ä¸ªèµ„æºï¼ˆç±»æ¯”å•æœºç¯å¢ƒä¸‹å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€å—å†…å­˜ï¼‰ï¼Œè·å¾—èµ„æºçš„ç³»ç»Ÿå¯ä»¥è®¤ä¸ºæ˜¯åŠ é”æˆåŠŸï¼Œå¦åˆ™åŠ é”å¤±è´¥ï¼›ä¸‹é¢æ€»ç»“ä¸€ä¸ªç®€å•å¯ç”¨çš„åˆ†å¸ƒå¼é”çš„å®ç°&lt;/p&gt;
&lt;h3 id=&quot;ä¸šåŠ¡åœºæ™¯&quot;&gt;
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Springä¸­beançš„ç”Ÿå‘½å‘¨æœŸæ€»ç»“</title>
    <link href="http://yoursite.com/2020/10/09/Spring%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2020/10/09/Springç”Ÿå‘½å‘¨æœŸæ€»ç»“/</id>
    <published>2020-10-09T12:00:44.000Z</published>
    <updated>2021-07-13T12:27:08.587Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘éå¸¸çš„å¿™ç¢Œï¼Œåšå®¢ä¹Ÿä¸€ç›´æ²¡æœ‰æ›´æ–°ï¼Œå¯æƒœè‡ªå·±ä¸€ç›´æ²¡æœ‰æ—¶é—´å»çœ‹æ–°çš„ä¸œè¥¿è¿˜æƒ³æ›´æ–°åšå®¢ï¼Œå¿ƒæœ‰ä½™è€ŒåŠ›ä¸è¶³ï¼Œé‚£å°±æŠŠæ—§çš„çŸ¥è¯†æ¸©ä¹ ä¸€ä¸‹ï¼Œæ¥â€œæ•·è¡â€ä¸€ä¸‹ï¼›åºŸè¯ä¸å¤šè¯´ï¼Œè¦çœ‹springä¸­beanå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸè¦ä»BeanFactoryæ¥å£ä¸­çœ‹ï¼Œå¦‚å›¾ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</p><ul><li>xxxxAwareæ¥å£çš„æ–¹æ³•</li><li>BeanPostProcessoræ¥å£çš„postProcessBeforeInitializationæ–¹æ³•</li><li>InitializingBeanæ¥å£çš„afterPropertiesSetæ–¹æ³•</li><li>è‡ªå®šä¹‰çš„initæ–¹æ³•</li><li>BeanPostProcessoræ¥å£çš„postProcessAfterInitializationæ–¹æ³•</li></ul><p>é”€æ¯</p><ul><li>DestructionAwareBeanPostProcessorçš„postProcessBeforeDestructionæ–¹æ³•</li><li>DisposableBeanæ¥å£çš„destroyæ–¹æ³•</li><li>è‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•</li></ul><p><img src="/images/spring-beanç”Ÿå‘½å‘¨æœŸ1.png" alt="spring-beanç”Ÿå‘½å‘¨æœŸ1"></p><p>ä¸‹é¢ç»“åˆæºç ç”»ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸå›¾</p><p><img src="/images/spring-beanç”Ÿå‘½å‘¨æœŸ2.png" alt="spring-beanç”Ÿå‘½å‘¨æœŸ2"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘éå¸¸çš„å¿™ç¢Œï¼Œåšå®¢ä¹Ÿä¸€ç›´æ²¡æœ‰æ›´æ–°ï¼Œå¯æƒœè‡ªå·±ä¸€ç›´æ²¡æœ‰æ—¶é—´å»çœ‹æ–°çš„ä¸œè¥¿è¿˜æƒ³æ›´æ–°åšå®¢ï¼Œå¿ƒæœ‰ä½™è€ŒåŠ›ä¸è¶³ï¼Œé‚£å°±æŠŠæ—§çš„çŸ¥è¯†æ¸©ä¹ ä¸€ä¸‹ï¼Œæ¥â€œæ•·è¡â€ä¸€ä¸‹ï¼›åºŸè¯ä¸å¤šè¯´ï¼Œè¦çœ‹springä¸­beanå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸè¦ä»BeanFactoryæ¥å£ä¸­çœ‹ï¼Œå¦‚å›¾ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†&lt;/p&gt;
&lt;ul&gt;
&lt;
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘åˆæ¥å…¥é—¨k8säº†</title>
    <link href="http://yoursite.com/2020/06/30/%E6%88%91%E5%8F%88%E6%9D%A5%E5%85%A5%E9%97%A8k8s%E4%BA%86/"/>
    <id>http://yoursite.com/2020/06/30/æˆ‘åˆæ¥å…¥é—¨k8säº†/</id>
    <published>2020-06-30T14:49:30.000Z</published>
    <updated>2021-07-13T12:27:08.593Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>ä¹‹å‰åˆ†æè¿‡Dockerå®¹å™¨æŠ€æœ¯ï¼Œåœ¨å®¹å™¨æŠ€æœ¯å¾ˆå¿«çš„è¢«å¹¿å¤§ä½¿ç”¨ä¹‹åï¼Œå¯¹äºä¸šåŠ¡å¤æ‚çš„å…¬å¸æ¥è¯´å¾€å¾€éœ€è¦éå¸¸å¤šçš„å®¹å™¨ï¼Œè€Œæ¯æ¬¡éƒ½éœ€è¦docker runæˆ–è€…restartçš„è¯ä¹Ÿæ˜¯éå¸¸éº»çƒ¦çš„è€Œä¸”äººæ“ä½œçš„è¯è¿˜å®¹æ˜“å‡ºé”™ï¼Œè¿™å°±éœ€è¦ä¸€ä¸ªå®¹å™¨ç®¡ç†çš„ä¸€ä¸ªç»„ä»¶ï¼Œæ¯”å¦‚docker swarmã€mesoså’Œk8sï¼Œæœ€ç»ˆk8sè„±é¢–è€Œå‡ºç§°ä¸ºå¤§å¤šæ•°äººçš„é€‰æ‹©ï¼Œè€Œä¸”k8sè¿˜è¢«ç§°ä¸ºPaaSå¹³å°çš„æ“ä½œç³»ç»Ÿï¼Œé‚£ä¹ˆk8sèƒ½åšä»€ä¹ˆå‘¢ï¼Ÿ</p><p>Podï¼Œæ˜¯k8sæå‡ºçš„æ¦‚å¿µï¼Œæ˜¯k8sçš„æœ€å°è°ƒåº¦å•ä½ï¼ŒPodä¸­å¯ä»¥æœ‰ä¸€ä¸ªå®¹å™¨æˆ–è€…å¤šä¸ªå®¹å™¨</p><ul><li>Podè°ƒåº¦ï¼›k8sé‡‡ç”¨å£°æ˜å¼APIçš„æ–¹å¼ï¼Œç”¨æˆ·åªéœ€ç¼–å†™yamlæ–‡ä»¶æè¿°æ‰€æœŸæœ›çš„PodçŠ¶æ€(æ¯”å¦‚2ä¸ªå®¹å™¨ï¼Œ4c8g)ï¼Œk8sæ ¹æ®æ‰€æœŸæœ›çš„PodçŠ¶æ€è¿›è¡Œéƒ¨ç½²å’Œç»´æŠ¤</li><li>å¥åº·æ£€æŸ¥è‡ªåŠ¨æ¢å¤ï¼›ç›‘æ§é›†ç¾¤ä¸­Podçš„çŠ¶æ€å‘ç°å¼‚å¸¸Podè¿›è¡Œè¿ç§»æˆ–é‡å¯</li><li>åŠ¨æ€æ‰©ç¼©å®¹ï¼›æ£€æŸ¥Podè´Ÿè½½é«˜æ—¶åŠ¨æ€æ‰©å®¹è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼›åä¹‹å‡å°‘å®¹å™¨èŠ‚çœèµ„æº</li><li>è´Ÿè½½å‡è¡¡</li></ul><p>ç±»ä¼¼äºPodçš„è¿ç»´ç³»ç»Ÿï¼Œæœ‰äº†è¿™äº›åŠŸèƒ½å®Œå…¨å¯ä»¥å°†è‡ªå·±çš„ç³»ç»Ÿæ‰˜ç®¡ç»™k8sï¼Œå¯ä»¥å‡è½»è¿ç»´äººå‘˜çš„å·¥ä½œ</p><h3 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><p>master+slaveçš„æ¶æ„ï¼ŒmasterèŠ‚ç‚¹è´Ÿè´£ç³»ç»Ÿé€»è¾‘çš„å¤„ç†ï¼Œè°ƒåº¦ï¼ŒslaveèŠ‚ç‚¹æ¥å¹²æ´»ï¼Œä¸sparké›†ç¾¤çš„æ¨¡å¼æ˜¯ä¸€æ ·çš„</p><ul><li>masterèŠ‚ç‚¹ç»„ä»¶<ul><li>etcdï¼šåˆ†å¸ƒå¼kvæ•°æ®åº“ï¼Œç”¨äºä¿å­˜æ•°æ®(yamlæ–‡ä»¶)å’Œé›†ç¾¤çš„çŠ¶æ€ï¼Œå…¶ä»–ç»„ä»¶éƒ½é€šè¿‡api serverå‘etcdè¯»å†™æ•°æ®ï¼Œç†è§£ä¸ºç”¨æ¥ä¿å­˜çŠ¶æ€çš„æ•°æ®å±‚ï¼›etcdè¿˜æ˜¯é«˜å¯ç”¨çš„åˆ†å¸ƒå¼æ•°æ®åº“å¯ä»¥ä¿è¯masterçš„é«˜å¯ç”¨</li><li>api serverï¼šæä¾›apiæœåŠ¡ï¼Œè´Ÿè´£å„ä¸ªæ¨¡å—ä¹‹é—´çš„é€šä¿¡ï¼Œä¸åŒç»„ä»¶ä¹‹é—´äº¤äº’éƒ½éœ€è¦ç»è¿‡api serverï¼Œç†è§£ä¸ºæ•°æ®æ€»çº¿</li><li>controller managerï¼šè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œç¡®ä¿é›†ç¾¤çš„çŠ¶æ€ä¸etcdä¸­çš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œç†è§£ä¸ºMVCä¸­çš„Controllerå±‚ï¼›ä¾‹å¦‚å¥åº·æ£€æŸ¥ï¼ŒslaveèŠ‚ç‚¹ä¸­çš„kubectlä¼šå‘masterèŠ‚ç‚¹(é€šè¿‡api server)å®šæœŸæŠ¥å‘ŠèŠ‚ç‚¹ä¸­Podçš„çŠ¶æ€ï¼Œç›¸å½“äºslaveå‘masterå‘å¿ƒè·³ï¼Œå¿ƒè·³çŠ¶æ€ä¼šä¿å­˜åœ¨etcdä¸­ï¼ŒmasterèŠ‚ç‚¹ä¸­çš„controller managerä¼šå®šæœŸä»etcdä¸­è·å–slaveçš„çŠ¶æ€ï¼Œé’ˆå¯¹è¿™äº›çŠ¶æ€ä¸etcdä¸­ä¿å­˜çš„æœŸæœ›çŠ¶æ€æ¯”å¯¹è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œé€šè¿‡api serveré€šçŸ¥schedulerç»„ä»¶åˆ›å»ºä¸€ä¸ªè°ƒåº¦ä»»åŠ¡å‘é€ç»™slaveèŠ‚ç‚¹</li><li>schedulerï¼šè´Ÿè´£è°ƒåº¦ï¼Œå°†podè°ƒåº¦åˆ°åˆé€‚çš„nodeä¸­ï¼›åˆ›å»ºpodèµ„æºçš„æ—¶å€™ï¼Œé€šè¿‡etcdä¸­çš„çŠ¶æ€è°ƒåº¦åˆ°åˆé€‚çš„slaveèŠ‚ç‚¹ä¸­ï¼Œæ›´æ–°æˆ–è€…åˆ é™¤ä¹Ÿæ˜¯è¿™æ ·</li></ul></li><li>slaveç»„ä»¶<ul><li>kubeletï¼šå¯ä»¥ç†è§£ä¸ºé€šè¿‡å®ç°äº†ä¸€äº›æ¥å£æ¥å¯¹slaveèŠ‚ç‚¹è¿›è¡Œç®¡æ§æ“ä½œï¼›è´Ÿè´£ä¸masteré€šä¿¡ï¼Œé€šè¿‡CRI(Container Runtime Interface)æ“ä½œå®¹å™¨è¿è¡Œæ—¶(container runtime)ï¼Œç›¸å½“äºæ˜¯slaveèŠ‚ç‚¹ä¸­çš„æ§åˆ¶å™¨ï¼Œç†è§£ä¸ºé€šè¿‡CRIâ€å‘é€æŒ‡ä»¤â€åˆ°å®¹å™¨è¿è¡Œæ—¶ï¼Œå¯¹å½“å‰èŠ‚ç‚¹ä¸­podåšCRUDæ“ä½œï¼›è¿˜è´Ÿè´£é…ç½®å½“å‰slaveèŠ‚ç‚¹çš„ç½‘ç»œå’Œå­˜å‚¨ï¼Œé€šè¿‡è°ƒç”¨ç½‘ç»œæ’ä»¶å’Œå­˜å‚¨æ’ä»¶ä¸ºå®¹å™¨é…ç½®ç½‘ç»œï¼ˆCNI Container Networking Interfaceï¼‰å’ŒæŒä¹…åŒ–å­˜å‚¨ï¼ˆCSI Container Storage Interfaceï¼‰ï¼›</li><li>kube-proxyï¼šç”¨äºserviceçš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡iptableæœºåˆ¶ï¼›serviceæ˜¯ç›¸åŒæœåŠ¡çš„çš„å¤šä¸ªpodé›†åˆï¼Œç›¸å½“äºä¸€ä¸ªVIPèŒè´£ï¼Œä¸éœ€è¦å…³å¿ƒå…·ä½“æœåŠ¡çš„ipåªéœ€è®¿é—®æœåŠ¡çš„åŸŸåï¼Œç”±kube-proxyæ¥è½¬å‘åˆ°å…·ä½“çš„pod</li><li>container runtimeï¼šçœŸæ­£å¯¹podåšCRUDæ“ä½œçš„ç»„ä»¶ï¼Œç›¸å½“äºkubeletçš„slave</li></ul></li></ul><p><img src="/images/k8s.png" alt="k8s"></p><p>å¦‚ä¸Šå›¾åœ¨slaveèŠ‚ç‚¹ä¸­kubeletæ‰®æ¼”æ§åˆ¶å™¨çš„è§’è‰²æ¥æ“ä½œé€šè¿‡è¿›è¡Œæ—¶å¯¹Podè¿›è¡Œæ“ä½œï¼Œè€Œkube-proxyæ˜¯å°†è®¿é—®podçš„æµé‡è½¬å‘åˆ°ç›¸åº”çš„podä¸­ï¼Œä¸€ä¸ªpodåœ¨å¯åŠ¨ä¹‹å‰k8sä¼šåœ¨podä¸­å…ˆå¯åŠ¨ä¸€ä¸ªåˆå§‹å®¹å™¨ä¸ºè¿™ä¸ªå®¹å™¨æ·»åŠ Namespaceï¼Œnetworkï¼ŒVolumeè¿™äº›è®¾ç½®ï¼Œå†å°†åå¯åŠ¨çš„å®¹å™¨æ·»åŠ åˆ°åˆå§‹å®¹å™¨çš„Namespaceä¸­å»ï¼Œè¿™ä¸ªåˆå§‹å®¹å™¨ç”¨æ¥è¿›è¡Œè¿›ç¨‹éš”ç¦»ï¼Œä¸Podå…·æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œé€šå¸¸Podä¸­å®¹å™¨çš„è®¿é—®ï¼Œæ—¥å¿—æ”¶é›†ç­‰æ“ä½œéƒ½ä¼šç”±è¿™ä¸ªå®¹å™¨æ¥å®Œæˆï¼Œä¹Ÿå°±æ˜¯sidecarå®¹å™¨ï¼›è®¿é—®æŸä¸ªpodçš„æ—¶å€™é¦–å…ˆä¼šç»è¿‡iptablesçš„è§„åˆ™è½¬å‘åˆ°Podçš„sidecarå®¹å™¨é‡Œï¼Œå†ç”±sidecarå®¹å™¨è½¬å‘åˆ°ç›®æ ‡åº”ç”¨å®¹å™¨ä¸­ï¼Œsidecarå¯ä»¥å¤©ç„¶ç”¨æ¥åšå¾®æœåŠ¡ä¸­çš„æµé‡æ§åˆ¶ï¼ŒæœåŠ¡æ²»ç†ï¼Œç°åº¦å‘å¸ƒç­‰åŠŸèƒ½</p><p>å·¥ä½œåŸç†</p><ul><li>ç”¨æˆ·æäº¤äº†yamlæ–‡ä»¶ç»™apiserver</li><li>apiserverä¼šå°†æ•°æ®ä¿å­˜åˆ°etcdä¸­ï¼Œå†é€šçŸ¥scheduleræœ‰å®¹å™¨éœ€è¦è¢«è°ƒåº¦</li><li>scheduleræ ¹æ®é…ç½®é€‰æ‹©åˆé€‚çš„nodeï¼Œè¿”å›ç»™apiserver</li><li>apiserverå°†ç»“æœåŒæ­¥åˆ°etcdä¸­ï¼Œå†é€šçŸ¥å¯¹åº”nodeä¸­çš„kubectl</li><li>kubectlæ”¶åˆ°é€šçŸ¥åè°ƒç”¨container runtimeæ¥çœŸæ­£å»å¯åŠ¨è¿™ä¸ªé…ç½®çš„å®¹å™¨ï¼Œè°ƒç”¨storage pluginé…ç½®å­˜å‚¨ï¼Œè°ƒç”¨network pluginé…ç½®ç½‘ç»œ</li></ul><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><ul><li>Podï¼›Podæ˜¯k8sçš„æœ€å°è°ƒåº¦å•ä½ï¼ŒPodä¸­å¯ä»¥æœ‰ä¸€ä¸ªå®¹å™¨æˆ–è€…å¤šä¸ªå®¹å™¨ï¼›å‰é¢åˆ†æè¿‡dockeræ˜¯é€šè¿‡Namespaceå’ŒCgroupæŠ€æœ¯æ¥è¿›è¡Œè¿›ç¨‹çš„éš”ç¦»ï¼Œæ˜¯åŸºäºå•è¿›ç¨‹æ¨¡å‹å¹¶ä¸å…·å¤‡ç®¡ç†å¤šè¿›ç¨‹çš„èƒ½åŠ›ï¼Œï¼ˆå‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/83482791" target="_blank" rel="noopener">è¿™é‡Œ</a>å¤§æ¦‚æ˜¯æ˜¯æ— æ³•å›æ”¶åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹çš„èµ„æºçš„æ„æ€å› ä¸ºå›æ”¶è¿›ç¨‹èµ„æºéœ€è¦å‘çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼‰ï¼›k8sé€šè¿‡å°†å¤šä¸ªå®¹å™¨åŠ å…¥åˆ°åŒä¸€ä¸ªNamespaceä¸­å¹¶ç»™å¤´å·è¿›ç¨‹èµ‹äºˆäº†ç®¡ç†å¤šè¿›ç¨‹çš„èƒ½åŠ›ï¼Œæ‰€ä»¥è¯´ç›¸è¾ƒäºdockerå®¹å™¨æ¥è¯´k8sçš„Podæ¦‚å¿µæ›´åƒæ˜¯è™šæ‹Ÿæœºä¸€æ ·ï¼Œæä¾›äº†ä¼ ç»Ÿè™šæ‹Ÿæœºåˆ°å®¹å™¨ç¯å¢ƒçš„å®Œç¾è¿ç§»æ–¹æ¡ˆ</li><li>Deploymentï¼›å¯¹Podçš„ä¸€ä¸ªæŠ½è±¡ï¼Œå¯ä»¥å®šä¹‰Podçš„å‰¯æœ¬æ•°é‡ï¼Œç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨Deploymentæ¥æè¿°ä¸€ä¸ªåº”ç”¨é›†ç¾¤çš„çŠ¶æ€</li><li>ReplicaSetï¼›ç”¨æ¥æ§åˆ¶Podçš„ç‰ˆæœ¬ï¼ŒDeploymentä¸ä¼šä¹‹é—´æ§åˆ¶Podï¼Œè€Œæ˜¯é€šè¿‡ReplicaSetæ¥é—´æ¥æ§åˆ¶Podï¼Œä¸€ä¸ªPodçš„ç‰ˆæœ¬å¯¹åº”ä¸€ä¸ªRSï¼ˆå¯ä»¥å®ç°é‡‘ä¸é›€å‘å¸ƒï¼Œè“ç»¿å‘å¸ƒï¼‰</li><li>StatefulSetï¼›æœ‰çŠ¶æ€çš„Podè¿›è¡Œç¼–æ’ï¼›Podä¹‹é—´æœ‰æ‹“æ‰‘å…³ç³»çš„æ‹“æ‰‘çŠ¶æ€æˆ–è€…å­˜å‚¨çŠ¶æ€ï¼›</li><li>DaemonSetï¼›é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªDaemonPodï¼Œæ¯ä¸ªNodeä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œå¦‚æœæœ‰æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¼šè‡ªåŠ¨åˆ›å»ºï¼›æ¯”å¦‚nodeä¸­çš„å„ç§æ’ä»¶ï¼ˆç½‘ç»œï¼Œå­˜å‚¨ï¼Œç›‘æ§ï¼Œæ—¥å¿—ï¼‰</li><li>Serviceï¼›æä¾›äº†ä¸€ä¸ªæˆ–è€…å¤šä¸ªPodçš„è®¿é—®åœ°å€ï¼Œç”±äºPodçš„åœ°å€å¯èƒ½ä¼šå˜ï¼Œé€šè¿‡åŸŸåå¯ä»¥åšåˆ°ä¸ä¾èµ–äºå›ºå®šçš„ipåœ°å€è®¿é—®Podï¼Œç›¸å½“äºVIPï¼Œç”±kube-proxy+iptablesæ¥å…±åŒå®ç°</li><li>Jobï¼›ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œè¿è¡Œå®Œæˆåé€€å‡º</li><li>CronJobï¼›å®šæ—¶ä»»åŠ¡ï¼Œç”¨äºç¦»çº¿è®¡ç®—</li><li>ç­‰ç­‰ç­‰ç­‰ï¼Œåªæ˜¯äº†è§£åˆ°äº†è¿™äº›ï¼Œè¿˜æœ‰å¾ˆå¤šå»æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£å§</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h3&gt;&lt;p&gt;ä¹‹å‰åˆ†æè¿‡Dockerå®¹å™¨æŠ€æœ¯ï¼Œåœ¨å®¹å™¨æŠ€æœ¯å¾ˆå¿«çš„è¢«å¹¿å¤§ä½¿ç”¨ä¹‹åï¼Œå¯¹äºä¸šåŠ¡å¤æ‚çš„å…¬å¸æ¥è¯´å¾€å¾€éœ€è¦éå¸¸å¤šçš„å®¹å™¨ï¼Œè€Œæ¯æ¬¡éƒ½éœ€è¦docker run
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="k8s" scheme="http://yoursite.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€å¹´èœé¸¡å¸¦ä½ çœ‹å¾®æœåŠ¡</title>
    <link href="http://yoursite.com/2020/06/25/%E4%B8%80%E5%B9%B4%E8%8F%9C%E9%B8%A1%E5%B8%A6%E4%BD%A0%E7%9C%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    <id>http://yoursite.com/2020/06/25/ä¸€å¹´èœé¸¡å¸¦ä½ çœ‹å¾®æœåŠ¡/</id>
    <published>2020-06-25T08:36:16.000Z</published>
    <updated>2021-07-13T12:27:08.590Z</updated>
    
    <content type="html"><![CDATA[<p>å·¥ä½œå¿«ä¸€å¹´äº†ï¼Œæˆ‘ä»ä¸€ä¸ªåˆšå…¥èŒæ—¶å€™çš„å°ç™½å˜æˆäº†ç°åœ¨æœ‰ä¸€å¹´ç»éªŒçš„å°ç™½,åœ¨æˆ‘è¿™ä¸€å¹´çš„å·¥ä½œä¸­ä¿®ç‚¼è‡ªå·±ï¼Œç°åœ¨å¯ä»¥è¯´æ˜¯æŠŠè‡ªå·±çš„ä¸€æ¡è…¿æŠ¬è¿‡äº†å¾®æœåŠ¡çš„é—¨æ§›ï¼Œåœ¨è¿™ä¸ªä½ç½®çœ‹åˆ°äº†ä¸€ä¸‹ä¸œè¥¿ï¼ŒæŠŠæˆ‘çš„ç†è§£è®°å½•åˆ†äº«ä¸€ä¸‹ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éšç€å†å²è¿›ç¨‹çš„å‘å±•ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡é‡ä¹Ÿæ„ˆå‘è†¨èƒ€ï¼Œç³»ç»Ÿçš„ä¹Ÿä»åŸæ¥çš„å•ä½“æ¶æ„ï¼Œé€æ¸æ¼”åŒ–æˆå¾®æœåŠ¡æ¶æ„ï¼Œå°†é‡å¤çš„ä¸šåŠ¡é€»è¾‘æŠ½è±¡æˆåŸºç¡€çš„æœåŠ¡ï¼Œè¿™æ ·åšä¸ä»…ä»…å¯ä»¥å°†ä¸šåŠ¡è§£è€¦ï¼Œè¿˜é€šè¿‡å°†ä¸€ä¸ªå¤§çš„ç³»ç»Ÿæ‹†åˆ†æˆæœåŠ¡ç²’åº¦çš„å­ç³»ç»Ÿï¼Œå„ä¸ªå­ç³»ç»Ÿå•ç‹¬å¼€å‘ç¼–è¯‘æµ‹è¯•ä¸Šçº¿ï¼Œå¤§å¤§æé«˜äº†å¼€å‘çš„æ•ˆç‡ï¼ŒåŠ å¿«äº†ç³»ç»Ÿè¿­ä»£çš„é€Ÿåº¦ã€‚æ ¹æ®æˆ‘çš„ç†è§£ï¼Œå¾®æœåŠ¡æ¡†æ¶åŒ…æ‹¬RPCæ¡†æ¶å’Œæ³¨å†Œä¸­å¿ƒä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸‹é¢å°±æ¥åˆ†åˆ«ä»‹ç»ä¸€ä¸‹</p><h3 id="æ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸­å¿ƒ</h3><p>å¾®æœåŠ¡æ¡†æ¶æ˜¯ç”¨æ¥è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œæ¶‰åŠåˆ°è¿œç¨‹è°ƒç”¨å°±ä¼šæœ‰æœåŠ¡çš„æä¾›æ–¹ï¼ˆproviderï¼‰å’Œè°ƒç”¨æ–¹ï¼ˆconsumerï¼‰ï¼Œæ³¨å†Œä¸­å¿ƒçš„å·¥ä½œå°±æ˜¯è®©ä»–ä»¬å½¼æ­¤è®¤è¯†ï¼Œå³æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°ï¼Œé™¤æ­¤ä¹‹å¤–æ³¨å†Œä¸­å¿ƒè¿˜è´Ÿè´£å°†å¯¹æ–¹çŠ¶æ€çš„å˜åŒ–é€šçŸ¥åˆ°å¦ä¸€æ–¹ï¼Œé…ç½®ä¸‹å‘ç­‰åŠŸèƒ½ï¼Œä¸»è¦æœ‰CPå’ŒAPä¸¤ç§é€‰å‹çš„æ³¨å†Œä¸­å¿ƒ</p><ul><li>CP å¼ºä¸€è‡´æ€§ Zookeeperã€etcd â€¦<ul><li>ç”¨Zookeeperä¸¾ä¾‹æ¥è¯´ï¼Œå‘å¸ƒæœåŠ¡å°±ä¼šåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹ç»´æŠ¤æœåŠ¡æä¾›æ–¹å’Œè°ƒç”¨æ–¹çš„ä¿¡æ¯ï¼Œé€šè¿‡zkæœ¬èº«çš„watchæœºåˆ¶æ¥è§‚å¯ŸæœåŠ¡çŠ¶æ€å˜åŒ–</li><li>ç¼ºç‚¹æ˜¯å½“æœåŠ¡è§„æ¨¡å¾ˆå¤§æ—¶ï¼Œzkéœ€è¦æ•°æ®åŒæ­¥çš„æ—¶é—´å˜é•¿ï¼ŒæœŸé—´æœåŠ¡ä¸å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯é€‰æ‹©CPä¼šå‡ºç°çš„é—®é¢˜ï¼›æ•°æ®åŒæ­¥çš„è¯·æ±‚é‡å¤§å¾ˆå¯èƒ½å°†leaderæ‰“æŒ‚ï¼ˆæ¯”å¦‚è¯´æˆ‘äº†è§£åˆ°æ›¾ç»æœ‰æœåŠ¡å¤§è§„æ¨¡æ‰©å®¹ï¼Œä¸ºäº†ä¿è¯é¡ºåºæ‰€æœ‰followerå°†å†™è¯·æ±‚å‘é€ç»™leaderï¼Œå¤§é‡å†™è¯·æ±‚å¯¼è‡´leaderå®•æœºï¼Œé‡æ–°é€‰æ‹©leaderæœŸé—´æœåŠ¡ä¸å¯ç”¨ï¼Œæ–°çš„leaderç¬é—´åˆè¢«æ‰“æŒ‚ï¼‰</li></ul></li><li>AP å¼±ä¸€è‡´æ€§ æ¶ˆæ¯æ€»çº¿å‹<ul><li>æœåŠ¡æ³¨å†Œå’Œè®¢é˜…çš„æ•°æ®å…¨é‡ä¿å­˜åœ¨ä¸€ä¸ªå­˜å‚¨ä»‹è´¨ä¸­ï¼Œæ³¨å†Œä¸­å¿ƒä»å­˜å‚¨ä»‹è´¨ä¸­è·å–çš„æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œé€šè¿‡æ¶ˆæ¯æ€»çº¿åšæ•°æ®åŒæ­¥ï¼ˆæ¨æ‹‰ç»“åˆï¼Œç”¨ç‰ˆæœ¬å·ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼‰</li><li>æœåŠ¡è°ƒç”¨æ–¹ä»æ³¨å†Œä¸­å¿ƒè·å–æ•°æ®ä¿å­˜åœ¨è°ƒç”¨æ–¹çš„å†…å­˜ä¸­ï¼ŒåŒæ ·é‡‡ç”¨æ¨æ‹‰ç»“åˆï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼›<ul><li>æ¨ callbackæœºåˆ¶ï¼ŒæœåŠ¡è°ƒç”¨æ–¹åœ¨ç”Ÿæˆä»£ç†çš„ç›®æ ‡å¯¹è±¡ä¹‹å‰ä¼šå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…é…ç½®ï¼Œè®¢é˜…çš„æ—¶å€™ä¼šå°†callbackåºåˆ—åŒ–å‘é€ç»™æ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œä¸­å¿ƒæ”¶åˆ°å¸¦æœ‰callbackå‚æ•°çš„è¯·æ±‚ä¸ºcallbackåˆ›å»ºä»£ç†å¯¹è±¡ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªåå‘çš„RPCè°ƒç”¨ï¼ˆæœåŠ¡æä¾›æ–¹å‘æœåŠ¡è°ƒç”¨æ–¹å‘é€è¯·æ±‚å¤ç”¨å·²æœ‰çš„tcpè¿æ¥ï¼‰</li><li>æ‹‰ å¿ƒè·³ï¼ŒæœåŠ¡è°ƒç”¨æ–¹é€šå¸¸ä¼šå‘æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³æ¥å‘ŠçŸ¥è‡ªå·±çš„çŠ¶æ€ï¼Œå‘å¿ƒè·³çš„åŒæ—¶æ‹‰å–éœ€è¦æ›´æ–°çš„æ•°æ®åˆ°å†…å­˜ä¸­</li></ul></li></ul></li></ul><h3 id="RPCæ¡†æ¶"><a href="#RPCæ¡†æ¶" class="headerlink" title="RPCæ¡†æ¶"></a>RPCæ¡†æ¶</h3><p>RPCæ¡†æ¶ç”¨äºæœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œä¾‹å¦‚Dubboã€SpringCloudã€gRPCï¼Œé€šè¿‡ä¸åŒçš„åè®®å®ŒæˆæœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼›é™¤äº†æœ€åŸºæœ¬çš„é€šä¿¡ä»¥å¤–è¿˜åŒ…æ‹¬æœåŠ¡æ²»ç†ç­–å’Œæµé‡æ§åˆ¶çš„ç­–ç•¥ï¼ŒæœåŠ¡ç›‘æ§å’Œè¿½è¸ªï¼Œç­‰å…¶ä»–ç‰¹æ€§</p><h4 id="æœåŠ¡æ²»ç†-amp-æµé‡æ§åˆ¶"><a href="#æœåŠ¡æ²»ç†-amp-æµé‡æ§åˆ¶" class="headerlink" title="æœåŠ¡æ²»ç†&amp;æµé‡æ§åˆ¶"></a>æœåŠ¡æ²»ç†&amp;æµé‡æ§åˆ¶</h4><ul><li>æœåŠ¡ç®¡ç†<ul><li>æœåŠ¡èŠ‚ç‚¹çš„æ–°å¢åˆ é™¤ï¼›åˆ†ç»„ï¼ŒåŠ¨æ€åˆ†ç»„çš„è®¾ç½®ä¸å–æ¶ˆï¼›ä¸åŒç»´åº¦çš„ä¸Šä¸‹çº¿</li></ul></li><li>è·¯ç”±ç­–ç•¥<ul><li>è°ƒç”¨è€…å°†è¯·æ±‚è·¯ç”±è‡³å›ºå®šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªæœåŠ¡æä¾›æ–¹çš„èŠ‚ç‚¹ï¼›ç”¨äºæµ‹è¯•ï¼Œæˆ–è€…ç°åº¦å‘å¸ƒ</li></ul></li><li>è´Ÿè½½å‡è¡¡<ul><li>å°†æœåŠ¡è°ƒç”¨æ–¹çš„è¯·æ±‚å‡åŒ€çš„å‘é€ç»™é€‰æ‹©åˆ°çš„æœåŠ¡æä¾›æ–¹èŠ‚ç‚¹ï¼›éšæœºã€åŠ æƒéšæœºã€è½®è¯¢ã€åŠ æƒè½®è¯¢ã€æœ€å°‘æ´»è·ƒã€ä¸€è‡´æ€§å“ˆå¸Œï¼Œä¹‹å‰åˆ†æè¿‡ä¸åŒçš„ç­–ç•¥å®ç°ï¼Œç§»æ­¥<a href="http://yywang.top/2020/03/27/%E6%8F%AD%E7%A7%98%E4%BA%AC%E4%B8%9C%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95/" target="_blank" rel="noopener">è¿™é‡Œ</a>æŸ¥çœ‹</li></ul></li><li>å®¹é”™ç­–ç•¥(é›†ç¾¤ç­–ç•¥)<ul><li>failover å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ä¸åŒçš„æœåŠ¡æä¾›æ–¹è¿›è¡Œé‡è¯• ï¼ˆä¸šåŠ¡é”™è¯¯é‡è¯•å’Œå®‰å…¨é‡è¯•ï¼Ÿï¼‰</li><li>failfast å¿«é€Ÿå¤±è´¥ï¼Œå¤±è´¥</li><li>failsafe å¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸ç›´æ¥å¿½ç•¥ï¼Œç”¨äºè®°å½•å®¡è®¡æ—¥å¿—</li><li>broadcast å¹¿æ’­è°ƒç”¨ï¼Œå¤±è´¥çš„è·³è¿‡</li><li>pinpoint ç‚¹å¯¹ç‚¹è°ƒç”¨</li></ul></li><li>é™æµ ç”¨äºä¿æŠ¤æœåŠ¡æä¾›æ–¹ï¼ˆæŒ‰APPï¼Œæ¥å£ï¼Œåˆ†ç»„ï¼ŒIPï¼Œæ–¹æ³•ä¸åŒçš„ç»´åº¦ï¼‰åœ¨æœåŠ¡æä¾›æ–¹å’Œè°ƒç”¨æ–¹éƒ½å¯ä»¥å®ç°é™æµçš„é€»è¾‘<ul><li>åœ¨æœåŠ¡æä¾›æ–¹çš„é™æµé€»è¾‘åªæ˜¯é’ˆå¯¹äºå•ä¸ªå®¹å™¨æˆ–è€…ç‰©ç†æœºï¼ŒæœåŠ¡æä¾›æ–¹åªéœ€å¤„ç†å°äºæœ€å¤§é™æµå€¼çš„è¯·æ±‚å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå…¶ä»–çš„æœåŠ¡èŠ‚ç‚¹ï¼Œå‡ ä¹æ²¡æœ‰æ€§èƒ½çš„æŸè€—ï¼Œå…·ä½“çš„é™æµç®—æ³•ä¹‹å‰å†™è¿‡ä¸€ç¯‡é™æµç®—æ³•çš„<a href="http://yywang.top/2020/05/14/get%E9%99%90%E6%B5%81%E5%A7%BF%E5%8A%BF/#more" target="_blank" rel="noopener">ä»‹ç»</a></li><li>åœ¨æœåŠ¡è°ƒç”¨æ–¹åšé™æµé€»è¾‘å¯é’ˆå¯¹æ•´ä¸ªé›†ç¾¤çš„ç»´åº¦ï¼Œä¸€èˆ¬æ˜¯å…ˆè¯·æ±‚é›†ä¸­å¼çš„æœåŠ¡æ¥åˆ¤æ–­æœ¬æ¬¡è¯·æ±‚æ˜¯å¦è¶…è¿‡é™æµå€¼ï¼Œå¤šäº†ä¸€æ¬¡rpcè¯·æ±‚ï¼Œä¼šå½±å“æ€§èƒ½ï¼Œåœ¨äº¬ä¸œå¾®æœåŠ¡æ¡†æ¶ä¸­ï¼Œé™æµé€»è¾‘åœ¨æœåŠ¡è°ƒç”¨æ–¹æœ‰monitorå’Œcounterä¸¤ç§å®ç°æ–¹å¼ï¼›monitoræœåŠ¡ï¼Œå¯¹esä¸­çš„ç›‘æ§æ—¥å¿—è¿›è¡Œç»Ÿè®¡å¼‚æ­¥åˆ¤æ–­æ˜¯å¦è¶…è¿‡é™æµå€¼ï¼Œå› ä¸ºæ˜¯å¼‚æ­¥è¯·æ±‚ä¸å½±å“æ€§èƒ½ï¼Œä½†é™æµçš„å®æ—¶æ€§æ— æ³•ä¿è¯ä¸å®Œå…¨ç²¾å‡†ï¼Œç›®å‰è¿™ç§æ–¹å¼å·²ç»åºŸå¼ƒï¼›counteræœåŠ¡ï¼Œé€šè¿‡è®¿é—®ç¼“å­˜æ•°æ®åº“å®æ—¶ç»Ÿè®¡è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é™æµå€¼ï¼Œç²¾åº¦å‡†ç¡®ï¼Œä¼šå½±å“æ€§èƒ½ï¼›</li></ul></li><li>ç†”æ–­ï¼Œç”¨äºä¿æŠ¤æœåŠ¡è°ƒç”¨æ–¹<ul><li>é˜²æ­¢æœåŠ¡è°ƒç”¨æ–¹ä¾èµ–ä¸‹æ¸¸æœåŠ¡å¼‚å¸¸ï¼ŒæŒ‚èµ·å¤§é‡è¯·æ±‚å‹å®å®¹å™¨ï¼Œæ¯”å¦‚æœåŠ¡è°ƒç”¨æ–¹ä¾èµ–ä¸‹æ¸¸çš„æœåŠ¡ï¼Œç”±äºä¸‹æ¸¸çš„æœåŠ¡å¼‚å¸¸å¯¼è‡´çŸ­æ—¶é—´å†…æ— æ³•æ”¶åˆ°å“åº”è€Œä¸€ç›´æŒ‚èµ·ï¼Œå¦‚æœæŒ‚èµ·çš„è¯·æ±‚è¿‡å¤§å¯èƒ½ä¼šä½¿æœåŠ¡ä¸å¯ç”¨ï¼Œç†”æ–­ç­–ç•¥å¯ä»¥å¿«é€Ÿè¿”å›å¤±è´¥ä»è€Œä¿æŠ¤æœåŠ¡ä¸è¢«æ‰“æŒ‚æ‰</li><li>ç†”æ–­å™¨ï¼ˆæ‰“å¼€ï¼ŒåŠæ‰“å¼€ï¼Œå…³é—­ä¸‰ç§çŠ¶æ€ï¼›æœåŠ¡è°ƒç”¨çš„å¤±è´¥ç‡é«˜äºæŸä¸€é˜ˆå€¼ï¼Œæ–°çš„è¯·æ±‚ç›´æ¥è¿”å›å¤±è´¥ä¸è¿›è¡Œå¤„ç†ï¼Œè¿›å…¥åŠæ‰“å¼€çŠ¶æ€ï¼›åŠæ‰“å¼€çŠ¶æ€ä¸€æ®µæ—¶é—´åï¼Œå¼€å§‹å¤„ç†æ–°çš„è¯·æ±‚ï¼Œå¦‚æœå¤±è´¥ç‡ä»ç„¶é«˜äºé˜ˆå€¼ï¼Œåˆ™è¿›å…¥å…³é—­çŠ¶æ€å¦åˆ™è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼‰</li></ul></li><li>åˆ†ç»„<ul><li>ä¸šåŠ¡æµé‡éš”ç¦»ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡ä¸å…¶ä»–ä¸šåŠ¡éš”ç¦»å¼€æ¥</li><li>æ§åˆ¶åŒæœºæˆ¿è°ƒç”¨ï¼Œä¸åŒçš„æœºæˆ¿è®¾ç½®ä¸åŒçš„åˆ†ç»„ï¼Œé€šè¿‡åˆ†ç»„æ¥å®ç°ç›¸åŒæœºæˆ¿çš„æœåŠ¡ä»¥åŠäº’ç›¸è°ƒç”¨</li><li>åŠ¨æ€åˆ†ç»„ï¼›å¯ä»¥ç”¨æ¥æµé‡åˆ‡æ¢ï¼›å¯ä»¥åº”å¯¹çªå‘çš„æµé‡æ¿€å¢ï¼Œåˆ†ç»„ä¸­é¢„ç•™çš„å®¹å™¨ä¾ç„¶ä¸èƒ½é¡¶ä½æµé‡ï¼Œå¯ä»¥å€Ÿç”¨å…¶ä»–åˆ†ç»„ä¸­å®¹å™¨æ¥åˆ†æ‹…ä¸€éƒ¨åˆ†æµé‡</li></ul></li><li>æµé‡å›æ”¾ï¼›æœåŠ¡è°ƒç”¨æ–¹å¼‚æ­¥å­˜å‚¨è¯·æ±‚å’Œå“åº”ï¼Œç”¨æ¥æµ‹è¯•</li></ul><h4 id="æœåŠ¡ç›‘æ§å’Œè¿½è¸ª"><a href="#æœåŠ¡ç›‘æ§å’Œè¿½è¸ª" class="headerlink" title="æœåŠ¡ç›‘æ§å’Œè¿½è¸ª"></a>æœåŠ¡ç›‘æ§å’Œè¿½è¸ª</h4><p>ç”¨æ¥æŸ¥çœ‹è¯·æ±‚é‡ï¼ˆTPSï¼Œå®æ—¶å’Œå†å²æ•°æ®ï¼‰ã€å“åº”æ—¶é—´</p><ul><li>æœåŠ¡ç›‘æ§ æ•°æ®é‡‡é›†æ–¹å¼ a)é€šè¿‡æœåŠ¡ä¸»åŠ¨ä¸ŠæŠ¥ï¼Œå°†æ—¥å¿—æ•°æ®å‘é€åˆ°æ—¥å¿—èŠ‚ç‚¹ b)é€šè¿‡ä»£ç†æ”¶é›†ï¼Œå°†æ—¥å¿—æ•°æ®ä¿å­˜åˆ°æœ¬åœ°ï¼Œä»£ç†è§£ææœ¬åœ°æ—¥å¿—ï¼ˆsidecarï¼‰</li><li>æœåŠ¡è¿½è¸ª æ•´æ¡é“¾è·¯ç”¨TraceIdæ ‡è®°ï¼Œå…¶ä¸­ç»è¿‡çš„æ¯ä¸ªæœåŠ¡èŠ‚ç‚¹éƒ½æœ‰ä¸åŒçš„SpanIdï¼Œæœ€ç»ˆé€šè¿‡å¯¹æ•°æ®ç»“æ„çš„è§£æç»˜åˆ¶é“¾è·¯å›¾</li></ul><h4 id="å…¶ä»–ç‰¹æ€§"><a href="#å…¶ä»–ç‰¹æ€§" class="headerlink" title="å…¶ä»–ç‰¹æ€§"></a>å…¶ä»–ç‰¹æ€§</h4><ul><li>å¥åº·æ£€æŸ¥ï¼Œé€šè¿‡å‘é€å¿ƒè·³æŠ¥å‘ŠèŠ‚ç‚¹çš„çŠ¶æ€<ul><li>æ¯”å¦‚åœ¨äº¬ä¸œå¾®æœåŠ¡æ¡†æ¶ä¸­è°ƒç”¨æ–¹éš”30så‘å†…å­˜ä¸­çš„æœåŠ¡æä¾›æ–¹åˆ—è¡¨å‘é€å¿ƒè·³ï¼ˆæ¢æ´»ï¼‰ï¼Œæ¢æ´»ä¸åŒç»“æœå°†åˆ—è¡¨åˆ†æˆä¸åŒçš„çŠ¶æ€ï¼ˆå¥åº·ã€äºšå¥åº·ã€æ­»äº¡ï¼‰ï¼Œè°ƒç”¨æ–¹æ¯æ¬¡ä»å¥åº·èŠ‚ç‚¹çš„é›†åˆä¸­é€‰æ‹©ä¸€ä¸ªå‘èµ·è°ƒç”¨ï¼›äºšå¥åº·çŠ¶æ€åªå‘å¿ƒè·³ä¸å‘è¯·æ±‚ï¼Œå½“å¿ƒè·³æ¢å¤ç§»è‡³å¥åº·èŠ‚ç‚¹ï¼Œå¥åº·-&gt;äºšå¥åº·ï¼ˆè¿ç»­6æ¬¡å¿ƒè·³å¤±è´¥ï¼Œå¼‚å¸¸å¿ƒè·³å¯é‡è¯•ä¸¤æ¬¡ï¼Œä¸‰æ¬¡éƒ½å¤±è´¥åˆ™å½“å‰å¿ƒè·³å¤±è´¥ï¼‰ï¼Œè¿ç»­60æ¬¡å¿ƒè·³å¤±è´¥åŠ å…¥é‡è¿çš„é›†åˆä¸­ï¼Œ10sé‡è¿ä¸€æ¬¡</li><li>æœåŠ¡æä¾›æ–¹å’ŒæœåŠ¡è°ƒç”¨æ–¹éƒ½ä¼šæƒ³æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³æŠ¥å‘ŠçŠ¶æ€ï¼Œ30sï¼ŒæœåŠ¡æä¾›æ–¹è¿ç»­8å°æ—¶æ²¡æœ‰å‘æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³ä¼šåˆ é™¤</li></ul></li><li>ä¼˜é›…å¯åœ<ul><li>åœæ­¢ï¼›æ‹’ç»æ–°çš„è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªæ­£åœ¨å…³é—­çš„å¼‚å¸¸ï¼Œè°ƒç”¨æ–¹å®‰å…¨é‡è¯•-&gt;åœ¨è¶…æ—¶æ—¶é—´èŒƒå›´å†…å¤„ç†å®Œå·²ç»æ¥å—çš„è¯·æ±‚ï¼Œæ—¶é—´èŒƒå›´ä»¥å¤–çš„è¿”å›å¼‚å¸¸-&gt;å¼€å§‹å…³é—­åŠ¨ä½œé‡Šæ”¾èµ„æº</li><li>å¯åŠ¨ï¼›å¯åŠ¨é¢„çƒ­ï¼Œéšç€å¯åŠ¨æ—¶é—´çš„å¢åŠ é€æ­¥å¢åŠ æµé‡ï¼Œå®šæ—¶åŠ¨æ€ä¿®æ”¹è´Ÿè½½å‡è¡¡ç­–ç•¥çš„æƒé‡ï¼›æå‰åŠ è½½ç¼“å­˜æ•°æ®ï¼›æ³¨å†Œä¹‹å‰æ¨¡æ‹Ÿè°ƒç”¨é€»è¾‘ä¿è¯æœåŠ¡å¯ç”¨-&gt;å»¶è¿Ÿæš´éœ²ï¼Œå¾…æ‰€æœ‰çš„æœåŠ¡å®Œå…¨å¯åŠ¨å®Œå†æƒ³æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡</li></ul></li><li>æ³›åŒ–è°ƒç”¨ï¼›åœ¨æ²¡æœ‰æ¥å£å’ŒAPIçš„æƒ…å†µä¸‹å‘èµ·è°ƒç”¨ï¼Œå°†æœåŠ¡æä¾›æ–¹çš„æ¥å£åï¼Œåˆ†ç»„ï¼Œæ–¹æ³•åï¼Œå‚æ•°å‘é€ç»™æœåŠ¡æä¾›æ–¹ï¼Œéšåæ ¹æ®ä¿¡æ¯é€šè¿‡åå°„è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼ˆ1.æµ‹è¯•å¹³å°ï¼Œæ— éœ€ä¿®æ”¹é…ç½®é‡å¯å†å‘èµ·è°ƒç”¨ï¼›2.ç»Ÿä¸€ç½‘å…³ï¼Œæ— éœ€å¼•å…¥jaråŒ…ï¼‰</li><li>å®‰å…¨é—®é¢˜ï¼›æœåŠ¡è°ƒç”¨æ–¹é€šè¿‡å¼•å…¥jaråŒ…çš„æ–¹å¼æ¥å‘èµ·è°ƒç”¨ï¼Œå¯èƒ½ä¼šå‘ç”Ÿåœ¨æœåŠ¡æä¾›æ–¹ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å‘èµ·è°ƒç”¨ï¼Œæˆä¸ºå‹å®æœåŠ¡çš„æœ€åä¸€æ ¹ç¨»è‰<ul><li>æœåŠ¡çš„æä¾›æ–¹å’Œè°ƒç”¨æ–¹å•†é‡ä¸€ä¸ªtokenï¼ŒæœåŠ¡æä¾›æ–¹æ”¶åˆ°è¯·æ±‚åœ¨filterä¸­æ ¡éªŒéšå¼ä¼ å‚çš„çš„tokenåˆ¤æ–­æ˜¯å¦é€šè¡Œ</li><li>åœ¨äº¬ä¸œå¾®æœåŠ¡æ¡†æ¶ä¸­è¿˜å¯ä»¥å†æœåŠ¡æ²»ç†å¹³å°ä¸­å¼€å¯APPè°ƒç”¨ï¼Œåªæœ‰ç”³è¯·äº†APPè°ƒç”¨è¢«æœåŠ¡æä¾›æ–¹å®¡æ ¸ä¹‹åæ‰èƒ½ä»æ³¨å†Œä¸­å¿ƒä¸­è·å–æœåŠ¡åˆ—è¡¨</li></ul></li></ul><h4 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h4><p>å°†è¿œç¨‹è°ƒç”¨çš„è¿‡ç¨‹é€šè¿‡åŠ¨æ€ä»£ç†å°è£…èµ·æ¥ï¼Œä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ï¼Œä½¿ç”¨è€…å¯ä»¥ä¸“å¿ƒäºä¸šåŠ¡é€»è¾‘è€Œä¸å¿…å…³å¿ƒRPCè°ƒç”¨çš„è¿‡ç¨‹ï¼›</p><ul><li>æœåŠ¡æä¾›æ–¹å¯åŠ¨<ul><li>ä¸æ³¨å†Œä¸­å¿ƒå»ºç«‹è¿æ¥ï¼Œè®¢é˜…å…¨å±€é…ç½®ï¼ˆè¿œç¨‹callbackæœºåˆ¶ï¼Œå‘é€è¯·æ±‚å°†callbackåºåˆ—åŒ–å‘é€å‡ºå»ï¼Œæ¥æ”¶æ–¹å¯¹callbackè¿›è¡ŒåŠ¨æ€ä»£ç†å›è°ƒå‘é€æ–¹ï¼‰</li><li>å¼€å¯å¹¶æš´éœ²æœåŠ¡çš„ç«¯å£ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œ</li></ul></li><li>æœåŠ¡è°ƒç”¨æ–¹å¯åŠ¨<ul><li>ä¸æ³¨å†Œä¸­å¿ƒå»ºç«‹è¿æ¥ï¼Œè®¢é˜…å…¨å±€é…ç½®</li><li>åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œæ„é€ æ‰§è¡Œé“¾ filter chainï¼ˆå†…ç½®çš„filter-&gt;è‡ªå®šä¹‰çš„filter-&gt;æœ€åçš„filteræ ¹æ®é…ç½®ç”Ÿæˆè·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡ç­–ç•¥çš„é€»è¾‘ï¼‰æ³¨å…¥åˆ°ä»£ç†å¯¹è±¡ä¸­</li><li>å‘æ³¨å†Œä¸­å¿ƒè®¢é˜…æœåŠ¡åˆ—è¡¨</li></ul></li><li>è°ƒç”¨æ–¹å‘èµ·è°ƒç”¨<ul><li>è°ƒç”¨å‰é¦–å…ˆè¿è¡Œæ‰§è¡Œé“¾ï¼Œæœ€åçš„filterè¿‡æ»¤å‡ºæœåŠ¡æä¾›æ–¹èŠ‚ç‚¹ï¼ˆæœ¬åœ°è°ƒç”¨-&gt;è·¯ç”±ç­–ç•¥-&gt;é»‘ç™½åå•-&gt;è´Ÿè½½å‡è¡¡ï¼‰</li><li>åºåˆ—åŒ–è¯·æ±‚çš„å‚æ•°ï¼Œå°è£…åè®®æŠ¥æ–‡ï¼Œæ ¹æ®é…ç½®çš„é›†ç¾¤å®¹é”™ç­–ç•¥é€šè¿‡nettyæ¡†æ¶å‘æœåŠ¡æä¾›æ–¹å‘é€è¯·æ±‚ï¼Œ</li></ul></li><li>æœåŠ¡æ–¹å¤„ç†è¯·æ±‚<ul><li>æ¥æ”¶åˆ°è¯·æ±‚é¦–å…ˆé€‚é…åè®®ï¼Œæ ¹æ®åè®®å’Œåºåˆ—åŒ–ã€å‹ç¼©çš„æ–¹å¼è§£æè¯·æ±‚</li><li>è¿è¡Œæ‰§è¡Œé“¾ï¼Œæœ€åçš„filterä¼šæ ¹æ®æ¥å£åã€æ–¹æ³•å’Œå‚æ•°ä¿¡æ¯é€šè¿‡åå°„è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œæœ€åå°†æ¥å£è¿”å›ç»™è°ƒç”¨æ–¹ï¼Œè°ƒç”¨æ–¹è¿›è¡Œååºåˆ—åŒ–å¾—åˆ°å“åº”ç»“æœ</li></ul></li></ul><h2 id="Service-Mesh-æœåŠ¡ç½‘æ ¼"><a href="#Service-Mesh-æœåŠ¡ç½‘æ ¼" class="headerlink" title="Service Mesh æœåŠ¡ç½‘æ ¼"></a>Service Mesh æœåŠ¡ç½‘æ ¼</h2><p>å¾®æœåŠ¡å‘å±•åˆ°ä»Šå¤©ä¸€äº›å¼Šç«¯ä¹Ÿé€æ¸æ˜¾éœ²å‡ºæ¥ï¼Œæœ€å¤§çš„ç—›ç‚¹å°±æ˜¯ä¸šåŠ¡å…¥ä¾µä¸¥é‡ï¼Œä½¿ç”¨è€…é€šè¿‡å¼•å…¥jaråŒ…ä½¿ç”¨å¾®æœåŠ¡æ¡†æ¶ï¼Œå¦‚æœè¦å¢åŠ æ–°çš„åŠŸèƒ½ç‚¹æˆ–è€…ä¿®å¤ä¸€ä¸ªç´§æ€¥çš„bugå°±éœ€è¦å‘Šè¯‰æ‰€æœ‰ä½¿ç”¨æ–¹å‡çº§ä¸€ä¸‹jaråŒ…ï¼Œè¿™ä¼šéå¸¸å›°éš¾ï¼Œå¯èƒ½ä½ ä¼šè¯´mavenä¿®æ”¹ä¸€ä¸‹ç‰ˆæœ¬ä¸å°±å¥½äº†ï¼Œä½†æ˜¯åœ¨äº¬ä¸œå¦‚æœéå¸¸é‡è¦çš„ä¸šåŠ¡æ¯”å¦‚äº¤æ˜“æœåŠ¡ï¼Œæ˜¯ä¸å¸Œæœ›å»åšæ”¹å˜çš„ï¼Œè€Œä¸”æœåŠ¡ä¸Šä¸‹æœ‰ç€éå¸¸å¤æ‚çš„ä¾èµ–å…³ç³»ç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼›å¦å¤–å¾®æœåŠ¡æ¡†æ¶ä¸æ”¯æŒè·¨è¯­è¨€ï¼Œå¯¹åº”å¾®æœåŠ¡æ¡†æ¶çš„ä¸åŒè¯­è¨€ç›´æ¥æƒ³è¦äº’ç›¸è°ƒç”¨å¾—éœ€è¦å¤šä¸ªè¯­è¨€å¼€å‘çš„æ¡†æ¶ç‰ˆæœ¬æ‰è¡Œï¼Œè¿™å¯¹äºå¼€å‘å’Œç»´æŠ¤çš„æˆæœ¬éƒ½éå¸¸å¤§ã€‚</p><p>Service Meshå®Œç¾çš„è§£å†³äº†è¿™ä¸¤ä¸ªç—›ç‚¹ï¼Œå¯ä»¥ç®€å•å°†å…¶ç†è§£ä¸ºå°†RPCæ¡†æ¶çš„å†…å®¹æŠ½è±¡æˆsidecarï¼Œå¾®æœåŠ¡æ¡†æ¶çš„jaråŒ…ä¸­åªä¿ç•™ä¸sidecaré€šä¿¡çš„æ€»è¦é€»è¾‘å³å¯ï¼Œè¿™äº›é€»è¾‘åŸºæœ¬ä¸Šæ˜¯ä¸ä¼šå˜çš„ï¼Œå½“å‘å¸ƒä½ çš„åº”ç”¨å®¹å™¨çš„æ—¶å€™æ³¨å…¥sidecarï¼ŒåŸæ¥æ˜¯å®¹å™¨ä¸­çš„åº”ç”¨ç›´æ¥äº’ç›¸è°ƒç”¨çš„æ–¹å¼ç°åœ¨å˜æˆäº†å®¹å™¨ä¸­çš„åº”ç”¨ä¸å®¹å™¨ä¸­çš„sidecaré€šä¿¡ï¼Œsidecaré€šè¿‡iptablesè§„åˆ™åšè¯·æ±‚è½¬å‘ï¼Œå¹¶ä¸”æœåŠ¡æ²»ç†ï¼Œæµé‡æ§åˆ¶çš„è¿™äº›é€»è¾‘æŠ½è±¡åˆ°äº†sidecarä¸­è¿™å¯¹äºä¸šåŠ¡æ–¹æ¥è®²åªéœ€é‡æ–°æ³¨å…¥sidecarå³å¯å®Œæˆå‡çº§ï¼Œå¯¹äºåº”ç”¨æ¥è®²å‡çº§è¿‡ç¨‹æ˜¯é€æ˜çš„ã€‚</p><p><img src="/images/å¾®æœåŠ¡.png" alt="upload successful"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å·¥ä½œå¿«ä¸€å¹´äº†ï¼Œæˆ‘ä»ä¸€ä¸ªåˆšå…¥èŒæ—¶å€™çš„å°ç™½å˜æˆäº†ç°åœ¨æœ‰ä¸€å¹´ç»éªŒçš„å°ç™½,åœ¨æˆ‘è¿™ä¸€å¹´çš„å·¥ä½œä¸­ä¿®ç‚¼è‡ªå·±ï¼Œç°åœ¨å¯ä»¥è¯´æ˜¯æŠŠè‡ªå·±çš„ä¸€æ¡è…¿æŠ¬è¿‡äº†å¾®æœåŠ¡çš„é—¨æ§›ï¼Œåœ¨è¿™ä¸ªä½ç½®çœ‹åˆ°äº†ä¸€ä¸‹ä¸œè¥¿ï¼ŒæŠŠæˆ‘çš„ç†è§£è®°å½•åˆ†äº«ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;head
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>è“¦ç„¶å›é¦–servlet</title>
    <link href="http://yoursite.com/2020/06/11/%E8%93%A6%E7%84%B6%E5%9B%9E%E9%A6%96servlet/"/>
    <id>http://yoursite.com/2020/06/11/è“¦ç„¶å›é¦–servlet/</id>
    <published>2020-06-11T09:16:07.000Z</published>
    <updated>2021-07-13T12:27:08.596Z</updated>
    
    <content type="html"><![CDATA[<p>å¬åˆ°Servletæˆ‘æ—¢ç†Ÿæ‚‰åˆé™Œç”Ÿï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦è¿˜æ˜¯åœ¨2013å¹´ï¼Œå½“æ—¶å¯¹äºè¯¾ç¨‹è®¾è®¡æ°´å¹³çš„æˆ‘æ¥è¯´ä»…ä»…æœ‰ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼Œåæ¥æ¥è§¦äº†sshä¹‹åå¥½åƒå·²ç»ç–è¿œäº†servletï¼Œæˆ‘åªåœ¨å†™ä¸šåŠ¡é€»è¾‘ä¸€ç›´åˆ°ç°åœ¨ï¼Œæˆ‘å¯¹äºservletçš„å°è±¡è¿˜åœç•™åœ¨å£°æ˜ï¼Œåœ¨web.xmlä¸­é…ç½®ï¼Œå†™mappingè¿™äº›ï¼Œè¯´æ˜springçš„è§£è€¦æ˜¯çœŸçš„å¼ºğŸ‘ï¼Œè®©æˆ‘å¯¹servletçš„è®¤è¯†æ­¢æ­¥æ¦†æ¬¡ï¼Œä»Šå¤©å°±å›é¦–çœ‹çœ‹è¿™ä½â€œè€æœ‹å‹â€ï¼Œå°±å¤§æ¦‚æ¢³ç†ä¸€ä¸‹å§</p><ul><li><p>Servletæ˜¯ä¸€ä¸ªæ¥å£ï¼ŒæœåŠ¡å™¨ç”¨æ¥å¤„ç†Httpçš„è¯·æ±‚çš„ï¼Œæ¥å£ä¸­ä¸»è¦serviceæ–¹æ³•ç”¨æ¥å¤„ç†httpè¯·æ±‚ï¼Œinitå’Œdestroyæ–¹æ³•è¡¨ç¤ºservletåˆå§‹åŒ–å’Œé”€æ¯æ˜¯è°ƒç”¨ï¼Œæ€»ç»“ä¸€å¥è¯æ¥è¯´ï¼Œservletæ˜¯ä¸€ç§è§„èŒƒï¼Œæ˜¯æœåŠ¡å™¨å¤„ç†Httpè¯·æ±‚çš„è§„èŒƒã€‚</p></li><li><p>Tomcatå°±æ˜¯å®ç°servletè§„èŒƒ(æ¥å£)çš„ä¸€ä¸ªğŸŒ°ï¼ŒTomcatä¸­å®ç°äº†servletå®¹å™¨ç”¨æ¥ç®¡ç†servletï¼Œå½“æ”¶åˆ°Httpè¯·æ±‚åå°†è¯·æ±‚å°è£…æˆrequestå¯¹è±¡ï¼Œå¹¶æ ¹æ®è¯·æ±‚çš„ä¿¡æ¯æ‰¾åˆ°å¯¹åº”servlet(web.xml)ï¼Œå°†è¯·æ±‚äº¤ç»™å¯¹åº”çš„servletå¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœçš„responseå¯¹è±¡è½¬åŒ–æˆHttpçš„åè®®è¿”å›ç»™æµè§ˆå™¨</p></li></ul><p><img src="/images/servlet.png" alt="upload successful"></p><ol start="0"><li>å«å®¹å™¨çš„å°±å¯ä»¥ç†è§£ä¸ºå­—é¢æ„æ€ï¼Œç”¨æ¥å­˜æ”¾ä¸€ç±»ä¸œè¥¿ï¼›webå®¹å™¨é‡Œå­˜å‚¨webåº”ç”¨ï¼ŒServletå®¹å™¨é‡Œå­˜å‚¨Servletï¼ŒSpringå®¹å™¨å­˜æ”¾beanç­‰ç­‰ç­‰ç­‰</li><li>Tomcatå°±æ˜¯ä¸€ä¸ªwebå®¹å™¨ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªwebåº”ç”¨ï¼Œæ¯ä¸ªåº”ç”¨åœ¨Tomcatå¯åŠ¨æ—¶éƒ½ä¼šåˆå§‹åŒ–ä¸€ä¸ªservletå®¹å™¨ï¼Œç”¨æ¥ä¿å­˜åº”ç”¨ä¸‹çš„servletï¼›Tomcatå¯åŠ¨åä¼šç›‘å¬åœ¨8080ç«¯å£ï¼Œç­‰å¾…æ¥æ”¶è¯·æ±‚çš„åˆ°æ¥ï¼Œåœ¨æ”¶åˆ°è¯·æ±‚åæ ¹æ®è¯·æ±‚ä¿¡æ¯é¦–å…ˆåˆ°æƒ³è¦è®¿é—®çš„ç›®æ ‡webåº”ç”¨ä¸­çš„web.xmlæ–‡ä»¶é‡Œæ‰¾åˆ°ç›®æ ‡Servletï¼Œå¹¶å°†Httpè¯·æ±‚å°è£…æˆrequestå¯¹è±¡äº¤ç»™Servletå¤„ç†ï¼ˆå®¹å™¨ä¸­å¦‚æœæ²¡æœ‰ç›¸åº”çš„servletå°±ä¼šå…ˆåˆå§‹åŒ–â€“æ‡’åŠ è½½ï¼‰</li><li>servletå¤„ç†è¯·æ±‚æ˜¯è°ƒç”¨çš„serviceæ–¹æ³•ï¼Œåœ¨SSMä¸­æˆ‘ä»¬é€šå¸¸ä¼šåœ¨web.xmlä¸­é…ç½®springMVCçš„DispatcherServletç”¨æ¥å¤„ç†æ‰€æœ‰è¯·æ±‚(servletMappingä¸º*)ï¼Œè¿™ä¸ªservletæ ¹æ®è¯·æ±‚å¯¹è±¡ï¼Œå°†è¿™ä¸ªrequestå°è£…æˆSpringæ¡†æ¶ä¸­çš„requestå¯¹è±¡ï¼Œä»SpringMVCä¸­æ‰¾åˆ°å¯¹åº”Controllerå¤„ç†<ul><li>a. å½“åˆå§‹åŒ–è¿™ä¸ªservletä¼šè§¦å‘åˆå§‹åŒ–SpringMVCå®¹å™¨ï¼ŒSpringMVCå®¹å™¨ä¼šåˆå§‹åŒ–Springå®¹å™¨ï¼Œå¹¶å°†Springå®¹å™¨è®¾ç½®ä¸ºè‡ªå·±çš„çˆ¶å®¹å™¨ï¼Œè¿™æ—¶å€™å°±æ˜¯ç†Ÿæ‚‰çš„Springå®¹å™¨çš„åŠ è½½</li><li>b. è¿™é‡ŒSpringMVCå®¹å™¨é‡Œç®¡ç†çš„æ—¶ControllerBeanï¼ŒSpringå®¹å™¨ä¸­ç®¡ç†ç«¯çš„æ˜¯ServiceBeanå’ŒDAOBeanè¿™äº›ï¼Œï¼ˆè¿™äº›beanæ˜¯åˆ›å»ºé¡ºåºæˆ‘è¿˜æ²¡ç ”ç©¶ï¼ŒæŒ–å‘â†’_â†’ï¼‰ç”±äºæ˜¯çˆ¶å­å…³ç³»SpringMVCå¯ä»¥è®¿é—®Springå®¹å™¨ä¸­çš„beanï¼Œåè¿‡æ¥å°±ä¸å¯ä»¥</li></ul></li><li>è¿™æ­¥å°±æ˜¯ç†Ÿæ‚‰çš„Controllerå±‚è°ƒç”¨Springå®¹å™¨ä¸­çš„Serviceé€»è¾‘ï¼Œåœ¨è°ƒç”¨DAOå±‚é€»è¾‘æŒä¹…åŒ–ï¼Œå°†ç»“æœresponseè¿”å›ç»™SpringMVC</li><li>SpringMVCå°†responseå¯¹è±¡è½¬ä¸ºservletè§„èŒƒé‡Œçš„responseå¯¹è±¡è¿”å›ç»™servlet</li><li>Servletå°†responseè½¬åŒ–ä¸ºHttpçš„å“åº”äº¤ç»™Webå®¹å™¨Tomcatï¼Œæœ€ç»ˆç”±Tomcatè¿”å›ç»™æµè§ˆå™¨</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¬åˆ°Servletæˆ‘æ—¢ç†Ÿæ‚‰åˆé™Œç”Ÿï¼Œæˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦è¿˜æ˜¯åœ¨2013å¹´ï¼Œå½“æ—¶å¯¹äºè¯¾ç¨‹è®¾è®¡æ°´å¹³çš„æˆ‘æ¥è¯´ä»…ä»…æœ‰ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼Œåæ¥æ¥è§¦äº†sshä¹‹åå¥½åƒå·²ç»ç–è¿œäº†servletï¼Œæˆ‘åªåœ¨å†™ä¸šåŠ¡é€»è¾‘ä¸€ç›´åˆ°ç°åœ¨ï¼Œæˆ‘å¯¹äºservletçš„å°è±¡è¿˜åœç•™åœ¨å£°æ˜ï¼Œåœ¨web.xmlä¸­é…ç½®ï¼Œå†™mappingè¿™äº›
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>éœ‡æƒŠ!ç³»ç»Ÿå´©äº†ç«Ÿç„¶å› ä¸ºè¿™ä¸ª</title>
    <link href="http://yoursite.com/2020/05/28/%E9%9C%87%E6%83%8A!%E7%B3%BB%E7%BB%9F%E5%B4%A9%E4%BA%86%E7%AB%9F%E7%84%B6%E5%9B%A0%E4%B8%BA%E8%BF%99%E4%B8%AA/"/>
    <id>http://yoursite.com/2020/05/28/éœ‡æƒŠ!ç³»ç»Ÿå´©äº†ç«Ÿç„¶å› ä¸ºè¿™ä¸ª/</id>
    <published>2020-05-28T09:16:07.000Z</published>
    <updated>2021-07-13T12:27:08.596Z</updated>
    
    <content type="html"><![CDATA[<p>èœé¸Ÿé‡åˆ°çº¿ä¸Šé—®é¢˜ï¼Œä»ç¬¬ä¸€æ¬¡å‘ç°é—®é¢˜åˆ°é—®é¢˜è§£å†³ç”¨æ—¶2ä¸ªæœˆï¼Œä¹Ÿç®—æ˜¯ä¸ªè®°å½•å§ï¼Œå“ˆå“ˆï¼Œæœ¬æ–‡è®°å½•ä¸‹æˆ‘è§£å†³é—®é¢˜çš„å¿ƒè·¯å†ç¨‹ï¼Œä¹Ÿä¸æ˜¯ä»€ä¹ˆé«˜çº§çš„é—®é¢˜ï¼Œå¤§ç¥è¯·ç»•è·¯</p><h3 id="ç¬¬ä¸€æ¬¡é—®é¢˜"><a href="#ç¬¬ä¸€æ¬¡é—®é¢˜" class="headerlink" title="ç¬¬ä¸€æ¬¡é—®é¢˜"></a>ç¬¬ä¸€æ¬¡é—®é¢˜</h3><h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>4æœˆ27æ—¥10:40-11:40ä¸€ä¸ªå°¾æ•°164çš„å®¹å™¨CPUçªç„¶é£™å‡ç–¯ç‹‚æ”¶åˆ°æŠ¥è­¦çš„é‚®ä»¶å’Œæ¶ˆæ¯</p><h4 id="åº”å¯¹æªæ–½"><a href="#åº”å¯¹æªæ–½" class="headerlink" title="åº”å¯¹æªæ–½"></a>åº”å¯¹æªæ–½</h4><ul><li>æŸ¥çœ‹åå°æ—¥å¿—æœ‰ä¸€ä¸ªurlåœ¨åˆ·å±ï¼Œæ¡ä»¶åå°„çš„æ‰¾åˆ°è¿™ä¸ªåˆ·å±çš„äººç»™ä»–é™æµï¼ˆå› ä¸ºä¹‹å‰æœ‰è¿‡ç±»ä¼¼çš„æƒ…å†µï¼Œç”¨æˆ·é€šè¿‡ç¨‹åºå‘é€urlè¯·æ±‚æ¥è·å–æ•°æ®ï¼Œ30ç§’ä¹‹å†…ç²¾å‡†é™æµï¼Œæˆ‘ä¹Ÿæ˜¯è€æ‰‹äº†ï¼‰</li><li>ç»§ç»­è§‚å¯Ÿç›‘æ§ï¼Œè°ƒç”¨é‡ä¸‹æ¥äº†ï¼ŒCPUè¿Ÿè¿Ÿä¸é™ï¼Œæ²¡æœ‰åŠæ³•é‡å¯äº†å®¹å™¨</li></ul><p><img src="/images/dumpé—®é¢˜1.png" alt="upload successful"></p><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><ul><li>CPUä¸é™ä¸€å®šæ˜¯è¿˜åœ¨åšè®¡ç®—å·¥ä½œ</li><li>æ’æŸ¥è¢«åˆ·çš„urlï¼Œæ˜¯ä¸€ä¸ªç›‘æ§æŠ¥è¡¨çš„urlï¼ˆç”±äºç³»ç»Ÿåªæä¾›æœ€å¤§1å°æ—¶çš„æ•°æ®ï¼Œä¸´è¿‘618å¾ˆå¤šç”¨æˆ·éœ€è¦å‡ å¤©ç”šè‡³å‡ å‘¨çš„æ•°æ®åšåˆ†æï¼Œä¸å¾—å·²é€šè¿‡ç¨‹åºæ¥è·‘å‡ºè‡ªå·±æ‰€éœ€çš„æ•°æ®ï¼‰</li><li>ä»£ç èµ°æŸ¥ï¼Œæ˜¯é€šè¿‡è°ƒç”¨esçš„æœåŠ¡ï¼Œè·å–æ•°æ®ï¼Œå†å°è£…æˆå‰ç«¯éœ€è¦çš„æ•°æ®è¿”å›ï¼Œé€»è¾‘ä¸Šæ˜¯æ²¡é—®é¢˜çš„<ul><li>è·å–æ•°æ®ï¼šæŸ¥çš„æ˜¯eså“åº”å¾ˆå¿«ï¼Œ2sä¹‹å†…å°±æœ‰æ•°æ®</li><li>å‰ç«¯é¡µé¢ä¸€å…±3ä¸ªå›¾ï¼Œä¸è®ºæŸ¥è¯¢å¤šå°‘æ—¶é—´é—´éš”çš„æ•°æ®éƒ½åªæœ‰90ä¸ªç‚¹ï¼Œ3ä¸ªå›¾å…±270ä¸ªç‚¹ï¼Œä¹Ÿå°±æ˜¯åå°å°è£…270ä¸ªå¯¹è±¡</li></ul></li><li>æ•´ä¸ªè¿‡ç¨‹ä¹Ÿå°±å°è£…å¯¹è±¡æ˜¯è®¡ç®—çš„è¿‡ç¨‹éœ€è¦CPUï¼Œéš¾ä¸æˆè¿™ä¸ªäººç”¨å¤šä¸ªçº¿ç¨‹æ¥è·‘è¿™ä¸ªurlï¼Œè¿™ä¹Ÿå¤ªå˜æ€äº†å§</li><li>éªŒè¯ï¼š7ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡å¾ªç¯è®¿é—®500æ¬¡ï¼ŒæŸ¥çœ‹ç›‘æ§CPUè¿˜ä¸åˆ°5%ï¼Œå¹³å¸¸2%å·¦å³</li></ul><h4 id="å¤„ç†"><a href="#å¤„ç†" class="headerlink" title="å¤„ç†"></a>å¤„ç†</h4><ul><li>å¯ä»¥æ’é™¤æ˜¯è·å–ç›‘æ§æ•°æ®è¿™ä¸ªURLçš„é—®é¢˜ï¼Œå½“å¤©å›çœ‹æ—¥å¿—æ²¡æœ‰å‘ç°å…¶ä»–å¼‚å¸¸ï¼Œé—®äº†å‰è¾ˆä¹‹å‰ä¹Ÿæ²¡å‡ºç°è¿‡ç±»ä¼¼é—®é¢˜ï¼Œè€Œä¸”æ‰‹ä¸Šè¿˜æœ‰éœ€æ±‚å°±å…ˆæç½®äº†ï¼›è¿‡äº†ä¸€å‘¨å†æ’æŸ¥çš„æ—¶å€™å‘ç°æ‰¾ä¸åˆ°å†å²æ—¥å¿—äº†ï¼Œå› ä¸ºåˆšåˆšè¿ç§»äº†ç¯å¢ƒå†å²æ—¥å¿—æ²¡æœ‰æ‰“å¼€ï¼Œæ­»æ— å¯¹è¯äº†ã€‚ã€‚ã€‚</li><li>ä¹Ÿç®—æ’æŸ¥äº†ä¸€ä¸ªç³»ç»Ÿçš„é£é™©ç‚¹å§ï¼Œæœ€ç»ˆï¼Œå¼€å¯ç³»ç»Ÿçš„å†å²æ—¥å¿—ï¼Œé‡æ–°é…ç½®æŠ¥è­¦çš„é˜ˆå€¼ï¼Œç­‰ä¸‹æ¬¡å†å‡ºé—®é¢˜æ—¶æ‘˜é™¤è´Ÿè½½å‡è¡¡ï¼Œä¿ç•™ç°åœºå†åšæ’æŸ¥</li></ul><h3 id="ç¬¬äºŒæ¬¡å‡ºç°é—®é¢˜"><a href="#ç¬¬äºŒæ¬¡å‡ºç°é—®é¢˜" class="headerlink" title="ç¬¬äºŒæ¬¡å‡ºç°é—®é¢˜"></a>ç¬¬äºŒæ¬¡å‡ºç°é—®é¢˜</h3><h4 id="èƒŒæ™¯-1"><a href="#èƒŒæ™¯-1" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>5æœˆ26æ—¥19:15å‰åï¼ŒåŒæ ·è¿˜æ˜¯æ”¶åˆ°å°¾æ•°164çš„å®¹å™¨CPUé£™å‡çš„å‘Šè­¦é‚®ä»¶ï¼Œæœ¬ä»¥ä¸ºä¸Šæ¬¡çš„é—®é¢˜æ˜¯ä¸ªçµå¼‚äº‹ä»¶ï¼Œæ²¡æƒ³åˆ°åˆå‡ºç°äº†ï¼Œæœ‰äº†ä¸Šæ¬¡çš„ç»éªŒï¼Œè¿™æ¬¡å°±å¾ˆä»å®¹ï¼Œå°†è´Ÿè½½å‡è¡¡æ‘˜é™¤å®‰å¿ƒæ’æŸ¥é—®é¢˜ï¼Œå¯æ˜¯ä¸€ä¼šåˆæ”¶åˆ°äº†åŒæœºæˆ¿å°¾æ•°æ˜¯182çš„å®¹å™¨çš„æŠ¥è­¦é‚®ä»¶ï¼Œç¾¤é‡Œçš„ç”¨æˆ·ä¹Ÿå¼€å§‹åé¦ˆç³»ç»Ÿæ— æ³•è®¿é—®äº†ï¼Œæˆ‘æ„£ä½äº†ï¼Œè„‘å­é‡Œéƒ½æ˜¯åœ¨æƒ³æœ€è¿‘æœ‰åšä»€ä¹ˆä¸Šçº¿å—ï¼Œæ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼›åœ¨æˆ‘å‘æ„£çš„æ—¶å€™ï¼Œå‰è¾ˆå·²ç»å¼€å§‹æ‰©å®¹ï¼Œç´§æ€¥æ‰©å®¹äº†4ä¸ªå®¹å™¨è¿™æ‰ç¨³ä½å±€åŠ¿ï¼Œè¿™æˆ‘æ‰å›è¿‡ç¥æ¥ï¼Œæˆ‘è¿˜æ˜¯å¹´è½»ğŸ˜‚</p><p><img src="/images/dumpé—®é¢˜2.png" alt="upload successful"></p><h4 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><ul><li>ç»è¿‡ä¸Šé¢çš„å¤„ç†ï¼Œä¸‹é¢å°±å¼€å§‹åˆ†æé—®é¢˜äº†ï¼Œé¦–å…ˆè¿˜æ˜¯çœ‹æ—¥å¿—æ²¡æœ‰å‘ç°å¼‚å¸¸ï¼Œäºæ˜¯å’Œè¿ç»´åŒå­¦è¦äº†dumpæ–‡ä»¶ï¼Œè¿ç»´åŒå­¦è¯´dumpä¸ç”¨çœ‹äº†ï¼Œå®¹å™¨çš„jvmå†…å­˜åªæœ‰1Gï¼Ÿï¼Ÿï¼Ÿæƒ³åˆ°å½“æ—¶è¿ç§»ç³»ç»Ÿæ—¶æ²¡æ”¹é…ç½®ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤çš„é…ç½®ï¼Œä¿®æ”¹äº†å†…å­˜é…ç½®åè§£å†³é—®é¢˜ï¼Œå®Œäº‹å„¿ï¼é‚£æˆ‘å†™è¿™ç¯‡æ–‡ç« ä¹Ÿå¤ªæ°´äº†å§ï¼Œå“ˆå“ˆ</li><li>æˆ‘è¦äº†dumpæ–‡ä»¶ï¼Œè¿˜æ˜¯è¦çœ‹ä¸€ä¸‹é—®é¢˜çš„ï¼Œè€Œä¸”æ¯æ¬¡éƒ½æ˜¯å°¾æ•°164çš„å®¹å™¨å‡ºé”™ï¼Œå¤ªè¯¡å¼‚äº†</li><li>ä½¿ç”¨JProFileråˆ†ædumpï¼Œå¯ä»¥çœ‹åˆ°ç™¾ä¸‡æ•°é‡çº§çš„å¼•ç”¨4ç±»ï¼Œç»“åˆæœ€å¤§çš„å¯¹è±¡æ¥çœ‹ï¼Œæ˜¯ä¸€ä¸ªè¶…å¤§çš„listï¼Œå ç”¨äº†80%çš„å†…å­˜</li></ul><p><img src="/images/dumpé—®é¢˜3.png" alt="upload successful"><br><img src="/images/dumpé—®é¢˜4.png" alt="upload successful"></p><ul><li>ä»£ç èµ°æŸ¥ï¼Œlistä¸­çš„å¯¹è±¡æ˜¯äº‹ä»¶çš„å¯¹è±¡ï¼Œç”¨æ¥åŒæ­¥æ•°æ®ç”¨ï¼Œç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå†ç»“åˆæ—¥å¿—æ¥çœ‹ï¼Œé©¬ä¸Šå®šä½åˆ°äº†ä¸€ä¸ªç”¨æˆ·å†æ“ä½œå®ä¾‹çš„ä¸Šçº¿ï¼ˆæ›´æ”¹å®ä¾‹ä¸­æ‰€æœ‰æ¥å£çš„çŠ¶æ€ï¼Œäº§ç”Ÿçš„äº‹ä»¶æ˜¯ä¸ºäº†åŒæ­¥æ•°æ®ï¼‰ï¼Œå¹¶äº§ç”Ÿäº†300w+çš„äº‹ä»¶ï¼Œç³»ç»Ÿå°è£…äº‹ä»¶åç»ˆäºæŠŠå†…å­˜æ’‘çˆ†ï¼Œè¿›è¡ŒFullGCï¼ŒStop The Word</li><li>æŸ¥çœ‹æ—¥å¿—å’Œç”¨æˆ·æ“ä½œçš„è®°å½•ï¼Œæˆ‘å¯»æ€å¯¹ä¸€ä¸ªå®ä¾‹æ“ä½œæ€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šäº‹ä»¶ï¼Œä¸ä¼šæ˜¯æœ‰æ­»å¾ªç¯äº†å§ï¼›å…ˆæ’æŸ¥äº†ä¸æ˜¯å¤šçº¿ç¨‹çš„é—®é¢˜</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for (Server server : servers) &#123;</span><br><span class="line">    // å¤–å±‚å¾ªç¯ç”Ÿäº§äº‹ä»¶</span><br><span class="line">    eventList.add(buildEvent(server));</span><br><span class="line">    for (IfaceAlias ifaceAlias : ifaceAliasList) &#123;// å†…å±‚å¾ªç¯ä¸å¤–å±‚å¾ªç¯çš„æ•°æ®ä¸€æ ·</span><br><span class="line">        if (condition) &#123;</span><br><span class="line">            eventList.add(buildEvent(ifaceAlias));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// ä¼ªä»£ç ï¼Œåªæ˜¯ä¸ºäº†å±•ç¤ºä»£ç ç»“æ„</span><br></pre></td></tr></table></figure><ul><li>ä¸Šçº¿çš„é€»è¾‘æ˜¯è¿™æ ·<ul><li>a.æ•°æ®åº“ä¸­ä¿®æ”¹å®ä¾‹çš„çŠ¶æ€ï¼ˆä¸¤ä¸ªsqlç”¨æ—¶3så†…ï¼‰</li><li>b.å°è£…è¦æ“ä½œçš„äº‹ä»¶</li><li>c.å‘é€äº‹ä»¶ ï¼ˆè°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œè¿œç¨‹æœåŠ¡æ²¡æœ‰æ¥å—åˆ°äº‹ä»¶çš„æ—¥å¿—ï¼Œå®šä½åœ¨bä¸­å‡ºç°é—®é¢˜ï¼‰</li></ul></li><li>æ­¥éª¤bä¸­ï¼ŒåµŒå¥—äº†ä¸¤å±‚å¾ªç¯æ¥ç”Ÿäº§äº‹ä»¶ï¼Œé€»è¾‘å¦‚ä¸‹ï¼ˆä»¥å‰ä»£ç çš„é€»è¾‘ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåšå°±ä¸çŸ¥é“äº†ï¼Œå‰è¾ˆçš„ä¸œè¥¿å…ˆä¸åŠ¨ï¼‰ï¼Œæˆ‘æŸ¥äº†çº¿ä¸Šçš„æ•°æ®ï¼Œè¿™ä¸ªå®ä¾‹ä¸­æœ‰282ä¸ªæ¥å£ï¼Œä¸¤å±‚å¾ªç¯ä¹Ÿå°±8wä¸åˆ°çš„äº‹ä»¶å•Š<ul><li>éªŒè¯ï¼šå°†çº¿ä¸Šæ•°æ®æ‹·è´ä¸‹æ¥ï¼Œæœ¬åœ°æµ‹è¯•ï¼Œäº§ç”Ÿ6000+çš„äº‹ä»¶ä¹Ÿä¸åˆ°8wå•Šï¼Ÿdebugåæ‰çŸ¥é“ï¼Œä¸¤å±‚åµŒå¥—å¾ªç¯ç¬¦åˆæ¡ä»¶çš„åªæœ‰77ä¸ªï¼ˆä¸šåŠ¡é—®é¢˜ä¸éœ€è¦å…³å¿ƒï¼‰ï¼Œ77*77+å¤–å±‚å¾ªç¯ç”Ÿäº§çš„äº‹ä»¶åˆšå¥½6000+æ•°é‡çº§ï¼Œè¿™å’Œçº¿ä¸Šçš„ç™¾ä¸‡æ•°é‡çº§å·®å¥½å¤šå“¦ï¼Œè¿™å¤šå‡ºæ¥çš„æ˜¯ä»å“ªæ¥çš„å‘¢</li><li>æƒ³äº†ä¸¤å¤©æ²¡æœ‰ç»“æœï¼Œå¿ä¸ä½äº†ï¼Œæˆ‘æ‰¾åˆ°ç”¨æˆ·çš„è”ç³»æ–¹å¼ç›´æ¥é—®ï¼ŒåŸæ¥æ“ä½œäº†20å¤šä¸ªå®ä¾‹ï¼Œå‘ç°ç”¨æˆ·æ“ä½œçš„æ—¥å¿—è¶…é•¿äº†ï¼Œåé¢çš„å†…å®¹æˆªæ–­äº†ï¼Œè®©æˆ‘ä»¥ä¸ºå°±æ“ä½œäº†ä¸€ä¸ªå®ä¾‹</li><li>éªŒè¯ï¼šæŒ‰ç…§25ä¸ªå®ä¾‹æ¥ç®—ï¼Œæ¯ä¸ªå®ä¾‹ä¸¤å±‚å¾ªç¯éœ€è¦é‡æ–°è®¡ç®—å¤–å±‚å¾ªç¯xå†…å­˜å¾ªç¯ï¼ˆ25x77ï¼‰xï¼ˆ25x77ï¼‰ç»“æœè¯å®300w+çš„æ•°é‡çº§ï¼Œç ´æ¡ˆ</li></ul></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸»è¦é—®é¢˜è¿˜æ˜¯è¿ç§»ç³»ç»Ÿä¹‹åjvmè®¾ç½®çš„å†…å­˜æœ‰é—®é¢˜ï¼Œè¿å¸¦æ‰¾å‡ºå…¶ä»–bugï¼ˆä»¥å¤–æ”¶è·ï¼‰</p><ol><li>å°è£…äº‹ä»¶ä»£ç æœ‰é—®é¢˜ï¼Œä¸¤å±‚åµŒå¥—å¾ªç¯äº§ç”Ÿå¾ˆå¤šé‡å¤äº‹ä»¶ï¼ˆä¸æ˜¯è¯´ä¹‹å‰å†™ä»£ç çš„äººå¤ªæ°´ï¼Œè€Œæ˜¯ä¸šåŠ¡å¤æ‚ï¼Œåˆšå¥½ç”¨æˆ·çš„æ•°æ®ç»“æ„ç‰¹æ®Šå¯¼è‡´äº§ç”Ÿå¤§é‡é‡å¤äº‹ä»¶ï¼‰</li><li>ç”¨æˆ·æ“ä½œçš„æ—¥å¿—è®°å½•ä¸å®Œæ•´ï¼Œè¯¯å¯¼äº†æ’æŸ¥é”™è¯¯çš„æ–¹å‘ï¼Œè¿™æ˜¯ä¸ªé£é™©</li><li>jvmå†…å­˜è®¾ç½®çš„æœ‰é—®é¢˜ï¼Œå³ä½¿ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ä¸ä¿®æ”¹ï¼Œæºç 8gå†…å­˜éƒ½ç”¨ä¸Šçš„è¯è¿è¡Œ5å¹´çš„è¯ä¹Ÿä¸ä¼šå‡ºé—®é¢˜</li><li>ç›´æ¥æŸ¥çœ‹jvmçš„é…ç½®æˆ–è€…æ‰¾ç”¨æˆ·äº†è§£æƒ…å†µå°±ä¸ä¼šèµ°è¿™ä¹ˆå¤šå¼¯è·¯ï¼Œè¿™æ¡é‡Œå°±æ˜¯ç»éªŒäº†ï¼Œæœ¬æ–‡çš„ç²¾åéƒ½åœ¨è¿™ä¸€å¥äº†</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;èœé¸Ÿé‡åˆ°çº¿ä¸Šé—®é¢˜ï¼Œä»ç¬¬ä¸€æ¬¡å‘ç°é—®é¢˜åˆ°é—®é¢˜è§£å†³ç”¨æ—¶2ä¸ªæœˆï¼Œä¹Ÿç®—æ˜¯ä¸ªè®°å½•å§ï¼Œå“ˆå“ˆï¼Œæœ¬æ–‡è®°å½•ä¸‹æˆ‘è§£å†³é—®é¢˜çš„å¿ƒè·¯å†ç¨‹ï¼Œä¹Ÿä¸æ˜¯ä»€ä¹ˆé«˜çº§çš„é—®é¢˜ï¼Œå¤§ç¥è¯·ç»•è·¯&lt;/p&gt;
&lt;h3 id=&quot;ç¬¬ä¸€æ¬¡é—®é¢˜&quot;&gt;&lt;a href=&quot;#ç¬¬ä¸€æ¬¡é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬ä¸€æ¬¡
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>AQSåˆ†æ</title>
    <link href="http://yoursite.com/2020/05/20/AQS%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/20/AQSåˆ†æ/</id>
    <published>2020-05-20T09:16:07.000Z</published>
    <updated>2021-07-13T12:27:08.581Z</updated>
    
    <content type="html"><![CDATA[<h3 id="AQS-AbstraceQueuedSynchronizer"><a href="#AQS-AbstraceQueuedSynchronizer" class="headerlink" title="AQS AbstraceQueuedSynchronizer"></a>AQS AbstraceQueuedSynchronizer</h3><ul><li>ç»´æŠ¤äº†ä¸€ä¸ªå…±äº«å˜é‡stateï¼ˆintç±»å‹è¢«volatileä¿®é¥°ä¿è¯çº¿ç¨‹çš„å¯è§æ€§ï¼‰</li><li>é€šè¿‡ä¸åŒçº¿ç¨‹ä¿®æ”¹stateçš„çŠ¶æ€æ¥å†³å®šçº¿ç¨‹è·å–é”çš„çŠ¶æ€ï¼Œå¹¶å°†è¿™äº›çº¿ç¨‹ç»´æŠ¤åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å°è£…æˆä¸€ä¸ªNodeå¯¹è±¡</li><li>Nodeä¸­å®šä¹‰äº†çº¿ç¨‹çš„çŠ¶æ€ å¤åˆ¶è¡¨ç¤ºNodeå¤„äºæœ‰æ•ˆçš„ç­‰å¾…çŠ¶æ€ï¼Œæ­£å€¼è¡¨ç¤ºNodeè¢«å–æ¶ˆ<ul><li>CANCELLEDï¼ˆ1ï¼‰ å½“å‰Nodeå·²ç»å–æ¶ˆè°ƒåº¦ï¼Œè¶…æ—¶æˆ–ä¸­æ–­ä¼šå˜æ›´ä¸ºæ¬¡çŠ¶æ€ï¼Œè¿›å…¥è¯¥çŠ¶æ€åçš„Nodeä¸å†å˜åŒ–</li><li>SIGNALï¼ˆ-1ï¼‰è¡¨ç¤ºåç»§Nodeç­‰å¾…å½“å‰Nodeå”¤é†’ï¼Œåç»§Nodeå…¥é˜Ÿï¼Œä¼šä¿®æ”¹å‰é©±NodeçŠ¶æ€ä¸ºSIGNAL</li><li>CONDITIONï¼ˆ-2ï¼‰è¡¨ç¤ºNodeç­‰å¾…åœ¨Conditionä¸Šï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨signal()æ–¹æ³•åï¼ŒCONDITIONçš„Nodeä¼šä»ç­‰å¾…é˜Ÿåˆ—ä¸­è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œç­‰å¾…è·å–åŒæ­¥é”</li><li>PROPAGATEï¼ˆ-3ï¼‰å…±äº«æ¨¡å¼ä¸‹ï¼Œå‰é©±èŠ‚ç‚¹ä¸ä»…ä¼šå”¤é†’åç»§Nodeï¼Œè¿˜å¯èƒ½å”¤é†’åç»§çš„åç»§Node</li><li>0 æ–°èŠ‚ç‚¹å…¥é˜Ÿæ—¶çš„é»˜è®¤çŠ¶æ€</li></ul></li><li>å®šä¹‰äº†ç‹¬å ï¼ˆExclusiveï¼‰å’Œå…±äº«ï¼ˆshareï¼‰ä¸¤ç§å¯¹stateçš„ä½¿ç”¨æ–¹å¼</li></ul><ol><li>ç‹¬å  exclusive åªèƒ½ä¸€ä¸ªçº¿ç¨‹æ“ä½œstateï¼›ä½¿ç”¨ acquire-relase æ–¹æ³•è·å–å’Œé‡Šæ”¾èµ„æº<ul><li>acquire<ul><li>tryAcquire æ ¹æ®éœ€è¦å…·ä½“å®ç° å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</li><li>è·å–èµ„æºå¤±è´¥ï¼Œå°†å½“å‰çº¿ç¨‹å…¥é˜Ÿï¼Œæ‰¾åˆ°å®‰å…¨ç‚¹è¿›å…¥ç­‰å¾…çŠ¶æ€</li><li>å½“è¢«å”¤é†’ååˆ¤æ–­è‡ªå·±æ˜¯å¦æ˜¯é˜Ÿåˆ—ä¸­çš„è€äºŒï¼Œä¸æ˜¯è€äºŒæ‰¾åˆ°å®‰å…¨ç‚¹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›æ˜¯è€äºŒå°è¯•è·å–èµ„æºï¼Œè·å–å¤±è´¥ç»§ç»­è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…åˆ«å”¤é†’</li></ul></li><li>relase<ul><li>tryRelase æ ¹æ®éœ€è¦å…·ä½“å®ç° å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</li><li>å½“èµ„æºå…¨éƒ¨è¢«é‡Šæ”¾åï¼ˆstate=0ï¼Œå¯èƒ½è¢«é‡å…¥stateçš„å€¼å¤§äº0ï¼‰ä¼šå”¤é†’é˜Ÿåˆ—ä¸­çš„è€äºŒæ¥è·å–èµ„æº</li></ul></li></ul></li></ol><p><img src="/images/acquire-relase.png" alt="upload successful"></p><ol start="2"><li>å…±äº« share å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ“ä½œstateï¼›ä½¿ç”¨ acquireShared-relaseShared æ–¹æ³•è·å–å’Œé‡Šæ”¾èµ„æº<ul><li>acquireShared<ul><li>tryAcquireShared æ ¹æ®éœ€è¦å…·ä½“å®ç° å°è¯•è·å–èµ„æºï¼Œè´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œæ•°å€¼è¡¨ç¤ºå‰©ä½™çš„èµ„æºæ•°é‡</li><li>è·å–èµ„æºå¤±è´¥ï¼Œå°†å½“å‰çº¿ç¨‹å…¥é˜Ÿï¼Œå…¥é˜Ÿåå¦‚æœæ˜¯è€äºŒèŠ‚ç‚¹å°è¯•è·å–èµ„æºï¼Œè€äºŒèŠ‚ç‚¹è·å–èµ„æºæˆåŠŸï¼Œæ ¹æ®å‰©ä½™èµ„æºé‡å”¤é†’åé¢çš„çº¿ç¨‹</li><li>ä¸æ˜¯è€äºŒèŠ‚ç‚¹æˆ–è€…è€äºŒèŠ‚ç‚¹è·å–èµ„æºå¤±è´¥ï¼Œæ‰¾åˆ°å®‰å…¨ç‚¹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…è¢«å”¤é†’</li></ul></li><li>relaseShared<ul><li>tryRelaseShared æ ¹æ®éœ€è¦å…·ä½“å®ç° å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</li><li>é‡Šæ”¾èµ„æºæˆåŠŸå°±å»å”¤é†’é˜Ÿåˆ—ä¸­çš„è€äºŒï¼Œè€äºŒè¢«å”¤é†’å°è¯•è·å–èµ„æºè¿›å…¥åˆ°acquireSharedä¸­çš„ç¬¬äºŒæ­¥</li></ul></li></ul></li></ol><p><img src="/images/acquireShared-relaseShared.png" alt="upload successful"></p><p><strong>æ€»ç»“</strong></p><p>AQSå…¶å®æ˜¯ä¸€ä¸ªæŠ½è±¡çš„åŸºäºé˜Ÿåˆ—åŒæ­¥å™¨ï¼ˆæ­£å¦‚å…¶åç§°æ‰€ç¤ºï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä½¿ç”¨æŠ½è±¡æ–¹æ³•ï¼Œè€Œæ˜¯å°†å¯æ‰©å±•çš„æ–¹æ³•é»˜è®¤æŠ›å‡ºå¼‚å¸¸ï¼Œç•™ç»™å­ç±»å»é‡å†™è¦†ç›–ï¼Œå¯èƒ½æ˜¯è€ƒè™‘åˆ°å•ç‹¬æ‰©å±•å…±äº«æ¨¡å¼æˆ–è€…ç‹¬å æ¨¡å¼ï¼Œåªéœ€å®ç°ä¸¤ä¸ªæ–¹æ³•å³å¯ï¼Œä¸éœ€è¦å…¨éƒ½é‡å†™ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©é‡å†™ï¼Œè¿™æ ·æ›´çµæ´»ä¸€äº›ï¼‰ï¼Œå…¶ä¸­å°è£…äº†ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ä¸‹è·å–å’Œé‡Šæ”¾èµ„æºçš„æ–¹æ³•ï¼Œå…¶ä¸­æ²¡æœ‰ç»™å‡ºtryAcquire-tryRelaseå’ŒtryAcquireShared-tryRelaseSharedçš„å…·ä½“å®ç°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é‡å†™è¿™äº›æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦å»å…³å¿ƒé˜Ÿåˆ—ä¸­çº¿ç¨‹çš„çŠ¶æ€å˜åŒ–ï¼›æ¯”å¦‚ReentrantLockå°±æ˜¯é‡å†™äº†ç‹¬å æ¨¡å¼ä¸­çš„æ–¹æ³•å®ç°ï¼›CountDownLatchæ˜¯é‡å†™äº†å…±äº«æ¨¡å¼ä¸­çš„æ–¹æ³•å®ç°</p><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><p>ReentrantLockä¸­é‡å†™äº†tryAcquireå’ŒtryRelaseï¼Œæ‰€æœ‰æ˜¯ç‹¬å æ¨¡å¼ï¼Œæ‰€ä»¥ReentrantLockæ˜¯ç‹¬å é”å¹¶ä¸”æ˜¯å¯é‡å…¥çš„ï¼Œå…¶ä¸­åˆ†åˆ«æœ‰å…¬å¹³å’Œéå…¬å¹³ä¸¤ç§å®ç°ï¼Œé»˜è®¤æ˜¯éå…¬å¹³çš„</p><h4 id="å…¬å¹³"><a href="#å…¬å¹³" class="headerlink" title="å…¬å¹³"></a>å…¬å¹³</h4><ol><li>lock() -&gt; acquire(1) è·å–é”ï¼ˆä¿®æ”¹èµ„æºçš„çŠ¶æ€ä¸º1ï¼‰å…¶ä¸­ä½¿ç”¨çš„æ—¶AQSçš„å®ç°</li><li>é‡å†™äº†tryAcquireæ–¹æ³•ï¼Œ<em>å¦‚æœèµ„æºçŠ¶æ€æ˜¯ç©ºé—²ï¼ˆstate=0ï¼‰å¹¶ä¸”é˜Ÿåˆ—ä¸­æ²¡æœ‰ç­‰å¾…èµ„æºçš„çº¿ç¨‹ï¼Œæ‰ä¼šå»è·å–èµ„æº</em>ï¼›å¦‚æœæ˜¯å½“å‰çº¿ç¨‹è·å–èµ„æºï¼Œç›´æ¥ä¿®æ”¹çŠ¶æ€å¹¶è·å¾—é”æˆåŠŸï¼ˆstate += nï¼›å¯é‡å…¥ï¼›ï¼‰ï¼›å…¶ä»–æƒ…å†µè¿”å›falseè·å–èµ„æºå¤±è´¥</li><li>ä¹‹åå°±æ˜¯AQSä¸­çš„é€»è¾‘ å…¥é˜Ÿã€ç­‰å¾…è¢«å”¤é†’ balabalaâ€¦</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// å…¬å¹³é”çš„å®ç° Syncç»§æ‰¿äº†AQS</span><br><span class="line">static final class FairSync extends Sync &#123;</span><br><span class="line"></span><br><span class="line">    final void lock() &#123;</span><br><span class="line">        acquire(1);// è·å–èµ„æºï¼Œè°ƒç”¨AQSä¸­çš„ acquire(1) æ–¹æ³•</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // AQSä¸­çš„ acquire æ–¹æ³•è°ƒç”¨äº† tryAcquire æ–¹æ³•ï¼Œåœ¨è¿™é‡Œé‡å†™æ‰§è¡Œ</span><br><span class="line">    protected final boolean tryAcquire(int acquires) &#123;</span><br><span class="line">        final Thread current = Thread.currentThread();</span><br><span class="line">        int c = getState();</span><br><span class="line">        if (c == 0) &#123;</span><br><span class="line">            // å½“å‰èµ„æºç©ºé—²å¹¶ä¸”é˜Ÿåˆ—ä¸­æ²¡æœ‰ç­‰å¾…èµ„æºçš„çº¿ç¨‹æ‰ä¼šå»CASè·å–èµ„æº</span><br><span class="line">            if (!hasQueuedPredecessors() &amp;&amp;</span><br><span class="line">                compareAndSetState(0, acquires)) &#123;</span><br><span class="line">                setExclusiveOwnerThread(current);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;// å¦‚æœæ˜¯å½“å‰çº¿ç¨‹ç›´æ¥ä¿®æ”¹èµ„æºï¼Œè¿”å›æˆåŠŸï¼›å¯é‡å…¥</span><br><span class="line">        else if (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">            int nextc = c + acquires;</span><br><span class="line">            if (nextc &lt; 0)</span><br><span class="line">                throw new Error(&quot;Maximum lock count exceeded&quot;);</span><br><span class="line">            setState(nextc);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        eturn false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éå…¬å¹³"><a href="#éå…¬å¹³" class="headerlink" title="éå…¬å¹³"></a>éå…¬å¹³</h4><ol><li>lock -&gt; æŠ¢å é”ï¼ˆCASä¿®æ”¹èµ„æºçŠ¶æ€ï¼‰ -&gt; æŠ¢é”å¤±è´¥è°ƒç”¨acquire(1)è·å–é”ï¼ŒåŒæ ·é€‚ç”¨AQSçš„å®ç°</li><li>é‡å†™äº†tryAcquireæ–¹æ³•ï¼Œ<em>å¦‚æœèµ„æºçŠ¶æ€æ˜¯ç©ºé—²ï¼ˆstate=0ï¼‰å°±CASä¿®æ”¹çŠ¶æ€çš„å€¼è·å–èµ„æº</em>ï¼›å¦‚æœæ˜¯å½“å‰çº¿ç¨‹è·å–èµ„æºï¼Œä¿®æ”¹çŠ¶æ€è·å–èµ„æºæˆåŠŸï¼ˆä¸å…¬å¹³é”ç›¸åŒï¼ŒCASä¿®æ”¹stateï¼Œå¯é‡å…¥ï¼‰ï¼›å…¶ä»–æƒ…å†µè¿”å›falseè·å–èµ„æºå¤±è´¥</li><li>ï¼ˆç›¸åŒé€»è¾‘ï¼‰å…¥é˜Ÿã€ç­‰å¾…è¢«å”¤é†’ balabalaâ€¦</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// Syncç»§æ‰¿äº†AQS</span><br><span class="line">static final class NonfairSync extends Sync &#123;</span><br><span class="line">    </span><br><span class="line">    final void lock() &#123;</span><br><span class="line">        // lockçš„æ—¶å€™æŠ¢å ä¸€æ¬¡èµ„æº</span><br><span class="line">        if (compareAndSetState(0, 1))</span><br><span class="line">            setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">        else</span><br><span class="line">            acquire(1);// æ²¡æŠ¢å åˆ°è°ƒç”¨ acquire æ–¹æ³•ï¼ˆAQSä¸­ï¼‰</span><br><span class="line">    &#125;</span><br><span class="line">    // AQSä¸­çš„ acquire æ–¹æ³•è°ƒç”¨äº† tryAcquire æ–¹æ³•ï¼Œåœ¨è¿™é‡Œé‡å†™æ‰§è¡Œ</span><br><span class="line">    protected final boolean tryAcquire(int acquires) &#123;</span><br><span class="line">        return nonfairTryAcquire(acquires);// çˆ¶ç±»ä¸­å®ç°</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">final boolean nonfairTryAcquire(int acquires) &#123;</span><br><span class="line">    final Thread current = Thread.currentThread();</span><br><span class="line">    int c = getState();</span><br><span class="line">    if (c == 0) &#123;// ä¸å…¬å¹³é”çš„å®ç°ä¸åŒï¼Œè¿™èµ„æºç©ºé—²ä¼šå†æŠ¢å ä¸€æ¬¡èµ„æº</span><br><span class="line">        if (compareAndSetState(0, acquires)) &#123;</span><br><span class="line">            setExclusiveOwnerThread(current);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;// ä¸å…¬å¹³é”ä¸€æ · å¯é‡å…¥</span><br><span class="line">    else if (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">        int nextc = c + acquires;</span><br><span class="line">        if (nextc &lt; 0) // overflow</span><br><span class="line">            throw new Error(&quot;Maximum lock count exceeded&quot;);</span><br><span class="line">        setState(nextc);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ol><li>å…¬å¹³é”å’Œéå…¬å¹³é”é‡Šæ”¾èµ„æºéƒ½ä½¿ç”¨çš„çˆ¶ç±»ä¸­çš„ tryRelase æ–¹æ³•ï¼Œç®€å•çš„é€»è¾‘ï¼Œç¡®è®¤å½“å‰çº¿ç¨‹åœ¨å ç”¨èµ„æºåcasä¿®æ”¹èµ„æºçš„çŠ¶æ€ï¼Œè¿”å›èµ„æºæ˜¯å¦ç©ºé—²ï¼ˆstate==0?ï¼‰å…¶ä»–é€»è¾‘å’ŒAQSä¸­çš„ relase ç›¸åŒ</li><li>å¯ä»¥çœ‹åˆ°æ–œä½“çš„åœ°æ–¹å°±æ˜¯å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Œåœ¨èµ„æºçŠ¶æ€ç©ºé—²çš„æ—¶å€™ï¼Œéå…¬å¹³é”ä¼šå»æŠ¢å èµ„æºè€Œå…¬å¹³é”åˆ¤æ–­é˜Ÿåˆ—ä¸­æ²¡æœ‰ç­‰å¾…èµ„æºçš„çº¿ç¨‹æ‰ä¼šå»è·å–èµ„æºï¼›è¿˜æœ‰åœ¨Acquireä¹‹å‰éå…¬å¹³é”ä¼šå»æŠ¢å ä¸€æ¬¡èµ„æºï¼›éå…¬å¹³é”ä¼šåœ¨lockçš„æ—¶å€™æŠ¢å èµ„æºï¼Œæ²¡æœ‰æŠ¢åˆ°ä¼šæ‰§è¡ŒtryAcquireæ–¹æ³•ï¼Œå¦‚æœæ­¤æ—¶åˆšå¥½èµ„æºè¢«é‡Šæ”¾è¿˜ä¼šå»æŠ¢å ä¸€æ¬¡èµ„æºï¼Œéƒ½å¤±è´¥äº†å°±ä¼šå…¥é˜Ÿè¿›å…¥ç­‰å¾…çŠ¶æ€</li></ol><h3 id="å…±äº«æ¨¡å¼çš„å®ç°"><a href="#å…±äº«æ¨¡å¼çš„å®ç°" class="headerlink" title="å…±äº«æ¨¡å¼çš„å®ç°"></a>å…±äº«æ¨¡å¼çš„å®ç°</h3><p>æœ¬æ¥æƒ³æ‰¾ä¸€ä¸ªå…±äº«æ¨¡å¼çš„å®ç°æ¥åˆ†æä¸€ä¸‹ï¼Œåœ¨AQSä¸­æŸ¥åˆ°å®ç°æœ‰è¿™ä¹ˆå‡ ä¸ªï¼ŒSemaphoreã€CountDownLatchå’ŒReentrantReadWriteLockï¼Œå‰ä¸¤ä¸ªæ¯”è¾ƒç®€å•æ¥åˆ†æä¸€ä¸‹ï¼Œåä¸€ä¸ªæ¯”è¾ƒå¤æ‚æ®µæ—¶é—´è¿˜æä¸å®šï¼ˆæŸ¿å­è¦æŒ‘è½¯çš„ææ˜¯ä¸æ˜¯ï¼Ÿè¿™é‡Œå†æŒ–ä¸ªå‘å§ï¼‰</p><h4 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h4><p>Semaphoreç”¨æ¥æ§åˆ¶çº¿ç¨‹çš„å¹¶å‘é‡ï¼ŒæŒ‡å®šå¹¶å‘é‡å°±æ˜¯Semaphoreä¸­çš„è®¸å¯ï¼Œæ‹¿åˆ°è®¸å¯å¯ä»¥è¿è¡Œï¼Œæ²¡æœ‰æ‹¿åˆ°è®¸å¯è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæœ‰é‡Šæ”¾çš„è®¸å¯å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œä¿è¯çº¿ç¨‹è¿è¡Œçš„æ•°é‡ï¼Œç±»ä¼¼äºä»¤ç‰Œæ¡¶çš„äºšå­ï¼›å…¶ä¸­é‡å†™äº† tryAcquireShared å’Œ tryRelaseShared æ–¹æ³•ï¼Œæ‰€ä»¥Semaphoreæ˜¯å…±äº«æ¨¡å¼çš„å®ç°ï¼ŒåŒæ ·æœ‰å…¬å¹³å’Œéå…¬å¹³ä¸¤ç§æ–¹å¼ï¼Œé»˜è®¤éå…¬å¹³çš„ï¼›</p><ol><li>acquire è·å–è®¸å¯ -&gt; è°ƒç”¨ acquireSharedInterruptibly æ–¹æ³•ï¼Œä¸acquireSharedä¸åŒçš„æ˜¯å…ˆåˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå¦‚æœä¸­æ–­æŠ›å¼‚å¸¸ï¼Œ</li><li>è°ƒç”¨ tryAcquireShared æ–¹æ³•è·å–èµ„æºï¼ˆå…¬å¹³æ¨¡å¼ä¸‹çº¿åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç­‰å¾…èµ„æºçš„çº¿ç¨‹ï¼Œæœ‰åˆ™è¿”å›-1è¡¨ç¤ºå¤±è´¥ï¼›æ²¡æœ‰è¿”å›å‰©ä½™èµ„æºæ•°é‡ï¼Œè·å–èµ„æºæˆåŠŸï¼›éå…¬å¹³æ¨¡å¼ä¸‹ä¸ç”¨åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æœ‰çº¿ç¨‹ç›´æ¥å»è·å–èµ„æºï¼Œè¿”å›å‰©ä½™çš„èµ„æºï¼‰ï¼Œåé¢åŒAQSä¸­çš„é€»è¾‘ </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">// æ„é€ æ–¹æ³•åˆå§‹åŒ–AQSçš„stateä¸ºpermitçš„æ•°é‡</span><br><span class="line">public Semaphore(int permits) &#123;</span><br><span class="line">    sync = new NonfairSync(permits);</span><br><span class="line">&#125;</span><br><span class="line">// è½¬è°ƒAQSä¸­ acquireSharedInterruptibly æ–¹æ³•</span><br><span class="line">public void acquire() throws InterruptedException &#123;</span><br><span class="line">    sync.acquireSharedInterruptibly(1);// AQSä¸­çš„å®ç°</span><br><span class="line">&#125;</span><br><span class="line">public final void acquireSharedInterruptibly(int arg)</span><br><span class="line">        throws InterruptedException &#123;</span><br><span class="line">    if (Thread.interrupted())</span><br><span class="line">        throw new InterruptedException();</span><br><span class="line">    if (tryAcquireShared(arg) &lt; 0)// è¿™é‡Œè°ƒç”¨ tryAcquireShared æ–¹æ³•</span><br><span class="line">        doAcquireSharedInterruptibly(arg);</span><br><span class="line">&#125; </span><br><span class="line">// éå…¬å¹³æ¨¡å¼ä¸‹è½¬è°ƒ nonfairTryAcquireShared æ–¹æ³•</span><br><span class="line">protected int tryAcquireShared(int acquires) &#123;</span><br><span class="line">    return nonfairTryAcquireShared(acquires);</span><br><span class="line">&#125;</span><br><span class="line">final int nonfairTryAcquireShared(int acquires) &#123;</span><br><span class="line">    for (;;) &#123;</span><br><span class="line">        int available = getState();</span><br><span class="line">        int remaining = available - acquires;// è·å–èµ„æºåçš„ä½™é‡</span><br><span class="line">        if (remaining &lt; 0 ||</span><br><span class="line">            compareAndSetState(available, remaining))// ä½™é‡å¤§äº0 CASä¿®æ”¹çŠ¶æ€è·å–èµ„æºæˆåŠŸ å¦åˆ™æ‰§è¡ŒAQSä¸­å‰©ä¸‹çš„é€»è¾‘ å…¥é˜Ÿã€ç­‰å¾…...</span><br><span class="line">            return remaining;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// å…¬å¹³æ¨¡å¼ä¸‹ç›´æ¥é‡å†™ tryAcquireShared æ–¹æ³•</span><br><span class="line">protected int tryAcquireShared(int acquires) &#123;</span><br><span class="line">    for (;;) &#123;</span><br><span class="line">        if (hasQueuedPredecessors())// æ¯”éå…¬å¹³æ¨¡å¼å¤šäº†åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç­‰å¾…çš„çº¿ç¨‹</span><br><span class="line">            return -1;</span><br><span class="line">        int available = getState();</span><br><span class="line">        int remaining = available - acquires;</span><br><span class="line">        if (remaining &lt; 0 ||</span><br><span class="line">            compareAndSetState(available, remaining))</span><br><span class="line">            return remaining;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// relase æ–¹æ³•è½¬è°ƒAQSä¸­çš„ relaseShared æ–¹æ³•</span><br><span class="line">public void release(int permits) &#123;</span><br><span class="line">    if (permits &lt; 0) throw new IllegalArgumentException();</span><br><span class="line">    sync.releaseShared(permits);// å…¶ä¸­è°ƒç”¨ tryRelaseShared æ–¹æ³•</span><br><span class="line">&#125;</span><br><span class="line">// é‡å†™ tryRelaseShared æ–¹æ³•(å…¬å¹³éå…¬å¹³ç›¸åŒ) å¾ªç¯CASæ”¹å˜çŠ¶æ€ï¼Œåˆ¤æ–­è¾¹ç•ŒèŒƒå›´</span><br><span class="line">protected final boolean tryReleaseShared(int releases) &#123;</span><br><span class="line">    for (;;) &#123;</span><br><span class="line">        int current = getState();</span><br><span class="line">        int next = current + releases;</span><br><span class="line">        if (next &lt; current) // overflow</span><br><span class="line">            throw new Error(&quot;Maximum permit count exceeded&quot;);</span><br><span class="line">        if (compareAndSetState(current, next))</span><br><span class="line">            return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h4><p>CountDownLatché€šå¸¸ç”¨æ¥åˆ¤æ–­å¤šä¸ªçº¿ç¨‹æ˜¯å¦éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œåˆå§‹åŒ–çš„æ—¶å€™å°†AQSä¸­çš„stateè®¾ç½®ä¸ºç­‰å¾…çš„çº¿ç¨‹æ•°é‡ï¼ˆnï¼‰ï¼Œè¡¨ç¤ºèµ„æºè¢«nä¸ªçº¿ç¨‹è·å–ï¼›</p><ol><li>awaitæ–¹æ³•è½¬è°ƒacquireSharedInterruptiblyå…¶ä¸­åˆè½¬è°ƒ tryAcquireShared ï¼Œè¿”å›stateæ˜¯å¦ä¸º0ï¼Œå› ä¸ºåˆå§‹åŒ–ä¸ºnæ‰€ä»¥ä¸ä¸º0è¿”å›-1ï¼Œè¡¨ç¤ºè·å–èµ„æºå¤±è´¥å°†çº¿ç¨‹å…¥é˜Ÿç­‰å¾…</li><li>çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åè°ƒç”¨countDownæ–¹æ³•ï¼Œè½¬è°ƒrelaseSharedæ–¹æ³•å°†èµ„æºçš„æ•°é‡å‡ä¸€ï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½è°ƒç”¨äº†countDownæ­¤æ—¶èµ„æºè¢«å®Œå…¨é‡Šæ”¾ï¼ˆstate=0ï¼‰çº¿ç¨‹è¢«å”¤é†’ï¼Œå†æ¬¡ tryAcquireShared è·å–stateä¸º0è¿”å›0ï¼Œè¡¨ç¤ºè·å–èµ„æºæˆåŠŸï¼Œæ‰§è¡Œåé¢çš„é€»è¾‘</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// æ„é€ æ–¹æ³•åˆå§‹åŒ–AQSçš„stateä¸ºcountï¼›Syncç»§æ‰¿AQS</span><br><span class="line">public CountDownLatch(int count) &#123;</span><br><span class="line">    if (count &lt; 0) throw new IllegalArgumentException(&quot;count &lt; 0&quot;);</span><br><span class="line">    this.sync = new Sync(count);</span><br><span class="line">&#125;</span><br><span class="line">// è½¬è°ƒAQSä¸­ acquireSharedInterruptibly æ–¹æ³•</span><br><span class="line">public void await() throws InterruptedException &#123;</span><br><span class="line">    sync.acquireSharedInterruptibly(1);// AQSä¸­çš„å®ç°</span><br><span class="line">&#125;</span><br><span class="line">public final void acquireSharedInterruptibly(int arg)</span><br><span class="line">        throws InterruptedException &#123;</span><br><span class="line">    if (Thread.interrupted())</span><br><span class="line">        throw new InterruptedException();</span><br><span class="line">    if (tryAcquireShared(arg) &lt; 0)// è¿™é‡Œè°ƒç”¨ tryAcquireShared æ–¹æ³•</span><br><span class="line">        doAcquireSharedInterruptibly(arg);</span><br><span class="line">&#125;</span><br><span class="line">// é‡å†™äº† tryAcquireShared æ–¹æ³•</span><br><span class="line">protected int tryAcquireShared(int acquires) &#123;</span><br><span class="line">    // stateä¸º0è¿”å›1è¡¨ç¤ºè·å–èµ„æºæˆåŠŸï¼Œä¸ä¸º0è¿”å›-1è¡¨ç¤ºè·å–èµ„æºå¤±è´¥</span><br><span class="line">    // ç”±äºåˆšåˆšåˆå§‹åŒ–äº†state=countï¼Œå‡è®¾å½“å‰è¿˜æ²¡æœ‰é‡Šæ”¾èµ„æºï¼Œstateä¸ä¸º0è¿”å›-1è¡¨ç¤ºå¤±è´¥ï¼Œåé¢å°±æ˜¯AQSä¸­çš„é€»è¾‘ï¼Œå…¥é˜Ÿã€ç­‰å¾…...</span><br><span class="line">    return (getState() == 0) ? 1 : -1;</span><br><span class="line">&#125;</span><br><span class="line">// countDown æ–¹æ³•è½¬è°ƒ relaseShared æ–¹æ³•</span><br><span class="line">public void countDown() &#123;</span><br><span class="line">    sync.releaseShared(1);// AQSä¸­çš„å®ç° å…¶ä¸­è°ƒç”¨äº† tryRelaseShared æ–¹æ³•</span><br><span class="line">&#125;</span><br><span class="line">// é‡å†™äº† tryRelaseShared æ–¹æ³•ï¼Œå¦‚æœstate-1ä¹‹åè¿˜ä¸ä¸º0è¿”å›falseè¡¨ç¤ºé‡Šæ”¾å¤±è´¥ï¼Œå…¶å®æ˜¯æˆåŠŸçš„ï¼Œè¿”å›å¤±è´¥æ˜¯å› ä¸ºè¿˜è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹</span><br><span class="line">// å…ˆä¸å»å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œå½“é‡Šæ”¾èµ„æºåstateä¸º0è¿”å›æˆåŠŸï¼Œè¿™æ—¶å€™å†å»å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span><br><span class="line">protected boolean tryReleaseShared(int releases) &#123;</span><br><span class="line">    // å¾ªç¯CASæ“ä½œå°†state-1</span><br><span class="line">    for (;;) &#123;</span><br><span class="line">        int c = getState();</span><br><span class="line">        if (c == 0)</span><br><span class="line">            return false;</span><br><span class="line">        int nextc = c-1;</span><br><span class="line">        if (compareAndSetState(c, nextc))</span><br><span class="line">            return nextc == 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><p><a href="https://www.cnblogs.com/waterystone/p/4920797.html" target="_blank" rel="noopener">Javaå¹¶å‘ä¹‹AQSè¯¦è§£</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;AQS-AbstraceQueuedSynchronizer&quot;&gt;&lt;a href=&quot;#AQS-AbstraceQueuedSynchronizer&quot; class=&quot;headerlink&quot; title=&quot;AQS AbstraceQueuedSynchronizer&quot;&gt;
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>ThreadLocalåˆ†æ</title>
    <link href="http://yoursite.com/2020/05/19/ThreadLocal%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2020/05/19/ThreadLocalåˆ†æ/</id>
    <published>2020-05-19T13:08:37.000Z</published>
    <updated>2021-07-13T12:27:08.588Z</updated>
    
    <content type="html"><![CDATA[<p>åºŸè¯ä¸è¯´ï¼Œç›´æ¥å¼€æ•´ï¼Œä¸Šæºç </p><p>Javaä¸­æ¯ä¸ªThreadç±»ä¸­éƒ½æœ‰å±äºè‡ªå·±çš„ç§æœ‰mapï¼ˆThreadLocalMap keyæ˜¯ThreadLocalçš„å¼±å¼•ç”¨ï¼‰ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„mapæ˜¯ç§æœ‰çš„ç›¸äº’éš”ç¦»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class Thread implements Runnable &#123;</span><br><span class="line">    ...</span><br><span class="line">    ThreadLocal.ThreadLocalMap threadLocals = null;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="setæ–¹æ³•"><a href="#setæ–¹æ³•" class="headerlink" title="setæ–¹æ³•"></a>setæ–¹æ³•</h3><ol><li>è®¡ç®—hashå€¼ï¼Œæ‰¾åˆ°tableä¸­å¯¹åº”çš„ä½ç½®ï¼Œkeyæ˜¯nullç›´æ¥æ”¾å…¥ï¼Œkeyç›¸åŒæ›¿æ¢ï¼Œkeyå†²çªåå‘åæŸ¥æ‰¾ç›´åˆ°æ‰¾åˆ°å¯ä»¥æ’å…¥çš„åœ°æ–¹<ul><li>ä»è¿™ä¸ªæ’å…¥çš„æ–¹å¼å¯ä»¥çœ‹å‡ºï¼Œtableä¸­çš„æ¡¶å¯¹åº”ä¸€ä¸ªentryï¼Œä¸HashMapä¸­çš„é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ä¸åŒï¼Œè€Œä¸”åˆ°è¾¾3/4çš„å®¹é‡å°±ä¼šæ‰©å®¹ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨ï¼Œæ¡¶ä¸­æœ‰é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„</li></ul></li><li>æ’entryå cleanSomeSlot  ä»å½“å‰æ’å…¥entryçš„ä½ç½®ï¼Œå¾€åæ‰«ææ‰¾keyä¸ºnullçš„entryï¼Œæ‰¾lognæ¬¡ï¼ˆwho tell me è¿™æ˜¯ whyï¼Ÿï¼‰æ‰¾åˆ°keyä¸ºnullçš„entryï¼ˆå¯èƒ½1ä¸ªå¯èƒ½å¤šä¸ªï¼‰ expungeStaleEntry(i) æ–¹æ³•æ¸…ç†<ul><li>expungeStaleEntry(i) æ¸…ç†ä»iå¼€å§‹å¾€ååˆ°ä¸‹ä¸€ä¸ªentryæ˜¯nullä¹‹é—´çš„ä½ç½®</li></ul></li><li>å¦‚æœæ‰¾åˆ°keyä¸ºnullçš„entryï¼Œå¹¶ä¸”ç»è¿‡æ¸…ç†ä¹‹åtabçš„æ•°é‡è¿˜å¤§äºæ‰©å®¹çš„é˜ˆå€¼ï¼Œè°ƒç”¨ rehash æ–¹æ³•æ‰©å®¹<ul><li>expungeStaleEntries() æ¸…ç†æ•´ä¸ªtableä¸­keyæ˜¯nullçš„entryï¼Œæ¸…ç†ä¹‹åtabçš„sizeå¤§äºæ‰©å®¹çš„é˜ˆå€¼ è¿›è¡Œ resize ï¼ˆæ‰©å®¹çš„é€»è¾‘ï¼‰</li></ul></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">public void set(T value) &#123;</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    if (map != null)</span><br><span class="line">        map.set(this, value); // è¿›å…¥è¿™é‡Œ</span><br><span class="line">    else</span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br><span class="line">private void set(ThreadLocal&lt;?&gt; key, Object value) &#123;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    int len = tab.length;</span><br><span class="line">    int i = key.threadLocalHashCode &amp; (len-1);</span><br><span class="line"></span><br><span class="line">    for (Entry e = tab[i];</span><br><span class="line">         e != null;</span><br><span class="line">         e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line">  // keyç›¸åŒæ›¿æ¢ è¿”å›</span><br><span class="line">        if (k == key) &#123;</span><br><span class="line">            e.value = value;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // keyä¸ºnullæ›¿æ¢ è¿”å›</span><br><span class="line">        if (k == null) &#123;</span><br><span class="line">            replaceStaleEntry(key, value, i);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // æ‰¾åˆ°entryä¸ºnullçš„ä½ç½®æ’å…¥</span><br><span class="line">    tab[i] = new Entry(key, value);</span><br><span class="line">    int sz = ++size;</span><br><span class="line">    // cleanSomeSlotsæ¸…ç†ä¸€éƒ¨åˆ†entryåsizeè¿˜å¤§äºé˜ˆå€¼è¿›è¡Œæ‰©å®¹</span><br><span class="line">    if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)</span><br><span class="line">        rehash();</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">// å¦‚å‡½æ•°åæ‰€è¯´ï¼Œæ¸…ç†ä¸€éƒ¨åˆ†Soltsï¼ˆkeyä¸ºnullçš„entryï¼‰ï¼Œå…·ä½“çš„è¯´æ¸…ç†ä»iåˆ°ä¸‹ä¸€ä¸ªentryæ˜¯nullä¹‹é—´çš„éƒ¨åˆ†</span><br><span class="line">private boolean cleanSomeSlots(int i, int n) &#123;</span><br><span class="line">    boolean removed = false;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    int len = tab.length;</span><br><span class="line">    do &#123;</span><br><span class="line">        i = nextIndex(i, len);// ä»iå¼€å§‹å¾€ä¸‹éå†ï¼Œéå†lognæ¬¡</span><br><span class="line">        Entry e = tab[i];</span><br><span class="line">        if (e != null &amp;&amp; e.get() == null) &#123;// æ‰¾åˆ°keyæ˜¯nullçš„entry</span><br><span class="line">            n = len;</span><br><span class="line">            removed = true;</span><br><span class="line">            i = expungeStaleEntry(i);// æ¸…ç†ä»iå¼€å§‹åˆ°entryä¸ºnullçš„ä½ç½® å¹¶ä¸”å¯¹keyä¸ä¸ºnullçš„entryåšrehash ä»£ç å°±ä¸è´´äº†</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; while ( (n &gt;&gt;&gt;= 1) != 0);// æ¯æ¬¡n/2 éå†lognæ¬¡</span><br><span class="line">    return removed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="getæ–¹æ³•"><a href="#getæ–¹æ³•" class="headerlink" title="getæ–¹æ³•"></a>getæ–¹æ³•</h3><ol><li>è°ƒç”¨threadLocalMapä¸­çš„getEntryæ–¹æ³•ï¼Œé€šè¿‡hashå€¼æ‰¾åˆ°tabä¸­çš„ä½ç½®ï¼Œå½“å‰ä½ç½®æ²¡æ‰¾åˆ°è°ƒç”¨ getEntryAfterMiss æ–¹æ³•</li><li>getEntryAfterMiss ä»å½“å‰ä½ç½®å¾€åæ‰¾åˆ°keyçš„entryè¿”å›</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public T get() &#123;</span><br><span class="line">Thread t = Thread.currentThread();</span><br><span class="line">ThreadLocalMap map = getMap(t);</span><br><span class="line">if (map != null) &#123;</span><br><span class="line">    ThreadLocalMap.Entry e = map.getEntry(this);// è¿›å…¥è¿™é‡Œçœ‹çœ‹</span><br><span class="line">    if (e != null) &#123;</span><br><span class="line">        @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">        T result = (T)e.value;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">return setInitialValue();// mapä¸ºç©ºsetåˆå§‹å€¼</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Entry getEntry(ThreadLocal&lt;?&gt; key) &#123;</span><br><span class="line">    int i = key.threadLocalHashCode &amp; (table.length - 1);</span><br><span class="line">    Entry e = table[i];</span><br><span class="line">    if (e != null &amp;&amp; e.get() == key)</span><br><span class="line">        return e;</span><br><span class="line">    else</span><br><span class="line">        return getEntryAfterMiss(key, i, e); // hashåçš„ä½ç½®æ²¡æ‰¾åˆ°key</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">// ä»å½“å‰ä½ç½®å‘åæ‰¾ è¿‡ç¨‹ä¸­é‡åˆ°keyä¸ºnullçš„ entry è°ƒç”¨expungeStaleEntry(i)è¿›è¡Œæ¸…ç†</span><br><span class="line">private Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) &#123;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    int len = tab.length;</span><br><span class="line"></span><br><span class="line">    while (e != null) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line">        if (k == key)</span><br><span class="line">            return e;</span><br><span class="line">        if (k == null) // é‡åˆ°keyæ˜¯nullçš„entryè¿›è¡Œæ¸…ç†</span><br><span class="line">            expungeStaleEntry(i);// ä¸setè¿‡ç¨‹ä¸­è°ƒç”¨åŒä¸€æ–¹æ³•ï¼Œæ¸…ç†ä»iåˆ°ä¸‹ä¸€ä¸ªkeyä¸ºnullèŠ‚ç‚¹ä¹‹é—´çš„ä½ç½®</span><br><span class="line">        else</span><br><span class="line">            i = nextIndex(i, len);</span><br><span class="line">        e = tab[i];</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜æº¢å‡ºé—®é¢˜"><a href="#å†…å­˜æº¢å‡ºé—®é¢˜" class="headerlink" title="å†…å­˜æº¢å‡ºé—®é¢˜"></a>å†…å­˜æº¢å‡ºé—®é¢˜</h3><ul><li>ThreadLocalçš„ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼Œå› ä¸ºnew ThreadLocalå¯¹è±¡ï¼Œæ‰€æœ‰æ ˆä¸­æœ‰ThreadLocalçš„å¼ºå¼•ç”¨ï¼Œè€ŒThreadLocalMapä¸­keyæ˜¯ThreadLocalçš„å¼±å¼•ç”¨ï¼Œå¦‚æœå°†ThreadLocalå¯¹è±¡ç½®ä¸ºnullï¼Œåˆ™ThreadLocalåªæœ‰å¼±å¼•ç”¨æŒ‡å‘å®ƒï¼Œå½“ä¸‹æ¬¡gcçš„æ—¶å€™keyä¼šè¢«å›æ”¶æ‰</li></ul><p><img src="/images/ThreadLocal.png" alt="upload successful"></p><ul><li>å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰é€€å‡ºï¼Œvalueä¾ç„¶æœ‰å¼ºå¼•ç”¨æŒ‡å‘å®ƒï¼Œæ‰€ä»¥valueå¹¶ä¸ä¼šè¢«å›æ”¶ï¼Œè™½ç„¶ç»è¿‡åˆ†ææºç ä½¿ç”¨getå’Œsetæ–¹æ³•ä¼šæ¸…ç†mapä¸­çš„keyä¸ºnullçš„ä¸€éƒ¨åˆ†èŠ‚ç‚¹æ¸…ç†æ‰ï¼Œä½†æ˜¯åœ¨è°ƒç”¨getå’Œsetä¹‹å‰ä»ç„¶å­˜åœ¨oomçš„é£é™©</li><li>æœ€ç¨³å¦¥çš„å°±æ˜¯ä½¿ç”¨removeæ–¹æ³•ï¼Œå°†ä¸éœ€è¦çš„ThreadLocalæ¸…ç†æ‰</li><li>ä¸è¦å’Œçº¿ç¨‹æ± ä¸€èµ·ä½¿ç”¨ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¤ç”¨çš„ï¼Œæ°¸è¿œä¸ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥çº¿ç¨‹ä¸­çš„ThreadLocalMapä¹Ÿä¸ä¼šè¢«æ¸…ç†ï¼Œå¦‚æœè¿™ä¸ªçº¿ç¨‹ä¸€ç›´ä¸è¢«ä½¿ç”¨æˆ–è€…ä¸åœ¨è°ƒç”¨getå’Œsetæ–¹æ³•ï¼Œè¿™å—å†…å­˜æ°¸è¿œä¸ä¼šè¢«å›æ”¶</li></ul><h3 id="æŒ–å‘"><a href="#æŒ–å‘" class="headerlink" title="æŒ–å‘"></a>æŒ–å‘</h3><ul><li>æ ¹æ®nextIndexæ–¹æ³•é‡Œçš„å®ç°æ¥çœ‹ï¼Œè¿™ä¸ªç»“æ„æ˜¯ä¸€ä¸ªç¯å½¢ç»“æ„</li></ul><pre><code>private static int nextIndex(int i, int len) {    return ((i + 1 &lt; len) ? i + 1 : 0);}</code></pre><ul><li><a href="https://mp.weixin.qq.com/s/vURwBPgVuv4yGT1PeEHxZQ" target="_blank" rel="noopener">å‚è€ƒæ–‡çŒ®</a>ä¸­æ‰€è¯´ï¼Œhashç®—æ³•ä½¿ç”¨é»„é‡‘åˆ†å‰²æ•°ï¼Œå¤§å¤§é™ä½äº†hashå†²çªçš„å‡ ç‡ï¼Œå…·ä½“æ€ä¹ˆé™ä½çš„å…ˆæŒ–ä¸ªå‘åé¢å†å¡«</li></ul><h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><p><a href="https://mp.weixin.qq.com/s/vURwBPgVuv4yGT1PeEHxZQ" target="_blank" rel="noopener">ä¸€ç¯‡æ–‡ç« å½»åº•äº†è§£ThreadLocalçš„åŸç† </a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åºŸè¯ä¸è¯´ï¼Œç›´æ¥å¼€æ•´ï¼Œä¸Šæºç &lt;/p&gt;
&lt;p&gt;Javaä¸­æ¯ä¸ªThreadç±»ä¸­éƒ½æœ‰å±äºè‡ªå·±çš„ç§æœ‰mapï¼ˆThreadLocalMap keyæ˜¯ThreadLocalçš„å¼±å¼•ç”¨ï¼‰ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„mapæ˜¯ç§æœ‰çš„ç›¸äº’éš”ç¦»&lt;/p&gt;
&lt;figure class=&quot;highlight plai
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>geté™æµå§¿åŠ¿</title>
    <link href="http://yoursite.com/2020/05/14/get%E9%99%90%E6%B5%81%E5%A7%BF%E5%8A%BF/"/>
    <id>http://yoursite.com/2020/05/14/geté™æµå§¿åŠ¿/</id>
    <published>2020-05-14T13:06:35.000Z</published>
    <updated>2021-07-13T12:27:08.589Z</updated>
    
    <content type="html"><![CDATA[<p>é™æµé€šå¸¸ç”¨ä½œæœåŠ¡çš„é™çº§ç­–ç•¥ï¼Œä»¥ç‰ºç‰²ä¸€éƒ¨åˆ†è¯·æ±‚çš„æ–¹å¼æ¢æ¥ç³»ç»Ÿçš„éƒ¨åˆ†å¯ç”¨ï¼›åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ä¿æŠ¤ç³»ç»Ÿä¸ä¼šæŒ‚æ‰ï¼Œæ¯”å¦‚å¤§ä¿ƒã€ç§’æ€è¿™ç±»çš„åœºæ™¯ä¿æŠ¤åƒäº¤æ˜“è¿™æ ·çš„æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œé€šè¿‡å­¦ä¹ é™æµçš„ä»£ç ä¹‹åï¼ŒæŒæ¡äº†é€šå¸¸çš„é™æµå§¿åŠ¿ï¼Œåˆ†äº«ä¸€ä¸‹</p><h3 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h3><p>ç±»ä¼¼äºæ»‘åŠ¨çª—å£ï¼Œç»™å®šä¸€ä¸ªæ—¶é—´æ®µçš„æœ€å¤§è¯·æ±‚æ•°ï¼ˆçª—å£ï¼Œæ¯”å¦‚1ç§’æœ€å¤š100ä¸ªè¯·æ±‚ï¼‰ï¼Œå†å°†çª—å£è®¾ç½®å¤šä¸ªå°æ®µï¼ˆä¸€ä¸ªæ—¶é—´çš„åç§»é‡ï¼Œæ¯”å¦‚100msï¼Œä¸€ä¸ªçª—å£å°±è¢«åˆ†æˆäº†10å°æ®µï¼‰æ¯ä¸€å°æ®µè®°å½•å½“å‰æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œæ¯æ¬¡ç§»åŠ¨ä¸€å°æ®µï¼Œæ»‘å‡ºçš„ä¸€æ®µä¸­çš„è¯·æ±‚æ•°é‡è¢«é‡Šæ”¾ï¼Œæ–°è¿›å…¥çª—å£çš„ä¸€æ®µæœ€å¤šå¯ä»¥å¤„ç†è¢«é‡Šæ”¾çš„è¯·æ±‚æ•°é‡</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li>ç®€å•ç²—æš´å¥½å®ç°ï¼Œåç§»é‡å–å€¼è¶Šå°é™æµè¶Šç²¾ç»†ï¼Œæ¯æ¬¡æ»‘åŠ¨éœ€è¦è·å–å½“å‰ä¸€æ®µä¸­çš„è¯·æ±‚æ•°ï¼Œè®¡ç®—çª—å£ä¸­çš„æ€»çš„è¯·æ±‚æ•°æ˜¯å¦è¶…è¿‡é™å®šå€¼</li><li>å¦‚æœåœ¨ä¸­é—´ä¸€å°æ®µæ¶Œå…¥å¤§é‡è¯·æ±‚åˆ°è¾¾é™å®šå€¼ï¼Œé‚£å°±éœ€è¦ç­‰å¾…è¿™æ®µæ»‘å‡ºçª—å£åæ‰èƒ½å¤„ç†æ–°çš„è¯·æ±‚ï¼Œä»å®è§‚çš„è§’åº¦æ¥è¯´ï¼Œå¯ä»¥ä¿è¯çª—å£æœŸå†…çš„å¹³å‡å¤„ç†è¯·æ±‚çš„é‡ï¼Œä½†æ˜¯ä»å¾®è§‚æ¥çœ‹å¤„ç†è¯·æ±‚çš„æ–¹å¼ä¸å‡è¡¡ï¼Œå­˜åœ¨é£é™©</li></ul><h3 id="æ¼æ¡¶ç®—æ³•"><a href="#æ¼æ¡¶ç®—æ³•" class="headerlink" title="æ¼æ¡¶ç®—æ³•"></a>æ¼æ¡¶ç®—æ³•</h3><p>ä¸€ä¸ªç ´æ¡¶ä¸€è¾¹ä»¥ä¸€ä¸ªé€Ÿåº¦æ¼æ°´ï¼ˆå¤„ç†è¯·æ±‚ï¼‰ä¸€è¾¹ä»¥ä¸€ä¸ªé€Ÿåº¦å¾€é‡ŒåŠ æ°´ï¼ˆæ–°çš„è¯·æ±‚åˆ°æ¥ï¼‰ï¼›å‡è®¾å‘æ¡¶é‡ŒåŠ æ°´çš„é€Ÿåº¦å¾ˆå¿«ï¼ˆå¤§é‡æ–°çš„è¯·æ±‚åˆ°æ¥ï¼‰ä¸€ä¼šå°±æŠŠæ¡¶å æ»¡äº†ï¼Œæ­¤åå†å‘æ¡¶é‡ŒåŠ æ°´å°±ä¼šæ¼å‡ºå»ï¼ˆæ–°çš„è¯·æ±‚ä¼šè¢«ä¸¢å¼ƒï¼‰</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</span><br><span class="line">// ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°æ¡¶</span><br><span class="line">BlockingQueue bucket = new BlockingQueue(MAX_SIZE);</span><br><span class="line">// è¯·æ±‚æ¥ -&gt; å…¥é˜Ÿ</span><br><span class="line">if (!bucket.offer();&#123;</span><br><span class="line">    // å¤§äºæ¡¶çš„æœ€å¤§å€¼å…¥é˜Ÿå¤±è´¥ï¼Œåšè¿›ä¸€æ­¥æ“ä½œï¼ˆæ‹’ç»ã€ä¿å­˜åˆ°mqæˆ–è€…dbä¸­ï¼‰</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">while (true) &#123;</span><br><span class="line">    bucker.take();</span><br><span class="line">    // å‡ºé˜ŸæˆåŠŸ å¼‚æ­¥å¤„ç†è¯·æ±‚ ç­‰å¾…ä¸‹ä¸€ä¸ªå‘¨æœŸåå†æ¬¡ä»é˜Ÿåˆ—ä¸­è·å–è¯·æ±‚ï¼Œé˜Ÿåˆ—ä¸ºç©ºé˜»å¡åœ¨åŸåœ°</span><br><span class="line">    sleep(10);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li>é€šè¿‡è®¡ç®—æ¯æ¬¡è¯·æ±‚çš„æœ€å°æ—¶é—´é—´éš”ï¼Œå½“å¤§é‡çš„è¯·æ±‚åˆ°æ¥æ—¶è®©ç³»ç»Ÿä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å»å¤„ç†è¯·æ±‚ï¼Œä¿æŠ¤ç³»ç»Ÿä¸ä¼šè¢«è¶…è¿‡æœ¬èº«å¤„ç†èƒ½åŠ›çš„è¯·æ±‚æ‰“æŒ‚</li><li>ä¸è¶³ä¹‹å¤„æ˜¯ä¸å¤Ÿä¼˜é›…ï¼›å½“æŸä¸ªæ—¶é—´ç‚¹æœ‰å¤§é‡çš„è¯·æ±‚åˆ°æ¥å¾ˆå¿«å°†æ¡¶å¡æ»¡ï¼Œå¤šäºçš„è¯·æ±‚ç›´æ¥ä¸¢å¼ƒï¼Œè€Œçªç„¶æœ‰å¤§é‡è¯·æ±‚çš„åœºæ™¯æœ‰å¾ˆå¤šï¼ˆä¾‹å¦‚ç§’æ€ï¼Œå¤§ä¿ƒç­‰ï¼‰è¿™äº›éƒ½æ˜¯æ­£å¸¸çš„è¯·æ±‚ï¼Œä¸åº”è¯¥è¢«ä¸¢å¼ƒï¼›</li></ul><h3 id="ä»¤ç‰Œæ¡¶"><a href="#ä»¤ç‰Œæ¡¶" class="headerlink" title="ä»¤ç‰Œæ¡¶"></a>ä»¤ç‰Œæ¡¶</h3><p>ä»¥ä¸€ä¸ªé€Ÿåº¦å‘æ¡¶é‡Œç”Ÿäº§ä»¤ç‰Œï¼Œå½“æ¡¶å†…ä»¤ç‰Œæ»¡äº†æ—¶å°†æš‚åœç”Ÿäº§ï¼Œå¤„ç†è¯·æ±‚éœ€è¦ä»æ¡¶é‡Œæ‹¿åˆ°ä»¤ç‰Œæ‰å¯ä»¥ï¼Œå¦‚æœæ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œæ‹’ç»è¯¥è¯·æ±‚ï¼ˆé€šå¸¸çš„åšæ³•æ˜¯è¿”å›ä¸€ä¸ªé™æµä¿¡æ¯ï¼Œç±»ä¼¼äºéé˜»å¡çš„æ–¹å¼ï¼‰</p><h4 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// ä¸€ä¸ªè¯·æ±‚å‘¨æœŸçš„ç±»</span><br><span class="line">class Cycle&#123;</span><br><span class="line">    lastTime;// ä¸Šä¸€æ¬¡è¯·æ±‚çš„æ—¶é—´æˆ³</span><br><span class="line">    curTokenCount;// å½“å‰æ¡¶å†…æœ‰æ•ˆtokenæ•°é‡</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public boolean getLicense() &#123;</span><br><span class="line">// æ˜¯å¦å¯ä»¥æ‰§è¡Œè¯·æ±‚</span><br><span class="line">boolean license = false;</span><br><span class="line">do &#123;</span><br><span class="line">    // è¯·æ±‚åˆ°æ¥ï¼Œè®¡ç®—ä»é™æµå¼€å§‹åˆ°ç°åœ¨çš„æ—¶é—´é—´éš”ï¼Œé€šè¿‡å½“å‰æ—¶é—´æˆ³-å¼€å§‹æ—¶é—´æˆ³</span><br><span class="line">curTime = currentTime - startTime;</span><br><span class="line">// è®¡ç®—ä»ä¸Šä¸€æ¬¡è¯·æ±‚å¼€å§‹åˆ°ç°åœ¨çš„æ—¶é—´é—´éš”ï¼ŒlastTimeæ˜¯ä»é™æµå¼€å§‹åˆ°ä¸Šä¸€æ¬¡è¯·æ±‚çš„æ—¶é—´é—´éš”</span><br><span class="line">curDuration = curTime - lastTime;</span><br><span class="line">// è®¡ç®—è¿™æ®µæ—¶é—´äº§ç”Ÿçš„ä»¤ç‰Œæ•°é‡</span><br><span class="line">incrementTokenCount = curDuration * createTokenSpeed;</span><br><span class="line">// è®¡ç®—å½“å‰æ—¶é—´å†…æœ‰æ•ˆçš„tokenæ•°é‡ curTokenCountæ˜¯å½“å‰æ¡¶é‡Œçš„tokenæ•°é‡</span><br><span class="line">curTokenCount = Min(maxTokenCount, currentTokenCount + incrementTokenCount);</span><br><span class="line">// å¦‚æœæœ‰æ•ˆçš„tokenæ•°é‡å¤§äº0ï¼Œæ•°é‡å‡ä¸€å¤„ç†è¯·æ±‚ï¼Œ</span><br><span class="line">if (curToken &gt; 0) &#123;</span><br><span class="line">    incrementTokenCount--;</span><br><span class="line">    license = true;</span><br><span class="line">&#125; </span><br><span class="line">lastTime = curTime;</span><br><span class="line">&#125; while (!CAS(curCycle, new Cycle(lastTime, curTokenCount)));// CASæ“ä½œè®¾ç½®å½“å‰è¯·æ±‚å‘¨æœŸä¸ºä¸‹ä¸€ä¸ªå‘¨æœŸï¼Œæ“ä½œæˆåŠŸè¿›å…¥ä¸‹ä¸€å‘¨æœŸï¼Œè¿”å›æ˜¯å¦å¯ä»¥æ‰§è¡Œè¯·æ±‚</span><br><span class="line">// è¦è¿›å…¥ä¸‹ä¸€å‘¨æœŸéœ€è¦CASæ“ä½œlastTimeå’ŒcurTokenCountä¸¤ä¸ªå˜é‡ï¼Œåˆ†åˆ«CASä¸èƒ½ä¿è¯ä¸€è‡´æ€§ï¼Œæ‰€ä»¥å°è£…æˆä¸€ä¸ªå¯¹è±¡åšCASæ“ä½œ</span><br><span class="line">return license;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li>ç›¸è¾ƒä¸æ¼æ¡¶ç®—æ³•ï¼Œä»¤ç‰Œæ¡¶å¯ä»¥åº”å¯¹ä¸€äº›çªå‘æµé‡çš„å˜å¤§ï¼Œæœ€å¤§åŒæ—¶å¤„ç†ä»¤ç‰Œæ¡¶ä¸­æœ€å¤§ä»¤ç‰Œæ•°é‡çš„è¯·æ±‚ï¼Œæ‰€æœ‰è®¾ç½®ä»¤ç‰Œæ¡¶ä¸­æœ€å¤§ä»¤ç‰Œæ•°é‡è¦éå¸¸å°å¿ƒï¼Œå¦åˆ™ä¼šæŠŠæœåŠ¡å™¨å‹å®</li><li>Guavaä¸­å®ç°äº†æ¼æ¡¶ç®—æ³•çš„é™æµå™¨ï¼Œè¿˜å…·æœ‰ä¸€å®šçš„è¶…é¢æ¶ˆè´¹çš„èƒ½åŠ›ï¼Œæ›´çµæ´»äº†ä¸€ä¸‹ï¼Œå…·ä½“å®ç°åŸç†ä¹Ÿå·®ä¸å¤šï¼Œå¯ä»¥ç›´æ¥ç”¨</li></ul><p>ä»¥ä¸Šæ˜¯å•æœºæ¨¡å¼ä¸‹çš„é™æµå®ç°ï¼Œåªéœ€è¦æ‹¦æˆªæ¯æ¬¡è¯·æ±‚ï¼Œæ‰§è¡Œä¸Šé¢çš„é€»è¾‘æ ¹æ®æ˜¯å¦æ»¡è¶³æ¡ä»¶å†³å®šå¤„ä¸å¤„ç†è¯·æ±‚ï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é™æµå¯ä»¥ä½¿ç”¨lua+redisæ¥å®ç°</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é™æµé€šå¸¸ç”¨ä½œæœåŠ¡çš„é™çº§ç­–ç•¥ï¼Œä»¥ç‰ºç‰²ä¸€éƒ¨åˆ†è¯·æ±‚çš„æ–¹å¼æ¢æ¥ç³»ç»Ÿçš„éƒ¨åˆ†å¯ç”¨ï¼›åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ä¿æŠ¤ç³»ç»Ÿä¸ä¼šæŒ‚æ‰ï¼Œæ¯”å¦‚å¤§ä¿ƒã€ç§’æ€è¿™ç±»çš„åœºæ™¯ä¿æŠ¤åƒäº¤æ˜“è¿™æ ·çš„æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œé€šè¿‡å­¦ä¹ é™æµçš„ä»£ç ä¹‹åï¼ŒæŒæ¡äº†é€šå¸¸çš„é™æµå§¿åŠ¿ï¼Œåˆ†äº«ä¸€ä¸‹&lt;/p&gt;
&lt;h3 id=&quot;è®¡æ•°å™¨&quot;&gt;&lt;a href=&quot;#è®¡æ•°å™¨
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>åˆè¯†Guava Cache</title>
    <link href="http://yoursite.com/2020/05/11/%E5%88%9D%E8%AF%86Guava%20Cache/"/>
    <id>http://yoursite.com/2020/05/11/åˆè¯†Guava Cache/</id>
    <published>2020-05-11T11:37:37.000Z</published>
    <updated>2021-07-13T12:27:08.592Z</updated>
    
    <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>éšç€ç³»ç»Ÿçš„è†¨èƒ€ï¼Œæ•°é‡è¶Šæ¥è¶Šå¤§ï¼Œç»Ÿè®¡æŠ¥è¡¨çš„ç›¸å…³SQLä¼šéå¸¸æ…¢ï¼Œä»£è¡¨çš„SQLæ˜¯è¿™æ ·ï¼Œéœ€è¦ç»Ÿè®¡ä¸¤å¼ è¡¨ä¸­ä¸é‡å¤çš„ipï¼Œå¤§æ¦‚æ˜¯2000wä¸¤çº§ï¼Œåªèƒ½ä¸¤å¼ è¡¨åˆ†åˆ«distinctï¼Œæœ€åunionçš„æ—¶å€™å†distinctä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°æ›´å¥½çš„åŠæ³•ï¼Œåªèƒ½åŠ ç¼“å­˜äº†</p><ul><li>è€ƒè™‘è¿‡ä½¿ç”¨Redisï¼Œè¿™æ˜¯å¸¸è§„çš„åšæ³•ï¼Œå¯æ˜¯è¦ç¼“å­˜çš„æ•°æ®å¾ˆå°‘ï¼Œç»“æ„ç®€å•ï¼Œè®¿é—®é‡ä¸å¤§é€šå¸¸æ˜¯ç®¡ç†å‘˜æ¥æŸ¥çœ‹ç»Ÿè®¡ä¸€ä¸‹äº§å“çš„ä½¿ç”¨æƒ…å†µï¼Œä½¿ç”¨Redisé€»è¾‘å¤æ‚ï¼Œè¿˜è¦è€ƒè™‘ç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜é›ªå´©çš„æƒ…å†µï¼Œè¿˜ä¾èµ–äºRedisçš„å¯ç”¨æ€§ï¼Œæ‰€ä»¥å†³å®šèˆå¼ƒè¯¥æ–¹æ¡ˆï¼Œä½¿ç”¨Guava Cacheæ¥åšç¼“å­˜ï¼Œå¹¶åœ¨æ—¶é—´é—´éš”å†…è¿›è¡Œç¼“å­˜æ•°æ®çš„æ›´æ–°<ul><li>Guava Cacheè™½ç„¶æä¾›ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œä½†æ˜¯åªæœ‰åœ¨è¿‡æœŸä¹‹åçš„ä¸€æ¬¡getæ‰ä¼šè¿›è¡Œç¼“å­˜çš„æ›´æ–°ï¼Œè€Œä¸”å¦‚æœè·å–ç¼“å­˜çš„æ—¶é—´å¾ˆé•¿ä¼šé€ æˆé˜»å¡ï¼Œè¿™æ ·ç¼“å­˜çš„æ„ä¹‰å°±æ²¡äº†ï¼›</li><li>å¦‚æœè®¾ç½®æˆå¼‚æ­¥åˆ·æ–°ç¼“å­˜ï¼Œå¯ä»¥è§£å†³é˜»å¡çš„é—®é¢˜ï¼Œä½†æ˜¯å¾—åˆ°çš„æ—¶ä¸Šä¸€ä¸ªæ—¶é—´å‘¨æœŸçš„æ•°æ®ï¼Œç¼“å­˜çš„å®æ—¶æ€§ä¸èƒ½ä¿è¯ï¼›</li><li>æœ€ç»ˆé‡‡ç”¨å¼€å¯å®šæ—¶çš„çº¿ç¨‹ï¼Œåœ¨æ¯ä¸ªæ—¶é—´å‘¨æœŸå†…å¼‚æ­¥åˆ·æ–°ç¼“å­˜æ•°æ®ï¼Œæœ€åçš„æƒ…å†µæ˜¯å¾—åˆ°ä¸Šä¸€ä¸ªæ—¶é—´å‘¨æœŸçš„æ•°æ®ï¼Œä½†æ˜¯å¯ä»¥è§£å†³ä¸Šä¸€æ¡ä¸­å¤šæ¬¡ç‚¹å‡»æ‰ä¼šåˆ·æ–°çš„ç‚¹ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé£é™©ç‚¹ï¼Œå¦‚æœå¤šä¸ªæœåŠ¡å™¨åœ¨åŒä¸€æ—¶é—´å¯åŠ¨ï¼Œå°±ä¼šåœ¨ç›¸åŒçš„æ—¶é—´é—´éš”å»è¯·æ±‚æ•°æ®åº“è®¡ç®—æ•°æ®å¹¶æ›´æ–°ï¼Œå¯èƒ½é€ æˆæ•°æ®åº“CPUå¿™ç¢ŒçŠ¶æ€ï¼Œæˆ‘çš„ç¯å¢ƒæ˜¯4å°æœåŠ¡å™¨ï¼Œå¹¶å‘çš„å»è¯·æ±‚æ•°æ®åº“æ˜¯æ²¡é—®é¢˜çš„ï¼Œè€Œä¸”é€šå¸¸éƒ½æ˜¯æ»šåŠ¨æ›´æ–°ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œç»¼åˆè¯„ä¼°åé‡‡ç”¨è¯¥æ–¹æ¡ˆ</li></ul></li><li>å®ç°<ul><li>åœ¨Springå®¹å™¨å¯åŠ¨å®Œæ¯•çš„æ—¶å€™ï¼ˆè¿™é‡Œæœ‰ä¸ªå‘ï¼Œå› ä¸ºspringå®¹å™¨æ²¡æœ‰å¯åŠ¨å®Œæˆæ˜¯ä¸èƒ½ä¸æ•°æ®åº“å»ºç«‹è¿æ¥çš„ï¼Œæ‰€ä»¥åœ¨springå®¹å™¨å¯åŠ¨è¿‡ç¨‹ä¸­å°±åŠ è½½ç¼“å­˜æ˜¯ä¸è¡Œçš„ï¼‰ï¼Œå¼€å¯çº¿ç¨‹ç»Ÿè®¡æ•°æ®ï¼ˆè¦æŸ¥ä»åº“é¿å…é”è¡¨ï¼‰</li><li>å†é€šè¿‡å®šæ—¶ä»»åŠ¡å¼‚æ­¥å»åˆ·æ–°æ•°æ®</li></ul></li></ul><h4 id="Guava-Cache"><a href="#Guava-Cache" class="headerlink" title="Guava Cache"></a>Guava Cache</h4><ul><li>ç¼–ç è¿‡ç¨‹ä¸­é‚£ä¸ªé€šå¸¸ç¼“å­˜çš„å®ç°æ˜¯å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¤šä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®åˆ°ï¼Œå¹¶å¯ä»¥å¯¹è¯¥å˜é‡è¿›è¡Œä¿®æ”¹ï¼›å½“ç„¶éœ€è¦ç”¨åˆ°çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ConcurrentHashMapï¼Œä½†æ˜¯ç¼“å­˜çš„æ›´æ–°åˆ é™¤ï¼Œè¿™äº›é€»è¾‘çš„è‡ªå·±å®ç°ï¼Œè€Œæˆ‘ç†è§£çš„Guava Cacheå°±æ˜¯å°è£…äº†è¿™äº›é€»è¾‘å¹¶æä¾›å‡ºAPIçš„ä¸€ä¸ªå·¥å…·</li><li>ç¼“å­˜è¿‡æœŸçš„è®¾ç½®æ–¹å¼</li><li>è®¾ç½®ç¼“å­˜çš„å¤§å°ï¼Œè¶…è¿‡é˜ˆå€¼çš„åˆ é™¤ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ç¼“å­˜çš„æ•°é‡ï¼Œkeyçš„æ•°é‡ï¼‰</li><li>è®¾ç½®ç¼“å­˜çš„æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´çš„åˆ é™¤<ul><li>ä¸æ˜¯å®šæ—¶å»åˆ¤æ–­çš„ï¼Œè€Œæ˜¯getçš„æ—¶å€™ä¼šåˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œè¶…æ—¶å°±é‡æ–°åŠ è½½ï¼Œè¿™æ ·å¦‚æœåˆ·æ–°keyçš„ç”¨æ—¶å¾ˆé•¿çš„è¯ä¼šé˜»å¡ï¼›Guava Cacheä¹Ÿæä¾›äº†å¼‚æ­¥åˆ·æ–°keyçš„æ–¹å¼ï¼Œè¿™æ ·å¦‚æœå¯¹ç¼“å­˜æ›´æ–°å®æ—¶æ€§è¦æ±‚é«˜çš„è¯ï¼Œåœ¨ç¼“å­˜åˆ·æ–°åé‡æ–°getæ‰èƒ½è·å¾—æœ€æ–°çš„ç¼“å­˜å€¼ï¼›æˆ–è€…ç”¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å¼‚æ­¥åˆ·æ–°key</li></ul></li><li>è®¾ç½®å¼±å¼•ç”¨ï¼Œè®©åƒåœ¾æ”¶é›†å™¨æ¥å›æ”¶</li><li>æ˜¾å¼çš„åˆ é™¤key</li><li>å¯ä»¥æ·»åŠ keyè¢«åˆ é™¤çš„ç›‘å¬å™¨</li></ul><p>ä½¿ç”¨äº†ç±»ä¼¼jdk1.7ä¸­ConcurrentHashMapçš„Segmentçš„ç»“æ„ï¼Œé™ä½é”çš„ç²’åº¦æé«˜å¹¶å‘çš„ååé‡ï¼›å†é€šè¿‡ä¸¤æ¬¡hashæ‰¾åˆ°valueçš„ä½ç½®</p><h4 id="ç›¸å…³çŸ¥è¯†"><a href="#ç›¸å…³çŸ¥è¯†" class="headerlink" title="ç›¸å…³çŸ¥è¯†"></a>ç›¸å…³çŸ¥è¯†</h4><ul><li>å¼ºå¼•ç”¨<ul><li>é€šè¿‡ new å…³é”®å­—äº§ç”Ÿï¼Œä¸ä¼šè¢«JVMå›æ”¶ï¼›å¦‚æœæ˜¯å±€éƒ¨å˜é‡ï¼Œå¼•ç”¨ä¿å­˜åœ¨çº¿ç¨‹æ ˆä¸­ï¼Œæ–¹æ³•ç»“æŸå¼•ç”¨è¢«ä¾èµ–çš„æ•°é‡ä¸º0ï¼Œå°†ä¼šè¢«JVMå›æ”¶æ‰ï¼›å¦‚æœæ˜¯å…¨å±€å˜é‡ï¼Œå¼•ç”¨å°†ä¸€ç›´ä¼šå­˜åœ¨ï¼Œå¯ä»¥å°†å¼•ç”¨è®¾ç½®ä¸ºnullè¢«JVMå›æ”¶</li></ul></li><li>è½¯å¼•ç”¨<ul><li>å†…å­˜å……è¶³æ—¶ä¸ä¼šè¢«å›æ”¶ï¼Œå½“å†…å­˜ç©ºé—´ä¸è¶³ä¼šè¢«å›æ”¶</li></ul></li><li>å¼±å¼•ç”¨<ul><li>JVMè¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™å°±ä¼šè¢«å›æ”¶æ‰ï¼Œå¦‚æœé•¿æ—¶é—´ä¸è¿›è¡Œåƒåœ¾å›æ”¶å°±ä¼šä¸€ç›´å­˜åœ¨</li></ul></li><li>è™šå¼•ç”¨<ul><li>å¿…é¡»ä¸å¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ï¼Œåœ¨JVMè¿›è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œè™šå¼•ç”¨ä¼šè¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­</li></ul></li><li>å¼•ç”¨é˜Ÿåˆ—<ul><li>å¯ä»¥å’Œè½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ï¼Œè™šå¼•ç”¨è”åˆä½¿ç”¨ï¼Œåœ¨JVMè¿›è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œè¦è¢«å›æ”¶çš„å¼•ç”¨ä¼šè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œç”¨æ¥æŸ¥çœ‹JVMåƒåœ¾å›æ”¶æƒ…å†µ </li></ul></li></ul><h4 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h4><ul><li>HashMap</li><li>jdk1.7 æ•°ç»„+é“¾è¡¨çš„ç»“æ„ å½“æœ‰hashå†²çªçš„æ—¶å€™é“¾è¡¨ä¼šå¾ˆé•¿ï¼ŒæŸ¥è¯¢ä¸€ä¸ªèŠ‚ç‚¹æ•ˆç‡å¾ˆä½ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(N)</li><li>jdk1.8 æ•°ç»„+çº¢é»‘æ ‘çš„ç»“æ„ é“¾è¡¨ä¸­èŠ‚ç‚¹å¤§äº8æ—¶ä¼šè½¬æˆçº¢é»‘æ ‘ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)<ul><li>put <ul><li>åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼ˆresizeï¼‰æˆ–è€…åˆå§‹åŒ–ï¼ˆæ‡’åŠ è½½ï¼‰</li><li>é€šè¿‡hashæ‰¾åˆ°æ¡¶ï¼Œæ²¡æœ‰å†²çªç›´æ¥æ”¾å…¥ï¼›</li><li>æœ‰hashå†²çªï¼Œa.åˆ¤æ–­æ˜¯å¦å’Œç¬¬ä¸€ä¸ªNodeçš„keyç›¸åŒï¼Œç›¸åŒåˆ™è¦†ç›–valueï¼›b.åˆ¤æ–­æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œæ’å…¥valueç›¸åŒkeyè¦†ç›– c.åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬çº¢é»‘æ ‘ï¼Œéœ€è¦åˆ™çº¢é»‘æ ‘æ’å…¥ï¼Œå¦åˆ™æ’å…¥é“¾è¡¨æœ«å°¾ï¼Œç›¸åŒkeyè¦†ç›–valueï¼Œ</li><li>æ’å…¥valueååˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</li></ul></li><li>get æ ¹æ®hashå€¼æ‰¾åˆ°æ¡¶ï¼Œä»æ¡¶ä¸­æ‰¾keyå¯¹åº”çš„valueï¼Œæ²¡æœ‰è¿”å›null</li><li>resize 1.8ä¸ä¼šè¿›è¡Œé‡æ–°hashï¼Œè€Œæ˜¯çœ‹hashå€¼æ–°å¢çš„é‚£ä¸ªbitä½æ˜¯1è¿˜æ˜¯0ï¼Œ0ä½ç½®ä¸å˜ï¼Œ1çš„è¯ä½ç½®æ˜¯åŸä½ç½®+æ‰©å®¹å‰å®¹é‡ ç´¢å¼•ä¸­çš„ä½ç½®ï¼Œç”±äºhashå€¼æ–°å¢çš„é‚£ä¸ªbitä¸ºå¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œæ‰€ä»¥å¯ä»¥å°†åŸæ¥æ¡¶ä¸­çš„é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘å‡åŒ€çš„æ‹†åˆ†æˆä¸¤ä¸ªé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘</li></ul></li><li>çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜<ul><li>1.7 å¯èƒ½ä¸¢å¤±keyï¼Œè¿˜ä¼šå‡ºç°å¾ªç¯é“¾è¡¨ï¼Œå½“getä¸€ä¸ªä¸å­˜åœ¨çš„keyå‡ºç°æ­»å¾ªç¯</li><li>1.8 ç”±äºtableä¸­sizeå˜é‡æ²¡æœ‰åŠ volatileå…³é”®å­—ï¼Œå¤šçº¿ç¨‹++sizeæ—¶å¯èƒ½è¦†ç›–ä»¥å‰çš„è®°å½•</li><li>çº¿ç¨‹ä¸å®‰å…¨ä¸»è¦æ˜¯ç”±äºresizeæ–¹æ³•å¯¼è‡´ï¼Œ1.7å…ˆrehashè½¬ç§»æ•°æ®åœ¨æ”¹æ•°ç»„çš„å¼•ç”¨ï¼Œè€Œä¸”è½¬ç§»æ•°æ®åé“¾è¡¨ä¼šåè½¬å¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹å¼•ç”¨ä¼šé€ æˆå¾ªç¯é“¾è¡¨çš„ç°è±¡ï¼›1.8å…ˆæ”¹æ•°ç»„çš„å¼•ç”¨å†è½¬ç§»æ•°æ®ï¼Œå¹¶ä¸”è½¬ç§»æ•°æ®ä¸ä¼šä¿®æ”¹é“¾è¡¨çš„ç»“æ„ï¼Œç†è®ºä¸Šä¸ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œä½†å½“å¤šçº¿ç¨‹å¹¶å‘æ“ä½œä¼šå‡ºç°æ•°æ®ä¸¢å¤±çš„ç°è±¡</li></ul></li><li>concurrentHashMap</li><li>1.7 å¼•å…¥segmentçš„æ¦‚å¿µï¼Œå°†æ•´ä¸ªtableåˆ’åˆ†æˆè‹¥å¹²ä¸ªsegmentï¼Œå¯¹segmentåŠ é”å‡å°é”çš„ç²’åº¦æé«˜ååé‡ï¼Œgetçš„æ—¶å€™å…ˆé€šè¿‡hashæ‰¾åˆ°segmentï¼Œå†æ‰¾åˆ°å¯¹åº”çš„tableä¸­çš„ä½ç½®</li><li>1.8 å¯¹NodeåŠ é”è¿›ä¸€æ­¥å‡å°äº†é”çš„ç²’åº¦æé«˜ååé‡ï¼ŒåŠ å…¥å¤šçº¿ç¨‹æ‰©å®¹çš„é€»è¾‘åŠ é€Ÿæ‰©å®¹çš„è¿‡ç¨‹ï¼Œputæ“ä½œæ—¶å‘ç°æ­£åœ¨æ‰©å®¹å¯ä»¥å¸®åŠ©æ‰©å®¹ï¼Œè€Œä¸æ˜¯é˜»å¡èµ·æ¥å‚»ç­‰<ul><li>æ‰©å®¹çš„é€»è¾‘å¾ˆå¤æ‚ï¼Œæ•´ç†ä¸€ä¸‹å¤§æ¦‚çš„é€»è¾‘å§ï¼Œé¦–å…ˆå°†CASæ“ä½œå°†tableæ‰©å®¹ï¼Œæ ¹æ®åŸæ¥tableçš„å¤§å°å°†æ‰©å®¹å·¥ä½œæ‹†æˆå¤šä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡æœ€å°‘è¿ç§»16ä¸ªæ¡¶ï¼Œå½“çº¿ç¨‹å®Œæˆæ‰©å®¹ä»»åŠ¡ä¼šç»§ç»­é¢†å–ä¸‹ä¸€ä¸ªä»»åŠ¡è¿›è¡Œæ‰©å®¹</li><li>å¤šçº¿ç¨‹é¢†å–ä»»åŠ¡å¼€å§‹æ‰©å®¹ï¼Œå®‰è£…ç´¢å¼•ä»å¤§åˆ°å°çš„é¡ºåºå¼€å§‹ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­getæ“ä½œï¼Œä¼šgetåˆ°ForwardNodeï¼Œè½¬å‘åˆ°æ–°çš„tableä¸­æŸ¥æ‰¾valueï¼›æ‰©å®¹è¿‡ç¨‹ä¸­putæ“ä½œï¼Œå¦‚æœå½“å‰æ‰©å®¹çš„çº¿ç¨‹æ•°é‡å°äºæœ€å¤§é™åˆ¶çš„æ•°é‡å°±åŠ å…¥æ‰©å®¹çš„é˜Ÿåˆ—ä¸­ï¼Œå¦åˆ™é˜»å¡</li><li>put ä½¿ç”¨synchronizedå…³é”®å­—å¯¹NodeåŠ é”ï¼›å½“Nodeä¸­çš„é“¾è¡¨å¤§äº8ï¼Œå¦‚æœå½“å‰å®¹é‡æ²¡æœ‰è¶…è¿‡64å…ˆè¿›è¡Œæ‰©å®¹ï¼Œå¦åˆ™æ‰è½¬çº¢é»‘æ ‘ï¼›æ‰©å®¹è¿‡ç¨‹ä¸­çº¢é»‘æ ‘èŠ‚ç‚¹å°äº6ä¸ªè½¬é“¾è¡¨</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h4&gt;&lt;p&gt;éšç€ç³»ç»Ÿçš„è†¨èƒ€ï¼Œæ•°é‡è¶Šæ¥è¶Šå¤§ï¼Œç»Ÿè®¡æŠ¥è¡¨çš„ç›¸å…³SQLä¼šéå¸¸æ…¢ï¼Œä»£è¡¨çš„SQLæ˜¯è¿™æ ·ï¼Œéœ€è¦ç»Ÿè®¡ä¸¤å¼ è¡¨ä¸­ä¸é‡å¤çš„ipï¼Œå¤§æ¦‚æ˜¯2000wä¸¤çº§ï¼Œåªèƒ½ä¸¤å¼ 
      
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>å°†Hexoåšå®¢è¿ç§»åˆ°dockerä¸­ï¼ˆç©¶æè§£å†³æ–¹æ¡ˆï¼‰</title>
    <link href="http://yoursite.com/2020/04/19/%E5%B0%86Hexo%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E5%88%B0docker%EF%BC%88%E7%A9%B6%E6%9E%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%89/"/>
    <id>http://yoursite.com/2020/04/19/å°†Hexoåšå®¢è¿ç§»åˆ°dockerï¼ˆç©¶æè§£å†³æ–¹æ¡ˆï¼‰/</id>
    <published>2020-04-19T00:47:36.000Z</published>
    <updated>2021-07-13T12:27:08.593Z</updated>
    
    <content type="html"><![CDATA[<p>å‰ä¸¤ä¸ªé˜¶æ®µæ˜¯ä¸¤ä¸ªæœˆå‰çš„è¯•éªŒç‰ˆæœ¬ï¼Œåªæ˜¯åœ¨æœ¬æœºä¸Šç”¨dockeræ¨¡æ‹Ÿå¹¶æ²¡æœ‰çœŸæ­£åšè¿ç§»ï¼Œç„¶è€Œåœ¨çœŸæ­£è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å¯ä»¥å®Œæ•´è¿ç§»ï¼Œä½†æ˜¯ä½“éªŒä¸å‹å¥½ï¼Œæˆ‘æ”¹è¿›äº†è¿ç§»æ–¹æ¡ˆï¼Œé¦–å…ˆæ€»ç»“ä¸€ä¸‹ç¼ºç‚¹å§</p><ul><li>å¯åŠ¨å®¹å™¨åéœ€è¦è¿›å…¥å®¹å™¨ä¸­ï¼Œå¯åŠ¨nginxåšè½¬å‘</li><li>å¦‚æœä¸ä½¿ç”¨ä¹Ÿéœ€è¦è¿›å…¥å®¹å™¨ä¸­å¯åŠ¨hexoï¼Œä¸”ä¸èƒ½é€€å‡ºå¦åˆ™hexoä¹Ÿä¼šè·Ÿç€é€€å‡º<ul><li>åå°å¯åŠ¨éœ€è¦ä¾èµ–pm2è¿™ä¸ªå·¥å…·</li><li>åå°å¯åŠ¨hexoå’Œnginxä¼šä¸ä¼šæœ‰èµ„æºäº‰æŠ¢çš„é—®é¢˜ï¼Œè¿™ä¸ªåº”è¯¥æ²¡æœ‰çº¯å±ç»™è‡ªå·±åŠ æˆ</li></ul></li><li>ä¿®æ”¹æ–‡ç« åå³ä½¿åšäº†æ–‡ä»¶æŒ‚è½½ä¹Ÿéœ€è¦è¿›å…¥å®¹å™¨ä¸­é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶</li></ul><p>å›¾è§£ä¸€ä¸‹ï¼ŒåŸæ¥çš„æ–¹æ¡ˆå’Œç°åœ¨çš„æ–¹æ¡ˆ</p><p><img src="/images/pasted-33.png" alt="upload successful"></p><p>å¯ä»¥çœ‹åˆ°åŸæ¥æ˜¯å¡åˆ°ä¸€ä¸ªdockerå®¹å™¨ä¸­çš„ï¼Œä¸­é—´çš„å›¾æ˜¯ç°åœ¨çš„æ¶æ„ï¼Œå°†nginxå’Œhexoæ‹†åˆ†ï¼Œåˆ†åˆ«æ”¾å…¥dockerä¸­ï¼Œnginxçš„dockerè½¬å‘è¯·æ±‚åˆ°hexoçš„dockerï¼Œhexoçš„dockeréœ€è¦è¿è¡Œhexo sï¼›æœªæ¥å¦‚æœæˆ‘æœ‰æ–°çš„ç½‘ç«™å¯ä»¥é‡æ–°éƒ¨ç½²ä¸€ä¸ªå®¹å™¨é€šè¿‡nginxåšè½¬å‘ï¼Œæ¯”å¦‚ï¼Œä¸åŒåŸŸåè½¬å‘åˆ°ä¸åŒçš„å®¹å™¨ï¼Œæˆ–è€…æˆ‘å†æä¸€ä¸ªWordPressç‰ˆæœ¬çš„dockerï¼Œè¿˜å¯ä»¥åšé‡‘ä¸é›€å‘å¸ƒï¼Œabæµ‹è¯•ã€‚å“ˆå“ˆ</p><p>ä¸‹é¢å¼€å§‹åŠ¨æ‰‹</p><h4 id="å…ˆä»nginxå¼€å§‹"><a href="#å…ˆä»nginxå¼€å§‹" class="headerlink" title="å…ˆä»nginxå¼€å§‹"></a>å…ˆä»nginxå¼€å§‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ç›´æ¥æ‹‰å–nginxé•œåƒ</span><br><span class="line">docker pull nginx</span><br><span class="line"># ä¿®æ”¹é…ç½®æ–‡ä»¶è¿è¡Œ æŠŠé…ç½®æ–‡ä»¶åšç›®å½•æŒ‚è½½ ç»‘å®š80ç«¯å£</span><br><span class="line">docker run -di nginx --name nginx -v /usr/local/temp/nginx.conf:/etc/conf/nginx/nginx.conf -p 80:80 nginx</span><br><span class="line"># ä¹‹åé…ç½®æœ‰å˜åŒ–ä¿®æ”¹ nginx.conf å docker restart å³å¯</span><br></pre></td></tr></table></figure><h4 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h4><p>ä¸ä¹‹å‰çš„ç‰ˆæœ¬ä¸åŒçš„æ˜¯ï¼Œæˆ‘è¦åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™å°±æŠŠhexoè¿è¡Œèµ·æ¥ï¼Œæ¯æ¬¡ä¿®æ”¹æ–‡ä»¶ådocker restartå°±èƒ½é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶å¯åŠ¨hexo</p><p>å‘ç‚¹</p><ul><li>åˆšå¼€å§‹æˆ‘å†dockerfileä¸­æ·»åŠ å‘½ä»¤ CMD[â€˜hexoâ€™,â€™sâ€™]</li><li>ç¼–è¯‘å¥½çš„é•œåƒrunäº†ä¹‹åå¹¶æ²¡æœ‰å¯åŠ¨ï¼ŒæŸ¥çœ‹çŠ¶æ€runäº†ä¹‹åå°±é€€å‡ºäº†</li><li>æˆ‘çš„ç¬¬ä¸€ååº”æ˜¯ä¸æ˜¯è¦åå°å¯åŠ¨æ‰å¯ä»¥ï¼Œéšå³æœ‰å°è¯•ä½¿ç”¨ pm2 åå°å¯åŠ¨ï¼Œä¿®æ”¹å‘½ä»¤CMD[â€˜pm2â€™,â€™startâ€™,â€™run.jsâ€™]</li><li>è¿˜æ˜¯ä¸è¡Œå‘¢ï¼Œå†·é™ä¸‹æ¥å‘ç°ä¸ç®¡æ˜¯hexoè¿˜æ˜¯pm2éƒ½æ˜¯nodejsä¸­çš„å‘½ä»¤ï¼Œè€Œdockerfileä¸­è¿è¡Œçš„åº”è¯¥æ˜¯shè„šæœ¬</li><li>äºæ˜¯è½¬æ¢æ€è·¯ dockerfileä¸­å¯åŠ¨shellè„šæœ¬ï¼Œè„šæœ¬ä¸­è¿è¡Œhexo ä¿®æ”¹å‘½ä»¤ CMD [â€œ/usr/local/myblog/buildbak/run.shâ€]</li><li>è¿˜æœ‰ä¸€ä¸ªå°å‘ï¼Œè¿è¡Œèµ·æ¥ä¼šæŠ¥æ²¡æœ‰æƒé™çš„é”™è¯¯ å†æ·»åŠ å‘½ä»¤èµ‹æƒ é‡æ–°buildå°±å®Œæˆäº† chmod 777 /usr/local/myblog/buildbak/run.sh</li></ul><p>run.sh å¾ˆç®€å•ï¼Œæ¯æ¬¡cleanåé‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶å†å¯åŠ¨hexoï¼Œè¿™æ ·æ¯æ¬¡æ–°å¢æˆ–è€…ä¿®æ”¹åšå®¢çš„æ—¶å€™restartå°±å¥½äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">cd /usr/local/myblog;</span><br><span class="line">hexo clean;</span><br><span class="line">hexo g;</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>å®Œæ•´dockerfile</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line">MAINTAINER yywang sbsbjs@qq.com</span><br><span class="line"></span><br><span class="line"># å®‰è£…ä¾èµ–</span><br><span class="line">RUN yum update -y &amp;&amp; yum install -y wget git-core vim* gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel \</span><br><span class="line"></span><br><span class="line"># å®‰è£…nodejs</span><br><span class="line"></span><br><span class="line"># æ–°å»ºç›®å½• </span><br><span class="line">WORKDIR /usr/local</span><br><span class="line"># ä¸‹è½½tar</span><br><span class="line">RUN wget https://nodejs.org/dist/v12.15.0/node-v12.15.0-linux-x64.tar.xz \</span><br><span class="line"># è§£å‹</span><br><span class="line">&amp;&amp; tar -xvf node-v12.15.0-linux-x64.tar.xz \</span><br><span class="line">&amp;&amp; mv node-v12.15.0-linux-x64 node_12.15.0 \</span><br><span class="line">&amp;&amp; mkdir /usr/local/nodejs \</span><br><span class="line">&amp;&amp; mv node_12.15.0 /usr/local/nodejs/ \</span><br><span class="line">&amp;&amp; rm -rf node-v12.15.0-linux-x64.tar.xz \</span><br><span class="line"># éƒ¨ç½²binæ–‡ä»¶</span><br><span class="line">&amp;&amp; ln -s /usr/local/nodejs/node_12.15.0/bin/node /usr/local/bin/node \</span><br><span class="line">&amp;&amp; ln -s /usr/local/nodejs/node_12.15.0/bin/npm /usr/local/bin/npm \</span><br><span class="line"># ä¿®æ”¹npmæº</span><br><span class="line">&amp;&amp; npm config set registry https://registry.npm.taobao.org \</span><br><span class="line"># å®‰è£…hexo</span><br><span class="line">&amp;&amp; npm install -g hexo-cli \</span><br><span class="line"></span><br><span class="line"># é…ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">&amp;&amp; ln -s /usr/local/nodejs/node_12.15.0/bin/hexo /usr/local/bin/hexo \</span><br><span class="line"># åˆ›å»ºç½‘ç«™æ–‡ä»¶å¤¹</span><br><span class="line">&amp;&amp; mkdir /usr/local/myblog \</span><br><span class="line">&amp;&amp; cd /usr/local/myblog \</span><br><span class="line"># åˆå§‹åŒ–hexo</span><br><span class="line">&amp;&amp; hexo init \</span><br><span class="line">&amp;&amp; hexo generat \</span><br><span class="line"></span><br><span class="line"># å®‰è£…ä¾èµ–</span><br><span class="line">RUN yum update -y &amp;&amp; yum install -y zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make \</span><br><span class="line"># å¤‡ä»½åŸå§‹çš„python</span><br><span class="line">&amp;&amp; mv /usr/bin/python /usr/bin/python.bak \</span><br><span class="line"># ä¸‹è½½è§£å‹</span><br><span class="line">&amp;&amp; cd /usr/local \</span><br><span class="line">&amp;&amp; wget https://www.python.org/ftp/python/3.6.2/Python-3.6.2.tar.xz \</span><br><span class="line">&amp;&amp; tar -xvJf  Python-3.6.2.tar.xz \</span><br><span class="line"># ç¼–è¯‘å®‰è£…</span><br><span class="line">&amp;&amp; cd Python-3.6.2 \</span><br><span class="line">&amp;&amp; ./configure prefix=/usr/local/python3 \</span><br><span class="line">&amp;&amp; make &amp;&amp; make install \</span><br><span class="line">&amp;&amp; rm -rf /usr/local/Python-3.6.2.tar.xz \</span><br><span class="line"># æ·»åŠ è½¯é“¾</span><br><span class="line">&amp;&amp; ln -s /usr/local/python3/bin/python3 /usr/bin/python3 \</span><br><span class="line">&amp;&amp; ln -s /usr/local/python3/bin/pip3 /usr/bin/pip3 \</span><br><span class="line"># å®‰è£…ä¾èµ–</span><br><span class="line">&amp;&amp; pip3 install Pillow \</span><br><span class="line"># è¿ç§»åšå®¢ ç”±äºcloneé€Ÿåº¦æå…¶æ…¢ï¼Œè€Œä¸”è¿˜éœ€è¦æ·»åŠ gitç§˜é’¥ï¼Œæ”¹ç”¨æœ¬åœ°å…ˆcloneå¥½å¤åˆ¶è¿‡å»</span><br><span class="line">&amp;&amp; rm -rf /usr/local/myblog</span><br><span class="line">COPY myblog /usr/local/myblog/</span><br><span class="line"></span><br><span class="line"># å®‰è£…package.jsonä¸­çš„ä¾èµ–</span><br><span class="line"># ä¿®æ”¹ä¸‹è½½æºï¼Œå®‰è£…æ›´å¿«</span><br><span class="line">RUN npm install hexo --save \</span><br><span class="line">&amp;&amp; npm install hexo-admin --save \</span><br><span class="line">&amp;&amp; npm install hexo-deployer-git --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-archive --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-baidu-sitemap --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-category --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-feed --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-index --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-search --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-searchdb --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-sitemap --save \</span><br><span class="line">&amp;&amp; npm install hexo-generator-tag --save \</span><br><span class="line">&amp;&amp; npm install hexo-helper-live2d --save \</span><br><span class="line">&amp;&amp; npm install hexo-renderer-ejs --save \</span><br><span class="line">&amp;&amp; npm install hexo-renderer-marked --save \</span><br><span class="line">&amp;&amp; npm install hexo-renderer-stylus --save \</span><br><span class="line">&amp;&amp; npm install hexo-server --save \</span><br><span class="line">&amp;&amp; npm install hexo-tag-cloud --save \</span><br><span class="line">&amp;&amp; npm install hexo-wordcount --save \</span><br><span class="line"></span><br><span class="line"># é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶</span><br><span class="line">&amp;&amp; cd /usr/local/myblog \</span><br><span class="line">&amp;&amp; hexo clean \</span><br><span class="line">&amp;&amp; hexo g \</span><br><span class="line">&amp;&amp; chmod 777 /usr/local/myblog/buildbak/run.sh</span><br><span class="line"># ç¯å¢ƒæ­å»ºå®Œæˆï¼Œå¯åŠ¨è„šæœ¬</span><br><span class="line">CMD [&quot;/usr/local/myblog/buildbak/run.sh&quot;]</span><br></pre></td></tr></table></figure><p>buildå¥½é•œåƒåï¼Œè¿è¡Œå®¹å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di -v /usr/local/temp/myblog/source/_posts/:/usr/local/myblog/source/_posts/ -v /usr/local/temp/myblog/source/images/:/usr/local/myblog/source/images/ --name myblog -p 22000:4000 myblog:final</span><br></pre></td></tr></table></figure><p>å¯åŠ¨èµ·æ¥åæŸ¥è¯¢dockerip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format=&apos;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&apos; myblog</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹nginx.conf å°†è¯·æ±‚è½¬å‘åˆ°dockerçš„4000ç«¯å£ï¼Œé‡å¯nginxå®¹å™¨ï¼Œå®Œç¾ç»“æŸï¼Œæœ€åæŠŠé˜¿é‡Œäº‘ä¸Šçš„åŸŸåçš„è§„åˆ™ä¿®æ”¹ä¸ºæ–°çš„æœåŠ¡å™¨çš„ipï¼Œæˆäº†</p><p>æ¯æ¬¡ä¿®æ”¹æˆ–è€…æ–°å¢æ–‡ä»¶ï¼Œé‡å¯hexoå®¹å™¨å°±å¯ä»¥äº†ï¼Œæœ€ååˆ«å¿˜äº†æäº¤æ–‡ä»¶åˆ°githubä¸­åšå¤‡ä»½ </p><p>åç»­</p><ul><li>å°†Dockerfile nginx.conf run.sh å¤åˆ¶åˆ°myblogä¸­ï¼Œæäº¤åˆ°githubä¸­åšå¤‡ä»½</li><li>å°†æœ€ç»ˆçš„é•œåƒä¸Šä¼ è‡³é˜¿é‡Œäº‘</li><li>å¦‚æœå®¹å™¨æ²¡æœ‰å˜åŒ–è¿ç§»ç¯å¢ƒçš„è¯ç›´æ¥ï¼Œä»é˜¿é‡Œäº‘æ‹‰å–é•œåƒè¿è¡Œå³å¯</li><li>å¦‚æœå†…å®¹å˜åŒ–å°±è¦å…ˆæäº¤æœ€æ–°çŠ¶æ€åˆ°githubä¸­ï¼Œåœ¨æ–°çš„ç¯å¢ƒä¸­cloneä»“åº“ï¼Œé‡æ–°buildé•œåƒè¿è¡Œå³å¯</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‰ä¸¤ä¸ªé˜¶æ®µæ˜¯ä¸¤ä¸ªæœˆå‰çš„è¯•éªŒç‰ˆæœ¬ï¼Œåªæ˜¯åœ¨æœ¬æœºä¸Šç”¨dockeræ¨¡æ‹Ÿå¹¶æ²¡æœ‰çœŸæ­£åšè¿ç§»ï¼Œç„¶è€Œåœ¨çœŸæ­£è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å¯ä»¥å®Œæ•´è¿ç§»ï¼Œä½†æ˜¯ä½“éªŒä¸å‹å¥½ï¼Œæˆ‘æ”¹è¿›äº†è¿ç§»æ–¹æ¡ˆï¼Œé¦–å…ˆæ€»ç»“ä¸€ä¸‹ç¼ºç‚¹å§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯åŠ¨å®¹å™¨åéœ€è¦è¿›å…¥å®¹å™¨ä¸­ï¼Œå¯åŠ¨nginxåšè½¬å‘&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸
      
    
    </summary>
    
      <category term="å®¹å™¨" scheme="http://yoursite.com/categories/%E5%AE%B9%E5%99%A8/"/>
    
    
      <category term="å®¹å™¨" scheme="http://yoursite.com/tags/%E5%AE%B9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>æ­ç§˜äº¬ä¸œå¾®æœåŠ¡æ¡†æ¶çš„è´Ÿè½½å‡è¡¡ç®—æ³•</title>
    <link href="http://yoursite.com/2020/03/27/%E6%8F%AD%E7%A7%98%E4%BA%AC%E4%B8%9C%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95/"/>
    <id>http://yoursite.com/2020/03/27/æ­ç§˜äº¬ä¸œå¾®æœåŠ¡æ¡†æ¶çš„è´Ÿè½½å‡è¡¡ç®—æ³•/</id>
    <published>2020-03-27T14:38:43.000Z</published>
    <updated>2021-07-13T12:27:08.594Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨äº¬ä¸œå¹¿æ³›ä½¿ç”¨çš„å¾®æœåŠ¡æ¡†æ¶æ˜¯JSF(Jingdong Service Framework)ï¼Œä¸­æ–‡åå«æ°å¤«ï¼Œä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹JSFçš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚å…ˆä¸²ä¸€ä¸‹æœåŠ¡è°ƒç”¨çš„è¿‡ç¨‹ï¼Œconsumeråœ¨å‘providerå‘èµ·è¿œç¨‹è°ƒç”¨ä¹‹å‰ä¼šä»æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°è‡ªå·±è®¢é˜…çš„provideråˆ—è¡¨ï¼Œç„¶åå’Œåˆ—è¡¨ä¸­çš„providerå»ºç«‹è¿æ¥ç¼“å­˜èµ·æ¥ï¼Œå½“å‘èµ·è°ƒç”¨çš„æ—¶å€™ä¼šä»ç¼“å­˜çš„providerä¸­é€‰æ‹©ä¸€ä¸ªè¿›è¡Œè°ƒç”¨ï¼Œä»å¤šä¸ªprovideré€‰æ‹©ä¸€ä¸ªè¿›è¡Œè°ƒç”¨ï¼Œé‚£ä¹ˆå…·ä½“é€‰æ‹©å“ªä¸€ä¸ªå°±ç”¨åˆ°äº†è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸€ä¸‹JSFä¸­çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼š</p><h3 id="éšæœº"><a href="#éšæœº" class="headerlink" title="éšæœº"></a>éšæœº</h3><ul><li>æ— æƒé‡æˆ–æƒé‡ç›¸ç­‰åˆ™ä»provideråˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå‘èµ·è°ƒç”¨ï¼›</li><li>æœ‰æƒé‡ï¼Œå‡å®šæ€»çš„æƒé‡å€¼ä¸ºxï¼Œéšæœºç”Ÿæˆ[0-x)çš„åç§»é‡ï¼Œç„¶åéå†å‡å»provideråˆ—è¡¨çš„æƒé‡ï¼Œå½“åç§»é‡ä¸ºè´Ÿæ˜¯é€‰æ‹©å½“å‰çš„providerå‘èµ·è°ƒç”¨</li></ul><p>é™„ä¼ªä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// ...åˆå§‹åŒ–æ€»æƒé‡å€¼totalWeightå’Œæƒé‡æ˜¯å¦ç›¸åŒsameWeight,lengthä¸ºproviderListé•¿åº¦</span><br><span class="line"></span><br><span class="line">if (totalWeight &gt; 0 &amp;&amp; !sameWeight) &#123;</span><br><span class="line">    offset = random.nextInt(totalWeight);// åç§»é‡</span><br><span class="line">    for (item : providerList) &#123;</span><br><span class="line">        offset -= item.getWeight(i);</span><br><span class="line">        if (offset &lt; 0) &#123;</span><br><span class="line">            return item</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;// æ²¡æœ‰æƒé‡æˆ–æƒé‡ç›¸åŒéšæœºé€‰æ‹©</span><br><span class="line">    return providerList.get(random.nextInt(length));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®—æ³•å¤æ‚åº¦åˆ†æï¼š æœ‰æƒé‡å€¼æˆ–æ— æƒé‡å€¼éƒ½éœ€è¦å…ˆåˆå§‹åŒ–æ€»æƒé‡å€¼åŠæƒé‡å€¼æ˜¯å¦ç›¸ç­‰çš„å˜é‡å¤æ‚åº¦ä¸ºO(n)ï¼›æ²¡æœ‰æƒé‡å€¼éšæœºé€‰æ‹©ä¸€ä¸ªå‘èµ·è°ƒç”¨å¤æ‚åº¦ä¸ºO(1)ï¼›æœ‰æƒé‡å€¼ä¸”æƒé‡å€¼ä¸åŒé€šè¿‡åç§»é‡éšæœºé€‰æ‹©çš„å¤æ‚åº¦ä¸ºO(n)ï¼›<strong>æ— æƒé‡æ—¶çš„å¤æ‚åº¦ä¸ºO(n)ï¼Œæœ‰æƒé‡æ—¶æ€»çš„å¤æ‚åº¦ä¸º2O(n)</strong></p><h3 id="è½®è¯¢"><a href="#è½®è¯¢" class="headerlink" title="è½®è¯¢"></a>è½®è¯¢</h3><ul><li>æ— æƒé‡ï¼Œæ–¹æ³•çº§åˆ«çš„è½®è¯¢ï¼Œæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°å’Œprovideråˆ—è¡¨æ•°é‡å–ä½™çš„ç»“æœä¸ºé€‰æ‹©çš„provider</li><li>æœ‰æƒé‡ï¼Œåœ¨æ— æƒé‡çš„åŸºç¡€ä¸Šï¼Œå°†è°ƒç”¨æ¬¡æ•°å’ŒproviderListä¸­æœ€å¤§æƒé‡å€¼å–ä½™ï¼Œåœ¨Listä¸­ç­›é€‰æƒé‡å€¼å¤§äºä½™æ•°çš„providerï¼Œæœ€åè°ƒç”¨æ¬¡æ•°å’Œç­›é€‰ç»“æœé•¿åº¦å–ä½™çš„ç»“æœå°±æ˜¯æœ€ç»ˆé€‰æ‹©çš„provider<ul><li>å–ä½™çš„æ“ä½œæ˜¯è®©ç»“æœåœ¨[0-è¢«å–ä½™æ•°)ä¹‹é—´å¾ªç¯ï¼Œç¬¬ä¸€æ¬¡å’Œæœ€å¤§æƒé‡å–ä½™ï¼Œæ˜¯è®©æƒé‡ä»å°åˆ°å¤§å¾ªç¯èµ·æ¥ï¼›ç¬¬äºŒæ¬¡åœ¨ç­›é€‰çš„ç»“æœä¸­å–ä½™ï¼Œå°±æ˜¯åœ¨æƒé‡å€¼å¤§äºç¬¬ä¸€æ¬¡ä½™æ•°çš„ç»“æœä¸­å¾ªç¯é€‰æ‹©</li><li>egï¼šç¬¬ä¸€æ¬¡å–ä½™çš„ç»“æœå¤§ï¼Œç­›é€‰å‡ºæ¥çš„Listå°±ç›¸å¯¹è¾ƒå°ï¼Œä¸”Listéƒ½æ˜¯æƒé‡è¾ƒå¤§çš„providerï¼Œç¬¬äºŒæ¬¡å–ä½™æ˜¯åœ¨æƒé‡è¾ƒå¤§çš„providerä¸­è¿›è¡Œè½®è¯¢é€‰æ‹©ï¼›åä¹‹ï¼Œç¬¬ä¸€æ¬¡å–ä½™çš„ç»“æœå°ï¼Œç­›é€‰å‡ºæ¥çš„Listç›¸å¯¹è¾ƒå¤§ï¼Œç¬¬äºŒæ¬¡å–ä½™æ˜¯åœ¨ç›¸å¯¹è¾ƒå¤§çš„Listä¸­è¿›è¡Œè½®è¯¢é€‰æ‹©ï¼›è¿™æ ·åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šä¿è¯æƒé‡å€¼å¤§çš„providerçš„èŠ‚ç‚¹æœ‰æ›´å¤šæ¬¡æœºä¼šè¢«è½®è¯¢åˆ°</li></ul></li></ul><p>éªŒè¯ä¸€ä¸‹è¿™ä¸ªç®—æ³•ï¼šå‡è®¾æœ‰3ä¸ªProvider Aã€Bã€Cï¼Œä»–ä»¬çš„æƒé‡åˆ†åˆ«ä¸º3ã€3ã€4ï¼Œè¿›è¡Œ10æ¬¡è°ƒç”¨è¯•ä¸€ä¸‹ï¼Œæ¯ä¸€è¡Œçš„ç»“æœåˆ†åˆ«ä¸º è°ƒç”¨æ¬¡æ•°ã€%æœ€å¤§æƒé‡ã€ç­›é€‰å‡ºListé•¿åº¦ã€è°ƒç”¨æ¬¡æ•°%Listé•¿åº¦ã€æœ€åé€‰æ‹©</p><ul><li>0    0    3    0    A</li><li>1    1    3    1    B</li><li>2    2    3    2    C</li><li>3    3    1    -        C</li><li>4    0    3    1    B</li><li>5    1    3    2    C</li><li>6    2    3    0    A</li><li>7    3    1    -    C</li><li>8    0    3    2    B</li><li>9    1    3    0    A</li></ul><p>å¯ä»¥çœ‹åˆ°ç»“æœ10æ¬¡è°ƒç”¨ï¼ŒåŸºæœ¬æ˜¯è½®è¯¢çš„çŠ¶æ€ï¼Œè€Œä¸”æƒé‡ä¸º4çš„CèŠ‚ç‚¹è¢«è°ƒç”¨4æ¬¡</p><p>é™„ä¼ªä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// key = className+alias+method</span><br><span class="line">// åˆå§‹åŒ–æœ€å°å’Œæœ€å¤§æƒé‡ minWeight maxWeight</span><br><span class="line">if (maxWeight &gt; 0 &amp;&amp; minWeight &lt; maxWeight) &#123;</span><br><span class="line">    currentWeight = count % maxWeight;</span><br><span class="line">    subList = getSubList(providerList);// é€‰æ‹©æƒé‡å¤§äºå½“å‰æƒé‡çš„å­é›†</span><br><span class="line">    return subList.get(count%subList.size());</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // æ— æƒé‡æˆ–æƒé‡ç›¸ç­‰</span><br><span class="line">    count = getAndIncrement(key);// é€šè¿‡keyè·å–è°ƒç”¨æ¬¡æ•°å¹¶è‡ªå¢1</span><br><span class="line">    return providerList.get(count%length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®—æ³•å¤æ‚åº¦åˆ†æï¼šåˆå§‹åŒ–æœ€å°å’Œæœ€å¤§æƒé‡å¤æ‚åº¦ä¸ºO(n)ï¼Œæ— æƒé‡æˆ–æƒé‡ç›¸åŒç›´æ¥å–ä½™é€‰æ‹©å³å¯å¤æ‚åº¦O(1)ï¼›æœ‰æƒé‡æ—¶éœ€è¦ç­›é€‰å¤§äºå½“å‰æƒé‡çš„è‡ªå·±å¤æ‚åº¦ä¸ºO(n)ï¼Œå¯¹å­é›†è½®è¯¢ç®—è´¦å¤æ‚åº¦ä¸ºO(1)ï¼›<strong>æ— æƒé‡è½®è¯¢çš„å¤æ‚åº¦ä¸ºO(n)ï¼Œæœ‰æƒé‡è½®è¯¢çš„å¤æ‚åº¦ä¸º2O(n)</strong></p><h3 id="æœ€å°‘æ´»è·ƒä¼˜å…ˆ"><a href="#æœ€å°‘æ´»è·ƒä¼˜å…ˆ" class="headerlink" title="æœ€å°‘æ´»è·ƒä¼˜å…ˆ"></a>æœ€å°‘æ´»è·ƒä¼˜å…ˆ</h3><p>æ¯æ¬¡é€‰æ‹©æœ€å°‘æ´»è·ƒçš„providerå‘èµ·è°ƒç”¨ï¼Œå½“æœ€å°‘æ´»è·ƒçš„èŠ‚ç‚¹å¤šæ—¶ï¼Œåœ¨æœ€å°‘æ´»è·ƒçš„èŠ‚ç‚¹ä¸­ä½¿ç”¨éšæœºç®—æ³•ï¼Œæœ‰æƒé‡éšæœºæˆ–è€…æ— æƒé‡éšæœºé€‰æ‹©ï¼›</p><ul><li><p>æœ€å°‘æ´»è·ƒå¯ä»¥ç†è§£ä¸ºæœ€å°‘å¹¶å‘æ•°ï¼Œå¹¶å‘æ•°å°‘çš„èŠ‚ç‚¹è¡¨ç¤ºèŠ‚ç‚¹å¤„ç†è¯·æ±‚çš„é€Ÿåº¦å¿«ï¼Œæ€§èƒ½å¼º</p></li><li><p>æœ€å°‘æ´»è·ƒæ•°ä»¥æœ€è¿‘100æ¬¡è¿æ¥ä¸­çš„å¤±è´¥æ•°é‡ä¸ºå‡†ï¼Œå¦‚æœä¸º0è¡¨ç¤ºæœ€è¿‘æ²¡æœ‰å¤±è´¥è¿æ¥ï¼Œç›´æ¥è¿”å›çœŸå®çš„å¹¶å‘æ•°ï¼›å¦‚æœå¤§äº0ï¼Œé™åˆ¶æœ€å¤§å€¼ä¸º90ï¼Œåœ¨[0,100)ä¸­äº§ç”Ÿéšæœºæ•°ï¼Œå½“éšæœºæ•°æ¯”å¤±è´¥è¿æ¥æ•°å¤§æ—¶è¿”å›çœŸå®çš„å¹¶å‘æ•°ï¼Œå¦è‡ªè¿”å›æœ€å¤§å€¼ï¼›ä¹Ÿå°±æ˜¯è¯´èŠ‚ç‚¹ä¸­æœ€è¿‘100æ¬¡è¿æ¥æœ‰å¤±è´¥çš„è®°å½•ï¼Œè¯¥èŠ‚ç‚¹åˆ™æœ‰ä¸€å®šå‡ ç‡ä¸ä¼šè¢«é€‰ä¸­è°ƒç”¨ï¼Œä¸”å¤±è´¥çš„è¿æ¥æ•°è¶Šå¤šï¼Œä¸è¢«é€‰ä¸­çš„å‡ ç‡è¶Šå¤§</p><ul><li>å½“èŠ‚ç‚¹å¿«é€ŸæŠ›å¼‚å¸¸ä¼šè¢«è®¤ä¸ºæ˜¯å¤„ç†è¯·æ±‚é€Ÿåº¦å¿«çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æœ€å¤§å¤±è´¥å€¼é™åˆ¶90ï¼ŒprovideræŠ›å¼‚å¸¸æœ€ä½æœ‰10%é€‰ä¸­çš„æ¦‚ç‡ï¼Œç­‰provideræ¢å¤å¹¶ä¸å†æŠ›å¼‚å¸¸äº†æ¢å¤æ­£å¸¸</li></ul></li></ul><p>é™„ä¼ªä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// åˆå§‹åŒ– æœ€å°æ´»è·ƒæ•°leastActiveã€æœ€å°æ´»è·ƒæ•°çš„æ•°é‡leastCountç­‰</span><br><span class="line"></span><br><span class="line">if (leastCount == 1) &#123;</span><br><span class="line">    // æœ€å°‘æ´»è·ƒæ•°çš„provideråˆ—è¡¨åªæœ‰1ä¸ªç›´æ¥è¿”å›</span><br><span class="line">&#125; else  &#123;</span><br><span class="line"> // é‡‡ç”¨éšæœºç®—æ³•</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®—æ³•å¤æ‚åº¦åˆ†æï¼šåˆå§‹åŒ–å·¥ä½œå¤æ‚åº¦O(n)ï¼Œæœ€å°‘æ´»è·ƒæ•°é‡ä¸º1ç›´æ¥è¿”å›O(1)ï¼Œå¦åˆ™ä½¿ç”¨éšæœºç®—æ³•ï¼›<strong>æœ€å°‘æ´»è·ƒä¼˜å…ˆç®—æ³•ï¼Œæ— æƒé‡æƒ…å†µä¸‹2O(n)ï¼Œæœ‰æƒé‡æƒ…å†µä¸‹3O(n)</strong></p><h3 id="ä¸€è‡´æ€§hash"><a href="#ä¸€è‡´æ€§hash" class="headerlink" title="ä¸€è‡´æ€§hash"></a>ä¸€è‡´æ€§hash</h3><ul><li>ä»¥æ–¹æ³•ç»´åº¦å®šä¹‰äº†é€‰æ‹©å™¨ï¼Œä¿å­˜æ˜ å°„å…³ç³»ï¼Œä»¥interfaceName+methodNameä¸ºkeyï¼Œè‡ªå®šä¹‰çš„é€‰æ‹©å™¨ä¸ºvalueï¼›</li><li>å½“é¦–æ¬¡å¯¹ä¸€ä¸ªæ–¹æ³•å‘èµ·è°ƒç”¨æˆ–è€…providerListå‘ç”Ÿå˜åŒ–æ—¶ï¼Œåˆå§‹åŒ–é€‰æ‹©å™¨<ul><li>æ¯ä¸ªèŠ‚ç‚¹åˆ›å»º128ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œä»¥ ip+port+index ä¸ºkeyå¾—åˆ°128ä¸ªhashå€¼ï¼Œä¿å­˜è™šæ‹ŸèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼ˆè¦æœ‰åºï¼‰</li></ul></li><li>å¦‚æœå½“å‰æ–¹æ³•å­˜åœ¨é€‰æ‹©å™¨ä¸”providerListæ²¡å˜ï¼Œç”¨æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¾—åˆ°hashå€¼ï¼Œä»è™šæ‹ŸèŠ‚ç‚¹çš„æ˜ å°„ä¸­getï¼Œå‘½ä¸­ç›´æ¥è¿”å›ï¼Œä¸å‘½ä¸­é€‰æ‹©ç¬¬ä¸€ä¸ªå¤§äºè¯¥hashå€¼çš„èŠ‚ç‚¹ï¼Œæ²¡æœ‰åˆ™é€‰æ‹©è™šæ‹ŸèŠ‚ç‚¹ä¸­çš„ç¬¬ä¸€ä¸ª</li></ul><p>hashç®—æ³•ï¼šé€šè¿‡å¯¹ä¸€ä¸ªkeyä½¿ç”¨MD5ç®—æ³•å¾—åˆ°ä¸€ä¸ªæ‘˜è¦ï¼Œè¿™ä¸ªæ‘˜è¦æ˜¯byte[16]ç±»å‹ï¼Œå°†æ•°ç»„æŒ‰ç…§ç´¢å¼• 0-3 4-7 8-11 12-15 åˆ†æˆ4æ®µï¼Œæ¯ä¸€ä¸ªæ®µæœ‰4ä¸ªbyteï¼Œç»„æˆä¸€ä¸ª32ä½çš„hashå€¼ï¼Œä¸€ä¸ªæ‘˜è¦å¯ä»¥ç”Ÿæˆ4ä¸ªhashå€¼</p><p>é™„ä¼ªä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">selector = selectorMap.get(key);</span><br><span class="line">if (selector == null || selector.hash() != hashCode)&#123;</span><br><span class="line">    // é¦–æ¬¡è°ƒç”¨æˆ–è€…providerListå‘ç”Ÿå˜åŒ–</span><br><span class="line">    selectorMap.put(key, new Selector());</span><br><span class="line">&#125; </span><br><span class="line">return selecotr.select();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Selector&#123;</span><br><span class="line"></span><br><span class="line">    Selector()&#123;</span><br><span class="line">        // åˆå§‹åŒ–é€‰æ‹©å™¨</span><br><span class="line">        for(item : providerList) &#123;</span><br><span class="line">            for (0 : 31) &#123;</span><br><span class="line">                digest = md5.digist(key);// byte[16]ç±»å‹ï¼Œ4ä¸ªhashå€¼</span><br><span class="line">                for (0 : 3) &#123;</span><br><span class="line">                    virtualNodes.put(hash(digest,index));// hash()å°±æ˜¯å°†æ‘˜è¦åˆ†æ®µè¿”å›indexä¸ªæ®µä½œä¸ºhashå€¼</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public Provider select()&#123;</span><br><span class="line">        digest = md5.digest(arg[0]);// æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºkeyç”Ÿæˆæ‘˜è¦</span><br><span class="line">        hashCode = hash(digest,0);// å°†æ‘˜è¦çš„ç¬¬ä¸€ä¸ªç«¯æœ€ä¸ºhashå€¼</span><br><span class="line">        provider = virtualNodes.get(hashCode)</span><br><span class="line">        if (provider == null) &#123;</span><br><span class="line">            // é€‰æ‹©å¤§äºhashCodeçš„ç¬¬ä¸€ä¸ªkeyå¯¹åº”çš„èŠ‚ç‚¹ï¼Œæ²¡æœ‰å°±é€‰æ‹©ç¬¬ä¸€ä¸ªkeyçš„èŠ‚ç‚¹</span><br><span class="line">        &#125;</span><br><span class="line">        return provider;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®—æ³•å¤æ‚åº¦åˆ†æï¼š<strong>åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡é€‰æ‹©éƒ½è¦åˆå§‹åŒ–é€‰æ‹©å™¨çš„å¤æ‚åº¦ä¸º128O(n)ï¼Œå½“provideråˆ—è¡¨ä¸å˜æ—¶åªéœ€è¿›è¡Œ1æ¬¡åˆå§‹åŒ–ï¼Œåç»­çš„é€‰æ‹©æ“ä½œå¤æ‚åº¦ä¸ºO(1)</strong></p><h3 id="æœ¬åœ°ä¼˜å…ˆéšæœºç®—æ³•"><a href="#æœ¬åœ°ä¼˜å…ˆéšæœºç®—æ³•" class="headerlink" title="æœ¬åœ°ä¼˜å…ˆéšæœºç®—æ³•"></a>æœ¬åœ°ä¼˜å…ˆéšæœºç®—æ³•</h3><p>åˆ¤æ–­provideråˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨æœ¬åœ°ipï¼Œæœ‰åˆ™å‘èµ·è°ƒç”¨ï¼Œæ²¡æœ‰å°±ä½¿ç”¨éšæœºç®—æ³•</p><p>ç®—æ³•å¤æ‚åº¦åˆ†æï¼š<strong>æœ€åçš„æƒ…å†µä¸‹æ¯æ¬¡éƒ½æ‰¾ä¸åˆ°æœ¬åœ°ipåˆ™æ¯”éšæœºç®—æ³•å¤šO(n)çš„å¤æ‚åº¦ï¼Œå¦‚æœèƒ½æ‰¾åˆ°æœ¬åœ°ipçš„å¤æ‚åº¦ä¸ºO(n)</strong></p><p>æ€»ç»“ï¼š</p><ul><li>éšæœºç®—æ³•å’Œè½®è¯¢ç®—æ³•ï¼Œé€‚ç”¨äºèŠ‚ç‚¹å·®å¼‚ä¸å¤§çš„æƒ…æ™¯ï¼ŒèŠ‚ç‚¹æœ‰å·®å¼‚éœ€è¦è®¾ç½®æƒé‡å€¼<ul><li>ä¼˜ç‚¹ï¼Œç®€å•é«˜æ•ˆ</li><li>ç¼ºç‚¹ï¼Œéœ€è¦æ‰¾åˆ°æœ€åˆé€‚çš„æƒé‡å€¼</li></ul></li><li>æœ€å°‘æ´»è·ƒä¼˜å…ˆç®—æ³•ï¼Œé€‚ç”¨èŠ‚ç‚¹ä¹‹é—´æœ‰å·®å¼‚çš„æƒ…æ™¯<ul><li>ä¼˜ç‚¹ï¼Œæ— æƒé‡å€¼ä¸‹ï¼Œå¯ä»¥å‡è¡¡èŠ‚ç‚¹ä¹‹é—´çš„å·®å¼‚ï¼Œä¸ç”¨å»è®¾ç½®æƒé‡å€¼</li><li>ç¼ºç‚¹ï¼Œç®—æ³•å¤æ‚åº¦è¾ƒé«˜</li></ul></li><li>ä¸€è‡´æ€§hash é€‚ç”¨äºèŠ‚ç‚¹ä¸­æœ‰ç¼“å­˜æ•°æ®çš„æƒ…æ™¯ï¼Œç›¸åŒçš„è¯·æ±‚æ€»æ˜¯é€‰æ‹©åŒæ ·çš„èŠ‚ç‚¹<ul><li>ç¼ºç‚¹ï¼Œç®—æ³•å¤æ‚åº¦è¾ƒé«˜</li></ul></li><li>æœ¬åœ°IPè°ƒç”¨ä¼˜å…ˆ é€‚ç”¨äºæœ¬åœ°åŒæ—¶æä¾›æœåŠ¡çš„æƒ…æ™¯</li></ul><p><strong>ç»¼ä¸Šï¼Œç†è®ºä¸Šï¼Œæœ¬åœ°æœ‰è‡ªå·±è¦è°ƒç”¨çš„æœåŠ¡é…ç½®æœ¬åœ°IPè°ƒç”¨ä¼˜å…ˆï¼Œå…¶ä»–æƒ…å†µä½¿ç”¨éšæœºæˆ–è€…è½®è¯¢éƒ½å¯ä»¥ï¼Œé»˜è®¤éšæœºç®—æ³•ä¸ç”¨ç®¡å°±å¥½äº†</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨äº¬ä¸œå¹¿æ³›ä½¿ç”¨çš„å¾®æœåŠ¡æ¡†æ¶æ˜¯JSF(Jingdong Service Framework)ï¼Œä¸­æ–‡åå«æ°å¤«ï¼Œä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹JSFçš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚å…ˆä¸²ä¸€ä¸‹æœåŠ¡è°ƒç”¨çš„è¿‡ç¨‹ï¼Œconsumeråœ¨å‘providerå‘èµ·è¿œç¨‹è°ƒç”¨ä¹‹å‰ä¼šä»æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°è‡ªå·±è®¢é˜…çš„provideråˆ—è¡¨ï¼Œç„¶å
      
    
    </summary>
    
      <category term="å¾®æœåŠ¡" scheme="http://yoursite.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="å¾®æœåŠ¡" scheme="http://yoursite.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
</feed>
