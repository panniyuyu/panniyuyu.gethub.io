---
title: istio 部署模型
author: YyWang
authorLink: http://www.yywang.cool #新增
date: 2021-08-30T17:57:12+08:00 #修改格式
lastmod: 2021-08-30T17:57:12+08:00 #新增
draft: false #新增
tags: ["Istio"] #修改格式
categories: ["Istio"] #修改格式
featuredImagePreview: #新增
---
## istio 部署模型总结
istio 存在多种形式的部署模型来满足不同的实际情况，官方也有详细的介绍文档 [中文文档](https://istio.io/latest/zh/docs/ops/deployment/deployment-models/#identity-and-trust-models)
这里简单总结一下，文档中的部署模型是分成了四个不同的维度来介绍的，分别是集群、网络、控制平面、网格

### 集群模型

* 单集群
* 多集群

这里集群的概念是 k8s 集群，单集群即 istio 在一个单独的 k8s 集群中运行，可以发现集群内的工作负载；多集群即 istio 运行在多个 k8s 集群之上，可以
发现所有 k8s 集群中的工作负载。多集群相比单集群支持更多的功能，如故障转移、位置感知的路由、配合不同的控制平面模型支持不同级别的可用性

### 网络模型

* 单一网络
* 多网络

单一网络指的是 istio 运行在一个网络完全连通的环境，在单一网络的环境中所有的工作负载都可以互相访问；多网络指的是 istio 运行在由多个子网络组成的网
络环境中，多网络模型中不同子网络的工作负载之间必须通过 istio 网关进行通信；多网络模型比当以网络模型有更多的特性，多网络模型允许不同的子网络里服务
端点的 ip 和 vip 相同；具有容错能力

### 控制平面模型

* 单一控制平面
* 多控制平面

简单理解就是指部署几套 istio，多个控制平面比单一控制平面模型有着更强的可用性支持故障转移

### 网格模型

* 单一网格
* 多网格

网格指的是控制面+数据面组成的一整套基础设施层，单一网格即单一的控制面和数据面组成的网格，多网格即多个单一网格组成的网格联邦；简单理解就是看有几套 
istio，这个与控制平面模型的概念有些重复，其实仔细想想也是有区别的，网格模型中的网格指的是一个包含控制面+数据面的独立基础设施层是更大的概念，而控制
平面是在网格之内的，比如单一网格中，可以有单一控制平面也可以有多控制平面；多网格中有一个网格有一个控制平面，另一个网格有多个控制平面

以上就是 istio 部署模型拆分成了四个维度来解释，要部署一个 istio 时要分别考虑四个维度，根据不同的实际场景选择相应的部署模型，每个维度选择一个部署
模型组合起来就是最终 istio 的部署模型，就比如

* 只有一个 k8s 集群，集群内网络互通，且只需要一个网格，网格中的控制平面也只有一个，这是最简单的 istio 部署（单集群+单网络+单控制面+单网格）

![eg1](/images/istioeg1.png)

* 有两个 k8s 集群，集群之间网络互通，且只需要一个网格，网格中控制平面只有一个（多集群+单网络+单控制面+单网格）

![eg2](/images/istioeg2.png)

* 有四个 k8s 集群（集群分成不同的区域），集群之间网络互通，且只需要一个网格，控制平面有两个（多集群+单网络+多控制面+单网格）

![eg3](/images/istioeg3.png)

## 参考

* https://istio.io/latest/zh/docs/ops/deployment/deployment-models/
* https://istio.io/latest/docs/ops/deployment/deployment-models/
